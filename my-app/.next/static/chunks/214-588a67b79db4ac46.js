(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[214],{97:(e,t,r)=>{"use strict";function s(e,t){function r(r){let s=e(r);return s?s[t]:null}return{[t]:function(e){let t,s=!1;"function"==typeof e?t=e:e&&"object"==typeof e&&(s=!!e.optional,t=e.selector);let a=r({optional:s});return a?t?a(t):a():null},[`${t}Store`]:r}}r.d(t,{o:()=>s})},1386:(e,t,r)=>{"use strict";r.d(t,{Xi:()=>l,pK:()=>u,vz:()=>n});var s=r(2115),a=r(4354),i=r(2288),n=(0,s.createContext)(null),o=(0,a.h)(n,"a component passed to <ThreadListPrimitive.Items components={...}>");function u(e){let t=o(e);return t?t.useThreadListItemRuntime():null}var l=(0,i.k)(u)},2288:(e,t,r)=>{"use strict";r.d(t,{k:()=>n});var s=r(2115),a=r(4229),i=e=>e;function n(e){return function(t){let r,n=!1;"function"==typeof t?r=t:t&&(n=!!t.optional,r=t.selector);let o=e({optional:n});return o?function(e,t=i){(0,a.Q)(e);let r=(0,s.useSyncExternalStore)(e.subscribe,()=>t(e.getState()),()=>t(e.getState()));return(0,s.useDebugValue)(r),r}(o,r):null}}},3357:(e,t,r)=>{"use strict";r.d(t,{X:()=>h});var s=r(2115),a=r(5453),i=r(1386),n=r(9935),o=r(4229),u=r(5155),l=e=>{let[t]=(0,s.useState)(()=>(0,a.v)(()=>e));return(0,s.useEffect)(()=>{(0,o.Q)(e),(0,n.s)(t).setState(e,!0)},[e,t]),t},h=e=>{let{runtime:t,children:r}=e,a=l(t),[n]=(0,s.useState)(()=>({useThreadListItemRuntime:a}));return(0,u.jsx)(i.vz.Provider,{value:n,children:r})}},4211:(e,t,r)=>{"use strict";var s=r(9641).Buffer;let a=void 0!==s,i=/"(?:_|\\u005[Ff])(?:_|\\u005[Ff])(?:p|\\u0070)(?:r|\\u0072)(?:o|\\u006[Ff])(?:t|\\u0074)(?:o|\\u006[Ff])(?:_|\\u005[Ff])(?:_|\\u005[Ff])"\s*:/,n=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/;function o(e,t,r){null==r&&null!==t&&"object"==typeof t&&(r=t,t=void 0),a&&s.isBuffer(e)&&(e=e.toString()),e&&65279===e.charCodeAt(0)&&(e=e.slice(1));let o=JSON.parse(e,t);if(null===o||"object"!=typeof o)return o;let l=r&&r.protoAction||"error",h=r&&r.constructorAction||"error";if("ignore"===l&&"ignore"===h)return o;if("ignore"!==l&&"ignore"!==h){if(!1===i.test(e)&&!1===n.test(e))return o}else if("ignore"!==l&&"ignore"===h){if(!1===i.test(e))return o}else if(!1===n.test(e))return o;return u(o,{protoAction:l,constructorAction:h,safe:r&&r.safe})}function u(e,{protoAction:t="error",constructorAction:r="error",safe:s}={}){let a=[e];for(;a.length;){let e=a;for(let i of(a=[],e)){if("ignore"!==t&&Object.prototype.hasOwnProperty.call(i,"__proto__")){if(!0===s)return null;if("error"===t)throw SyntaxError("Object contains forbidden prototype property");delete i.__proto__}if("ignore"!==r&&Object.prototype.hasOwnProperty.call(i,"constructor")&&Object.prototype.hasOwnProperty.call(i.constructor,"prototype")){if(!0===s)return null;if("error"===r)throw SyntaxError("Object contains forbidden prototype property");delete i.constructor}for(let e in i){let t=i[e];t&&"object"==typeof t&&a.push(t)}}}return e}function l(e,t,r){let{stackTraceLimit:s}=Error;Error.stackTraceLimit=0;try{return o(e,t,r)}finally{Error.stackTraceLimit=s}}e.exports=l,e.exports.default=l,e.exports.parse=l,e.exports.safeParse=function(e,t){let{stackTraceLimit:r}=Error;Error.stackTraceLimit=0;try{return o(e,t,{safe:!0})}catch{return}finally{Error.stackTraceLimit=r}},e.exports.scan=u},4229:(e,t,r)=>{"use strict";r.d(t,{Q:()=>s});var s=e=>{e.__isBound||(e.__internal_bindMethods?.(),e.__isBound=!0)}},4354:(e,t,r)=>{"use strict";r.d(t,{h:()=>a});var s=r(2115);function a(e,t){return function(r){let a=(0,s.useContext)(e);if(!(null==r?void 0:r.optional)&&!a)throw Error("This component must be used within ".concat(t,"."));return a}}},5453:(e,t,r)=>{"use strict";r.d(t,{v:()=>u});var s=r(2115);let a=e=>{let t,r=new Set,s=(e,s)=>{let a="function"==typeof e?e(t):e;if(!Object.is(a,t)){let e=t;t=(null!=s?s:"object"!=typeof a||null===a)?a:Object.assign({},t,a),r.forEach(r=>r(t,e))}},a=()=>t,i={setState:s,getState:a,getInitialState:()=>n,subscribe:e=>(r.add(e),()=>r.delete(e))},n=t=e(s,a,i);return i},i=e=>e?a(e):a,n=e=>e,o=e=>{let t=i(e),r=e=>(function(e,t=n){let r=s.useSyncExternalStore(e.subscribe,()=>t(e.getState()),()=>t(e.getInitialState()));return s.useDebugValue(r),r})(t,e);return Object.assign(r,t),r},u=e=>e?o(e):o},7119:(e,t,r)=>{"use strict";r.d(t,{Ij:()=>l,WF:()=>o});var s=r(2115),a=r(4354),i=r(97),n=r(2288),o=(0,s.createContext)(null),u=(0,a.h)(o,"AssistantRuntimeProvider");function l(e){let t=u(e);return t?t.useAssistantRuntime():null}var{useToolUIs:h,useToolUIsStore:d}=(0,i.o)(u,"useToolUIs");(0,n.k)(e=>{var t,r;return null!=(r=null==(t=l(e))?void 0:t.threads)?r:null})},7364:()=>{},8420:(e,t,r)=>{"use strict";let s,a;r.d(t,{u:()=>s$});var i,n,o,u,l={};r.r(l),r.d(l,{yM:()=>t6});var h=(e,t={})=>e.map(e=>d(e,t)),d=(e,t={})=>{let r=t.unstable_includeId??!1,s=e.role;switch(s){case"assistant":return{role:s,content:e.content.map(e=>{if("reasoning"===e.type||"source"===e.type||"file"===e.type)return null;if("tool-call"===e.type){let{argsText:t,...r}=e;return r}return e}).filter(e=>!!e),...r?{unstable_id:e.id}:{}};case"user":return{role:s,content:[...e.content,...e.attachments.map(e=>e.content).flat()],...r?{unstable_id:e.id}:{}};case"system":return{role:s,content:e.content,...r?{unstable_id:e.id}:{}};default:throw Error(`Unknown message role: ${s}`)}};!function(e){e.assertEqual=e=>{},e.assertIs=function(e){},e.assertNever=function(e){throw Error()},e.arrayToEnum=e=>{let t={};for(let r of e)t[r]=r;return t},e.getValidEnumValues=t=>{let r=e.objectKeys(t).filter(e=>"number"!=typeof t[t[e]]),s={};for(let e of r)s[e]=t[e];return e.objectValues(s)},e.objectValues=t=>e.objectKeys(t).map(function(e){return t[e]}),e.objectKeys="function"==typeof Object.keys?e=>Object.keys(e):e=>{let t=[];for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.push(r);return t},e.find=(e,t)=>{for(let r of e)if(t(r))return r},e.isInteger="function"==typeof Number.isInteger?e=>Number.isInteger(e):e=>"number"==typeof e&&Number.isFinite(e)&&Math.floor(e)===e,e.joinValues=function(e,t=" | "){return e.map(e=>"string"==typeof e?`'${e}'`:e).join(t)},e.jsonStringifyReplacer=(e,t)=>"bigint"==typeof t?t.toString():t}(i||(i={})),(n||(n={})).mergeShapes=(e,t)=>({...e,...t});let c=i.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),p=e=>{switch(typeof e){case"undefined":return c.undefined;case"string":return c.string;case"number":return Number.isNaN(e)?c.nan:c.number;case"boolean":return c.boolean;case"function":return c.function;case"bigint":return c.bigint;case"symbol":return c.symbol;case"object":if(Array.isArray(e))return c.array;if(null===e)return c.null;if(e.then&&"function"==typeof e.then&&e.catch&&"function"==typeof e.catch)return c.promise;if("undefined"!=typeof Map&&e instanceof Map)return c.map;if("undefined"!=typeof Set&&e instanceof Set)return c.set;if("undefined"!=typeof Date&&e instanceof Date)return c.date;return c.object;default:return c.unknown}},f=i.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class m extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=e=>{this.issues=[...this.issues,e]},this.addIssues=(e=[])=>{this.issues=[...this.issues,...e]};let t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){let t=e||function(e){return e.message},r={_errors:[]},s=e=>{for(let a of e.issues)if("invalid_union"===a.code)a.unionErrors.map(s);else if("invalid_return_type"===a.code)s(a.returnTypeError);else if("invalid_arguments"===a.code)s(a.argumentsError);else if(0===a.path.length)r._errors.push(t(a));else{let e=r,s=0;for(;s<a.path.length;){let r=a.path[s];s===a.path.length-1?(e[r]=e[r]||{_errors:[]},e[r]._errors.push(t(a))):e[r]=e[r]||{_errors:[]},e=e[r],s++}}};return s(this),r}static assert(e){if(!(e instanceof m))throw Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,i.jsonStringifyReplacer,2)}get isEmpty(){return 0===this.issues.length}flatten(e=e=>e.message){let t={},r=[];for(let s of this.issues)s.path.length>0?(t[s.path[0]]=t[s.path[0]]||[],t[s.path[0]].push(e(s))):r.push(e(s));return{formErrors:r,fieldErrors:t}}get formErrors(){return this.flatten()}}m.create=e=>new m(e);let g=(e,t)=>{let r;switch(e.code){case f.invalid_type:r=e.received===c.undefined?"Required":`Expected ${e.expected}, received ${e.received}`;break;case f.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(e.expected,i.jsonStringifyReplacer)}`;break;case f.unrecognized_keys:r=`Unrecognized key(s) in object: ${i.joinValues(e.keys,", ")}`;break;case f.invalid_union:r="Invalid input";break;case f.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${i.joinValues(e.options)}`;break;case f.invalid_enum_value:r=`Invalid enum value. Expected ${i.joinValues(e.options)}, received '${e.received}'`;break;case f.invalid_arguments:r="Invalid function arguments";break;case f.invalid_return_type:r="Invalid function return type";break;case f.invalid_date:r="Invalid date";break;case f.invalid_string:"object"==typeof e.validation?"includes"in e.validation?(r=`Invalid input: must include "${e.validation.includes}"`,"number"==typeof e.validation.position&&(r=`${r} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?r=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?r=`Invalid input: must end with "${e.validation.endsWith}"`:i.assertNever(e.validation):r="regex"!==e.validation?`Invalid ${e.validation}`:"Invalid";break;case f.too_small:r="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:"date"===e.type?`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:"Invalid input";break;case f.too_big:r="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"bigint"===e.type?`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"date"===e.type?`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:"Invalid input";break;case f.custom:r="Invalid input";break;case f.invalid_intersection_types:r="Intersection results could not be merged";break;case f.not_multiple_of:r=`Number must be a multiple of ${e.multipleOf}`;break;case f.not_finite:r="Number must be finite";break;default:r=t.defaultError,i.assertNever(e)}return{message:r}},y=e=>{let{data:t,path:r,errorMaps:s,issueData:a}=e,i=[...r,...a.path||[]],n={...a,path:i};if(void 0!==a.message)return{...a,path:i,message:a.message};let o="";for(let e of s.filter(e=>!!e).slice().reverse())o=e(n,{data:t,defaultError:o}).message;return{...a,path:i,message:o}};function _(e,t){let r=y({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,g,g==g?void 0:g].filter(e=>!!e)});e.common.issues.push(r)}class b{constructor(){this.value="valid"}dirty(){"valid"===this.value&&(this.value="dirty")}abort(){"aborted"!==this.value&&(this.value="aborted")}static mergeArray(e,t){let r=[];for(let s of t){if("aborted"===s.status)return v;"dirty"===s.status&&e.dirty(),r.push(s.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,t){let r=[];for(let e of t){let t=await e.key,s=await e.value;r.push({key:t,value:s})}return b.mergeObjectSync(e,r)}static mergeObjectSync(e,t){let r={};for(let s of t){let{key:t,value:a}=s;if("aborted"===t.status||"aborted"===a.status)return v;"dirty"===t.status&&e.dirty(),"dirty"===a.status&&e.dirty(),"__proto__"!==t.value&&(void 0!==a.value||s.alwaysSet)&&(r[t.value]=a.value)}return{status:e.value,value:r}}}let v=Object.freeze({status:"aborted"}),w=e=>({status:"dirty",value:e}),S=e=>({status:"valid",value:e}),x=e=>"aborted"===e.status,T=e=>"dirty"===e.status,k=e=>"valid"===e.status,I=e=>"undefined"!=typeof Promise&&e instanceof Promise;!function(e){e.errToObj=e=>"string"==typeof e?{message:e}:e||{},e.toString=e=>"string"==typeof e?e:e?.message}(o||(o={}));class E{constructor(e,t,r,s){this._cachedPath=[],this.parent=e,this.data=t,this._path=r,this._key=s}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}let A=(e,t)=>{if(k(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let t=new m(e.common.issues);return this._error=t,this._error}}};function C(e){if(!e)return{};let{errorMap:t,invalid_type_error:r,required_error:s,description:a}=e;if(t&&(r||s))throw Error('Can\'t use "invalid_type_error" or "required_error" in conjunction with custom error map.');return t?{errorMap:t,description:a}:{errorMap:(t,a)=>{let{message:i}=e;return"invalid_enum_value"===t.code?{message:i??a.defaultError}:void 0===a.data?{message:i??s??a.defaultError}:"invalid_type"!==t.code?{message:a.defaultError}:{message:i??r??a.defaultError}},description:a}}class R{get description(){return this._def.description}_getType(e){return p(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:p(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new b,ctx:{common:e.parent.common,data:e.data,parsedType:p(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let t=this._parse(e);if(I(t))throw Error("Synchronous parse encountered promise.");return t}_parseAsync(e){return Promise.resolve(this._parse(e))}parse(e,t){let r=this.safeParse(e,t);if(r.success)return r.data;throw r.error}safeParse(e,t){let r={common:{issues:[],async:t?.async??!1,contextualErrorMap:t?.errorMap},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:p(e)},s=this._parseSync({data:e,path:r.path,parent:r});return A(r,s)}"~validate"(e){let t={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:p(e)};if(!this["~standard"].async)try{let r=this._parseSync({data:e,path:[],parent:t});return k(r)?{value:r.value}:{issues:t.common.issues}}catch(e){e?.message?.toLowerCase()?.includes("encountered")&&(this["~standard"].async=!0),t.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:t}).then(e=>k(e)?{value:e.value}:{issues:t.common.issues})}async parseAsync(e,t){let r=await this.safeParseAsync(e,t);if(r.success)return r.data;throw r.error}async safeParseAsync(e,t){let r={common:{issues:[],contextualErrorMap:t?.errorMap,async:!0},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:p(e)},s=this._parse({data:e,path:r.path,parent:r});return A(r,await (I(s)?s:Promise.resolve(s)))}refine(e,t){let r=e=>"string"==typeof t||void 0===t?{message:t}:"function"==typeof t?t(e):t;return this._refinement((t,s)=>{let a=e(t),i=()=>s.addIssue({code:f.custom,...r(t)});return"undefined"!=typeof Promise&&a instanceof Promise?a.then(e=>!!e||(i(),!1)):!!a||(i(),!1)})}refinement(e,t){return this._refinement((r,s)=>!!e(r)||(s.addIssue("function"==typeof t?t(r,s):t),!1))}_refinement(e){return new ex({schema:this,typeName:u.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:e=>this["~validate"](e)}}optional(){return eT.create(this,this._def)}nullable(){return ek.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return en.create(this)}promise(){return eS.create(this,this._def)}or(e){return eu.create([this,e],this._def)}and(e){return ed.create(this,e,this._def)}transform(e){return new ex({...C(this._def),schema:this,typeName:u.ZodEffects,effect:{type:"transform",transform:e}})}default(e){return new eI({...C(this._def),innerType:this,defaultValue:"function"==typeof e?e:()=>e,typeName:u.ZodDefault})}brand(){return new eC({typeName:u.ZodBranded,type:this,...C(this._def)})}catch(e){return new eE({...C(this._def),innerType:this,catchValue:"function"==typeof e?e:()=>e,typeName:u.ZodCatch})}describe(e){return new this.constructor({...this._def,description:e})}pipe(e){return eR.create(this,e)}readonly(){return eO.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}let O=/^c[^\s-]{8,}$/i,P=/^[0-9a-z]+$/,M=/^[0-9A-HJKMNP-TV-Z]{26}$/i,N=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,B=/^[a-z0-9_-]{21}$/i,j=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,Z=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,L=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,$=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,D=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,U=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,F=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,z=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,q=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,V="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",J=RegExp(`^${V}$`);function K(e){let t="[0-5]\\d";e.precision?t=`${t}\\.\\d{${e.precision}}`:null==e.precision&&(t=`${t}(\\.\\d+)?`);let r=e.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${t})${r}`}class W extends R{_parse(e){var t,r,a,n;let o;if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==c.string){let t=this._getOrReturnCtx(e);return _(t,{code:f.invalid_type,expected:c.string,received:t.parsedType}),v}let u=new b;for(let l of this._def.checks)if("min"===l.kind)e.data.length<l.value&&(_(o=this._getOrReturnCtx(e,o),{code:f.too_small,minimum:l.value,type:"string",inclusive:!0,exact:!1,message:l.message}),u.dirty());else if("max"===l.kind)e.data.length>l.value&&(_(o=this._getOrReturnCtx(e,o),{code:f.too_big,maximum:l.value,type:"string",inclusive:!0,exact:!1,message:l.message}),u.dirty());else if("length"===l.kind){let t=e.data.length>l.value,r=e.data.length<l.value;(t||r)&&(o=this._getOrReturnCtx(e,o),t?_(o,{code:f.too_big,maximum:l.value,type:"string",inclusive:!0,exact:!0,message:l.message}):r&&_(o,{code:f.too_small,minimum:l.value,type:"string",inclusive:!0,exact:!0,message:l.message}),u.dirty())}else if("email"===l.kind)L.test(e.data)||(_(o=this._getOrReturnCtx(e,o),{validation:"email",code:f.invalid_string,message:l.message}),u.dirty());else if("emoji"===l.kind)s||(s=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),s.test(e.data)||(_(o=this._getOrReturnCtx(e,o),{validation:"emoji",code:f.invalid_string,message:l.message}),u.dirty());else if("uuid"===l.kind)N.test(e.data)||(_(o=this._getOrReturnCtx(e,o),{validation:"uuid",code:f.invalid_string,message:l.message}),u.dirty());else if("nanoid"===l.kind)B.test(e.data)||(_(o=this._getOrReturnCtx(e,o),{validation:"nanoid",code:f.invalid_string,message:l.message}),u.dirty());else if("cuid"===l.kind)O.test(e.data)||(_(o=this._getOrReturnCtx(e,o),{validation:"cuid",code:f.invalid_string,message:l.message}),u.dirty());else if("cuid2"===l.kind)P.test(e.data)||(_(o=this._getOrReturnCtx(e,o),{validation:"cuid2",code:f.invalid_string,message:l.message}),u.dirty());else if("ulid"===l.kind)M.test(e.data)||(_(o=this._getOrReturnCtx(e,o),{validation:"ulid",code:f.invalid_string,message:l.message}),u.dirty());else if("url"===l.kind)try{new URL(e.data)}catch{_(o=this._getOrReturnCtx(e,o),{validation:"url",code:f.invalid_string,message:l.message}),u.dirty()}else"regex"===l.kind?(l.regex.lastIndex=0,l.regex.test(e.data)||(_(o=this._getOrReturnCtx(e,o),{validation:"regex",code:f.invalid_string,message:l.message}),u.dirty())):"trim"===l.kind?e.data=e.data.trim():"includes"===l.kind?e.data.includes(l.value,l.position)||(_(o=this._getOrReturnCtx(e,o),{code:f.invalid_string,validation:{includes:l.value,position:l.position},message:l.message}),u.dirty()):"toLowerCase"===l.kind?e.data=e.data.toLowerCase():"toUpperCase"===l.kind?e.data=e.data.toUpperCase():"startsWith"===l.kind?e.data.startsWith(l.value)||(_(o=this._getOrReturnCtx(e,o),{code:f.invalid_string,validation:{startsWith:l.value},message:l.message}),u.dirty()):"endsWith"===l.kind?e.data.endsWith(l.value)||(_(o=this._getOrReturnCtx(e,o),{code:f.invalid_string,validation:{endsWith:l.value},message:l.message}),u.dirty()):"datetime"===l.kind?(function(e){let t=`${V}T${K(e)}`,r=[];return r.push(e.local?"Z?":"Z"),e.offset&&r.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${r.join("|")})`,RegExp(`^${t}$`)})(l).test(e.data)||(_(o=this._getOrReturnCtx(e,o),{code:f.invalid_string,validation:"datetime",message:l.message}),u.dirty()):"date"===l.kind?J.test(e.data)||(_(o=this._getOrReturnCtx(e,o),{code:f.invalid_string,validation:"date",message:l.message}),u.dirty()):"time"===l.kind?RegExp(`^${K(l)}$`).test(e.data)||(_(o=this._getOrReturnCtx(e,o),{code:f.invalid_string,validation:"time",message:l.message}),u.dirty()):"duration"===l.kind?Z.test(e.data)||(_(o=this._getOrReturnCtx(e,o),{validation:"duration",code:f.invalid_string,message:l.message}),u.dirty()):"ip"===l.kind?(t=e.data,!(("v4"===(r=l.version)||!r)&&$.test(t)||("v6"===r||!r)&&U.test(t))&&1&&(_(o=this._getOrReturnCtx(e,o),{validation:"ip",code:f.invalid_string,message:l.message}),u.dirty())):"jwt"===l.kind?!function(e,t){if(!j.test(e))return!1;try{let[r]=e.split("."),s=r.replace(/-/g,"+").replace(/_/g,"/").padEnd(r.length+(4-r.length%4)%4,"="),a=JSON.parse(atob(s));if("object"!=typeof a||null===a||"typ"in a&&a?.typ!=="JWT"||!a.alg||t&&a.alg!==t)return!1;return!0}catch{return!1}}(e.data,l.alg)&&(_(o=this._getOrReturnCtx(e,o),{validation:"jwt",code:f.invalid_string,message:l.message}),u.dirty()):"cidr"===l.kind?(a=e.data,!(("v4"===(n=l.version)||!n)&&D.test(a)||("v6"===n||!n)&&F.test(a))&&1&&(_(o=this._getOrReturnCtx(e,o),{validation:"cidr",code:f.invalid_string,message:l.message}),u.dirty())):"base64"===l.kind?z.test(e.data)||(_(o=this._getOrReturnCtx(e,o),{validation:"base64",code:f.invalid_string,message:l.message}),u.dirty()):"base64url"===l.kind?q.test(e.data)||(_(o=this._getOrReturnCtx(e,o),{validation:"base64url",code:f.invalid_string,message:l.message}),u.dirty()):i.assertNever(l);return{status:u.value,value:e.data}}_regex(e,t,r){return this.refinement(t=>e.test(t),{validation:t,code:f.invalid_string,...o.errToObj(r)})}_addCheck(e){return new W({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...o.errToObj(e)})}url(e){return this._addCheck({kind:"url",...o.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...o.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...o.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...o.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...o.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...o.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...o.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...o.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...o.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...o.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...o.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...o.errToObj(e)})}datetime(e){return"string"==typeof e?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:void 0===e?.precision?null:e?.precision,offset:e?.offset??!1,local:e?.local??!1,...o.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return"string"==typeof e?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:void 0===e?.precision?null:e?.precision,...o.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...o.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...o.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t?.position,...o.errToObj(t?.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...o.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...o.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...o.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...o.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...o.errToObj(t)})}nonempty(e){return this.min(1,o.errToObj(e))}trim(){return new W({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new W({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new W({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>"datetime"===e.kind)}get isDate(){return!!this._def.checks.find(e=>"date"===e.kind)}get isTime(){return!!this._def.checks.find(e=>"time"===e.kind)}get isDuration(){return!!this._def.checks.find(e=>"duration"===e.kind)}get isEmail(){return!!this._def.checks.find(e=>"email"===e.kind)}get isURL(){return!!this._def.checks.find(e=>"url"===e.kind)}get isEmoji(){return!!this._def.checks.find(e=>"emoji"===e.kind)}get isUUID(){return!!this._def.checks.find(e=>"uuid"===e.kind)}get isNANOID(){return!!this._def.checks.find(e=>"nanoid"===e.kind)}get isCUID(){return!!this._def.checks.find(e=>"cuid"===e.kind)}get isCUID2(){return!!this._def.checks.find(e=>"cuid2"===e.kind)}get isULID(){return!!this._def.checks.find(e=>"ulid"===e.kind)}get isIP(){return!!this._def.checks.find(e=>"ip"===e.kind)}get isCIDR(){return!!this._def.checks.find(e=>"cidr"===e.kind)}get isBase64(){return!!this._def.checks.find(e=>"base64"===e.kind)}get isBase64url(){return!!this._def.checks.find(e=>"base64url"===e.kind)}get minLength(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}W.create=e=>new W({checks:[],typeName:u.ZodString,coerce:e?.coerce??!1,...C(e)});class Y extends R{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){let t;if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==c.number){let t=this._getOrReturnCtx(e);return _(t,{code:f.invalid_type,expected:c.number,received:t.parsedType}),v}let r=new b;for(let s of this._def.checks)"int"===s.kind?i.isInteger(e.data)||(_(t=this._getOrReturnCtx(e,t),{code:f.invalid_type,expected:"integer",received:"float",message:s.message}),r.dirty()):"min"===s.kind?(s.inclusive?e.data<s.value:e.data<=s.value)&&(_(t=this._getOrReturnCtx(e,t),{code:f.too_small,minimum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),r.dirty()):"max"===s.kind?(s.inclusive?e.data>s.value:e.data>=s.value)&&(_(t=this._getOrReturnCtx(e,t),{code:f.too_big,maximum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),r.dirty()):"multipleOf"===s.kind?0!==function(e,t){let r=(e.toString().split(".")[1]||"").length,s=(t.toString().split(".")[1]||"").length,a=r>s?r:s;return Number.parseInt(e.toFixed(a).replace(".",""))%Number.parseInt(t.toFixed(a).replace(".",""))/10**a}(e.data,s.value)&&(_(t=this._getOrReturnCtx(e,t),{code:f.not_multiple_of,multipleOf:s.value,message:s.message}),r.dirty()):"finite"===s.kind?Number.isFinite(e.data)||(_(t=this._getOrReturnCtx(e,t),{code:f.not_finite,message:s.message}),r.dirty()):i.assertNever(s);return{status:r.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,o.toString(t))}gt(e,t){return this.setLimit("min",e,!1,o.toString(t))}lte(e,t){return this.setLimit("max",e,!0,o.toString(t))}lt(e,t){return this.setLimit("max",e,!1,o.toString(t))}setLimit(e,t,r,s){return new Y({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:o.toString(s)}]})}_addCheck(e){return new Y({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:o.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:o.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:o.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:o.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:o.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:o.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:o.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:o.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:o.toString(e)})}get minValue(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>"int"===e.kind||"multipleOf"===e.kind&&i.isInteger(e.value))}get isFinite(){let e=null,t=null;for(let r of this._def.checks)if("finite"===r.kind||"int"===r.kind||"multipleOf"===r.kind)return!0;else"min"===r.kind?(null===t||r.value>t)&&(t=r.value):"max"===r.kind&&(null===e||r.value<e)&&(e=r.value);return Number.isFinite(t)&&Number.isFinite(e)}}Y.create=e=>new Y({checks:[],typeName:u.ZodNumber,coerce:e?.coerce||!1,...C(e)});class H extends R{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){let t;if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==c.bigint)return this._getInvalidInput(e);let r=new b;for(let s of this._def.checks)"min"===s.kind?(s.inclusive?e.data<s.value:e.data<=s.value)&&(_(t=this._getOrReturnCtx(e,t),{code:f.too_small,type:"bigint",minimum:s.value,inclusive:s.inclusive,message:s.message}),r.dirty()):"max"===s.kind?(s.inclusive?e.data>s.value:e.data>=s.value)&&(_(t=this._getOrReturnCtx(e,t),{code:f.too_big,type:"bigint",maximum:s.value,inclusive:s.inclusive,message:s.message}),r.dirty()):"multipleOf"===s.kind?e.data%s.value!==BigInt(0)&&(_(t=this._getOrReturnCtx(e,t),{code:f.not_multiple_of,multipleOf:s.value,message:s.message}),r.dirty()):i.assertNever(s);return{status:r.value,value:e.data}}_getInvalidInput(e){let t=this._getOrReturnCtx(e);return _(t,{code:f.invalid_type,expected:c.bigint,received:t.parsedType}),v}gte(e,t){return this.setLimit("min",e,!0,o.toString(t))}gt(e,t){return this.setLimit("min",e,!1,o.toString(t))}lte(e,t){return this.setLimit("max",e,!0,o.toString(t))}lt(e,t){return this.setLimit("max",e,!1,o.toString(t))}setLimit(e,t,r,s){return new H({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:o.toString(s)}]})}_addCheck(e){return new H({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:o.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:o.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:o.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:o.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:o.toString(t)})}get minValue(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}H.create=e=>new H({checks:[],typeName:u.ZodBigInt,coerce:e?.coerce??!1,...C(e)});class G extends R{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==c.boolean){let t=this._getOrReturnCtx(e);return _(t,{code:f.invalid_type,expected:c.boolean,received:t.parsedType}),v}return S(e.data)}}G.create=e=>new G({typeName:u.ZodBoolean,coerce:e?.coerce||!1,...C(e)});class X extends R{_parse(e){let t;if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==c.date){let t=this._getOrReturnCtx(e);return _(t,{code:f.invalid_type,expected:c.date,received:t.parsedType}),v}if(Number.isNaN(e.data.getTime()))return _(this._getOrReturnCtx(e),{code:f.invalid_date}),v;let r=new b;for(let s of this._def.checks)"min"===s.kind?e.data.getTime()<s.value&&(_(t=this._getOrReturnCtx(e,t),{code:f.too_small,message:s.message,inclusive:!0,exact:!1,minimum:s.value,type:"date"}),r.dirty()):"max"===s.kind?e.data.getTime()>s.value&&(_(t=this._getOrReturnCtx(e,t),{code:f.too_big,message:s.message,inclusive:!0,exact:!1,maximum:s.value,type:"date"}),r.dirty()):i.assertNever(s);return{status:r.value,value:new Date(e.data.getTime())}}_addCheck(e){return new X({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:o.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:o.toString(t)})}get minDate(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return null!=e?new Date(e):null}get maxDate(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return null!=e?new Date(e):null}}X.create=e=>new X({checks:[],coerce:e?.coerce||!1,typeName:u.ZodDate,...C(e)});class Q extends R{_parse(e){if(this._getType(e)!==c.symbol){let t=this._getOrReturnCtx(e);return _(t,{code:f.invalid_type,expected:c.symbol,received:t.parsedType}),v}return S(e.data)}}Q.create=e=>new Q({typeName:u.ZodSymbol,...C(e)});class ee extends R{_parse(e){if(this._getType(e)!==c.undefined){let t=this._getOrReturnCtx(e);return _(t,{code:f.invalid_type,expected:c.undefined,received:t.parsedType}),v}return S(e.data)}}ee.create=e=>new ee({typeName:u.ZodUndefined,...C(e)});class et extends R{_parse(e){if(this._getType(e)!==c.null){let t=this._getOrReturnCtx(e);return _(t,{code:f.invalid_type,expected:c.null,received:t.parsedType}),v}return S(e.data)}}et.create=e=>new et({typeName:u.ZodNull,...C(e)});class er extends R{constructor(){super(...arguments),this._any=!0}_parse(e){return S(e.data)}}er.create=e=>new er({typeName:u.ZodAny,...C(e)});class es extends R{constructor(){super(...arguments),this._unknown=!0}_parse(e){return S(e.data)}}es.create=e=>new es({typeName:u.ZodUnknown,...C(e)});class ea extends R{_parse(e){let t=this._getOrReturnCtx(e);return _(t,{code:f.invalid_type,expected:c.never,received:t.parsedType}),v}}ea.create=e=>new ea({typeName:u.ZodNever,...C(e)});class ei extends R{_parse(e){if(this._getType(e)!==c.undefined){let t=this._getOrReturnCtx(e);return _(t,{code:f.invalid_type,expected:c.void,received:t.parsedType}),v}return S(e.data)}}ei.create=e=>new ei({typeName:u.ZodVoid,...C(e)});class en extends R{_parse(e){let{ctx:t,status:r}=this._processInputParams(e),s=this._def;if(t.parsedType!==c.array)return _(t,{code:f.invalid_type,expected:c.array,received:t.parsedType}),v;if(null!==s.exactLength){let e=t.data.length>s.exactLength.value,a=t.data.length<s.exactLength.value;(e||a)&&(_(t,{code:e?f.too_big:f.too_small,minimum:a?s.exactLength.value:void 0,maximum:e?s.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:s.exactLength.message}),r.dirty())}if(null!==s.minLength&&t.data.length<s.minLength.value&&(_(t,{code:f.too_small,minimum:s.minLength.value,type:"array",inclusive:!0,exact:!1,message:s.minLength.message}),r.dirty()),null!==s.maxLength&&t.data.length>s.maxLength.value&&(_(t,{code:f.too_big,maximum:s.maxLength.value,type:"array",inclusive:!0,exact:!1,message:s.maxLength.message}),r.dirty()),t.common.async)return Promise.all([...t.data].map((e,r)=>s.type._parseAsync(new E(t,e,t.path,r)))).then(e=>b.mergeArray(r,e));let a=[...t.data].map((e,r)=>s.type._parseSync(new E(t,e,t.path,r)));return b.mergeArray(r,a)}get element(){return this._def.type}min(e,t){return new en({...this._def,minLength:{value:e,message:o.toString(t)}})}max(e,t){return new en({...this._def,maxLength:{value:e,message:o.toString(t)}})}length(e,t){return new en({...this._def,exactLength:{value:e,message:o.toString(t)}})}nonempty(e){return this.min(1,e)}}en.create=(e,t)=>new en({type:e,minLength:null,maxLength:null,exactLength:null,typeName:u.ZodArray,...C(t)});class eo extends R{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(null!==this._cached)return this._cached;let e=this._def.shape(),t=i.objectKeys(e);return this._cached={shape:e,keys:t},this._cached}_parse(e){if(this._getType(e)!==c.object){let t=this._getOrReturnCtx(e);return _(t,{code:f.invalid_type,expected:c.object,received:t.parsedType}),v}let{status:t,ctx:r}=this._processInputParams(e),{shape:s,keys:a}=this._getCached(),i=[];if(!(this._def.catchall instanceof ea&&"strip"===this._def.unknownKeys))for(let e in r.data)a.includes(e)||i.push(e);let n=[];for(let e of a){let t=s[e],a=r.data[e];n.push({key:{status:"valid",value:e},value:t._parse(new E(r,a,r.path,e)),alwaysSet:e in r.data})}if(this._def.catchall instanceof ea){let e=this._def.unknownKeys;if("passthrough"===e)for(let e of i)n.push({key:{status:"valid",value:e},value:{status:"valid",value:r.data[e]}});else if("strict"===e)i.length>0&&(_(r,{code:f.unrecognized_keys,keys:i}),t.dirty());else if("strip"===e);else throw Error("Internal ZodObject error: invalid unknownKeys value.")}else{let e=this._def.catchall;for(let t of i){let s=r.data[t];n.push({key:{status:"valid",value:t},value:e._parse(new E(r,s,r.path,t)),alwaysSet:t in r.data})}}return r.common.async?Promise.resolve().then(async()=>{let e=[];for(let t of n){let r=await t.key,s=await t.value;e.push({key:r,value:s,alwaysSet:t.alwaysSet})}return e}).then(e=>b.mergeObjectSync(t,e)):b.mergeObjectSync(t,n)}get shape(){return this._def.shape()}strict(e){return o.errToObj,new eo({...this._def,unknownKeys:"strict",...void 0!==e?{errorMap:(t,r)=>{let s=this._def.errorMap?.(t,r).message??r.defaultError;return"unrecognized_keys"===t.code?{message:o.errToObj(e).message??s}:{message:s}}}:{}})}strip(){return new eo({...this._def,unknownKeys:"strip"})}passthrough(){return new eo({...this._def,unknownKeys:"passthrough"})}extend(e){return new eo({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new eo({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:u.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new eo({...this._def,catchall:e})}pick(e){let t={};for(let r of i.objectKeys(e))e[r]&&this.shape[r]&&(t[r]=this.shape[r]);return new eo({...this._def,shape:()=>t})}omit(e){let t={};for(let r of i.objectKeys(this.shape))e[r]||(t[r]=this.shape[r]);return new eo({...this._def,shape:()=>t})}deepPartial(){return function e(t){if(t instanceof eo){let r={};for(let s in t.shape){let a=t.shape[s];r[s]=eT.create(e(a))}return new eo({...t._def,shape:()=>r})}if(t instanceof en)return new en({...t._def,type:e(t.element)});if(t instanceof eT)return eT.create(e(t.unwrap()));if(t instanceof ek)return ek.create(e(t.unwrap()));if(t instanceof ec)return ec.create(t.items.map(t=>e(t)));else return t}(this)}partial(e){let t={};for(let r of i.objectKeys(this.shape)){let s=this.shape[r];e&&!e[r]?t[r]=s:t[r]=s.optional()}return new eo({...this._def,shape:()=>t})}required(e){let t={};for(let r of i.objectKeys(this.shape))if(e&&!e[r])t[r]=this.shape[r];else{let e=this.shape[r];for(;e instanceof eT;)e=e._def.innerType;t[r]=e}return new eo({...this._def,shape:()=>t})}keyof(){return eb(i.objectKeys(this.shape))}}eo.create=(e,t)=>new eo({shape:()=>e,unknownKeys:"strip",catchall:ea.create(),typeName:u.ZodObject,...C(t)}),eo.strictCreate=(e,t)=>new eo({shape:()=>e,unknownKeys:"strict",catchall:ea.create(),typeName:u.ZodObject,...C(t)}),eo.lazycreate=(e,t)=>new eo({shape:e,unknownKeys:"strip",catchall:ea.create(),typeName:u.ZodObject,...C(t)});class eu extends R{_parse(e){let{ctx:t}=this._processInputParams(e),r=this._def.options;if(t.common.async)return Promise.all(r.map(async e=>{let r={...t,common:{...t.common,issues:[]},parent:null};return{result:await e._parseAsync({data:t.data,path:t.path,parent:r}),ctx:r}})).then(function(e){for(let t of e)if("valid"===t.result.status)return t.result;for(let r of e)if("dirty"===r.result.status)return t.common.issues.push(...r.ctx.common.issues),r.result;let r=e.map(e=>new m(e.ctx.common.issues));return _(t,{code:f.invalid_union,unionErrors:r}),v});{let e,s=[];for(let a of r){let r={...t,common:{...t.common,issues:[]},parent:null},i=a._parseSync({data:t.data,path:t.path,parent:r});if("valid"===i.status)return i;"dirty"!==i.status||e||(e={result:i,ctx:r}),r.common.issues.length&&s.push(r.common.issues)}if(e)return t.common.issues.push(...e.ctx.common.issues),e.result;let a=s.map(e=>new m(e));return _(t,{code:f.invalid_union,unionErrors:a}),v}}get options(){return this._def.options}}eu.create=(e,t)=>new eu({options:e,typeName:u.ZodUnion,...C(t)});let el=e=>{if(e instanceof ey)return el(e.schema);if(e instanceof ex)return el(e.innerType());if(e instanceof e_)return[e.value];if(e instanceof ev)return e.options;if(e instanceof ew)return i.objectValues(e.enum);else if(e instanceof eI)return el(e._def.innerType);else if(e instanceof ee)return[void 0];else if(e instanceof et)return[null];else if(e instanceof eT)return[void 0,...el(e.unwrap())];else if(e instanceof ek)return[null,...el(e.unwrap())];else if(e instanceof eC)return el(e.unwrap());else if(e instanceof eO)return el(e.unwrap());else if(e instanceof eE)return el(e._def.innerType);else return[]};class eh extends R{_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==c.object)return _(t,{code:f.invalid_type,expected:c.object,received:t.parsedType}),v;let r=this.discriminator,s=t.data[r],a=this.optionsMap.get(s);return a?t.common.async?a._parseAsync({data:t.data,path:t.path,parent:t}):a._parseSync({data:t.data,path:t.path,parent:t}):(_(t,{code:f.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),v)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,r){let s=new Map;for(let r of t){let t=el(r.shape[e]);if(!t.length)throw Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let a of t){if(s.has(a))throw Error(`Discriminator property ${String(e)} has duplicate value ${String(a)}`);s.set(a,r)}}return new eh({typeName:u.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:s,...C(r)})}}class ed extends R{_parse(e){let{status:t,ctx:r}=this._processInputParams(e),s=(e,s)=>{if(x(e)||x(s))return v;let a=function e(t,r){let s=p(t),a=p(r);if(t===r)return{valid:!0,data:t};if(s===c.object&&a===c.object){let s=i.objectKeys(r),a=i.objectKeys(t).filter(e=>-1!==s.indexOf(e)),n={...t,...r};for(let s of a){let a=e(t[s],r[s]);if(!a.valid)return{valid:!1};n[s]=a.data}return{valid:!0,data:n}}if(s===c.array&&a===c.array){if(t.length!==r.length)return{valid:!1};let s=[];for(let a=0;a<t.length;a++){let i=e(t[a],r[a]);if(!i.valid)return{valid:!1};s.push(i.data)}return{valid:!0,data:s}}if(s===c.date&&a===c.date&&+t==+r)return{valid:!0,data:t};return{valid:!1}}(e.value,s.value);return a.valid?((T(e)||T(s))&&t.dirty(),{status:t.value,value:a.data}):(_(r,{code:f.invalid_intersection_types}),v)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then(([e,t])=>s(e,t)):s(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}}ed.create=(e,t,r)=>new ed({left:e,right:t,typeName:u.ZodIntersection,...C(r)});class ec extends R{_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==c.array)return _(r,{code:f.invalid_type,expected:c.array,received:r.parsedType}),v;if(r.data.length<this._def.items.length)return _(r,{code:f.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),v;!this._def.rest&&r.data.length>this._def.items.length&&(_(r,{code:f.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());let s=[...r.data].map((e,t)=>{let s=this._def.items[t]||this._def.rest;return s?s._parse(new E(r,e,r.path,t)):null}).filter(e=>!!e);return r.common.async?Promise.all(s).then(e=>b.mergeArray(t,e)):b.mergeArray(t,s)}get items(){return this._def.items}rest(e){return new ec({...this._def,rest:e})}}ec.create=(e,t)=>{if(!Array.isArray(e))throw Error("You must pass an array of schemas to z.tuple([ ... ])");return new ec({items:e,typeName:u.ZodTuple,rest:null,...C(t)})};class ep extends R{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==c.object)return _(r,{code:f.invalid_type,expected:c.object,received:r.parsedType}),v;let s=[],a=this._def.keyType,i=this._def.valueType;for(let e in r.data)s.push({key:a._parse(new E(r,e,r.path,e)),value:i._parse(new E(r,r.data[e],r.path,e)),alwaysSet:e in r.data});return r.common.async?b.mergeObjectAsync(t,s):b.mergeObjectSync(t,s)}get element(){return this._def.valueType}static create(e,t,r){return new ep(t instanceof R?{keyType:e,valueType:t,typeName:u.ZodRecord,...C(r)}:{keyType:W.create(),valueType:e,typeName:u.ZodRecord,...C(t)})}}class ef extends R{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==c.map)return _(r,{code:f.invalid_type,expected:c.map,received:r.parsedType}),v;let s=this._def.keyType,a=this._def.valueType,i=[...r.data.entries()].map(([e,t],i)=>({key:s._parse(new E(r,e,r.path,[i,"key"])),value:a._parse(new E(r,t,r.path,[i,"value"]))}));if(r.common.async){let e=new Map;return Promise.resolve().then(async()=>{for(let r of i){let s=await r.key,a=await r.value;if("aborted"===s.status||"aborted"===a.status)return v;("dirty"===s.status||"dirty"===a.status)&&t.dirty(),e.set(s.value,a.value)}return{status:t.value,value:e}})}{let e=new Map;for(let r of i){let s=r.key,a=r.value;if("aborted"===s.status||"aborted"===a.status)return v;("dirty"===s.status||"dirty"===a.status)&&t.dirty(),e.set(s.value,a.value)}return{status:t.value,value:e}}}}ef.create=(e,t,r)=>new ef({valueType:t,keyType:e,typeName:u.ZodMap,...C(r)});class em extends R{_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==c.set)return _(r,{code:f.invalid_type,expected:c.set,received:r.parsedType}),v;let s=this._def;null!==s.minSize&&r.data.size<s.minSize.value&&(_(r,{code:f.too_small,minimum:s.minSize.value,type:"set",inclusive:!0,exact:!1,message:s.minSize.message}),t.dirty()),null!==s.maxSize&&r.data.size>s.maxSize.value&&(_(r,{code:f.too_big,maximum:s.maxSize.value,type:"set",inclusive:!0,exact:!1,message:s.maxSize.message}),t.dirty());let a=this._def.valueType;function i(e){let r=new Set;for(let s of e){if("aborted"===s.status)return v;"dirty"===s.status&&t.dirty(),r.add(s.value)}return{status:t.value,value:r}}let n=[...r.data.values()].map((e,t)=>a._parse(new E(r,e,r.path,t)));return r.common.async?Promise.all(n).then(e=>i(e)):i(n)}min(e,t){return new em({...this._def,minSize:{value:e,message:o.toString(t)}})}max(e,t){return new em({...this._def,maxSize:{value:e,message:o.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}em.create=(e,t)=>new em({valueType:e,minSize:null,maxSize:null,typeName:u.ZodSet,...C(t)});class eg extends R{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==c.function)return _(t,{code:f.invalid_type,expected:c.function,received:t.parsedType}),v;function r(e,r){return y({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,g,g].filter(e=>!!e),issueData:{code:f.invalid_arguments,argumentsError:r}})}function s(e,r){return y({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,g,g].filter(e=>!!e),issueData:{code:f.invalid_return_type,returnTypeError:r}})}let a={errorMap:t.common.contextualErrorMap},i=t.data;if(this._def.returns instanceof eS){let e=this;return S(async function(...t){let n=new m([]),o=await e._def.args.parseAsync(t,a).catch(e=>{throw n.addIssue(r(t,e)),n}),u=await Reflect.apply(i,this,o);return await e._def.returns._def.type.parseAsync(u,a).catch(e=>{throw n.addIssue(s(u,e)),n})})}{let e=this;return S(function(...t){let n=e._def.args.safeParse(t,a);if(!n.success)throw new m([r(t,n.error)]);let o=Reflect.apply(i,this,n.data),u=e._def.returns.safeParse(o,a);if(!u.success)throw new m([s(o,u.error)]);return u.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new eg({...this._def,args:ec.create(e).rest(es.create())})}returns(e){return new eg({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,r){return new eg({args:e||ec.create([]).rest(es.create()),returns:t||es.create(),typeName:u.ZodFunction,...C(r)})}}class ey extends R{get schema(){return this._def.getter()}_parse(e){let{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}ey.create=(e,t)=>new ey({getter:e,typeName:u.ZodLazy,...C(t)});class e_ extends R{_parse(e){if(e.data!==this._def.value){let t=this._getOrReturnCtx(e);return _(t,{received:t.data,code:f.invalid_literal,expected:this._def.value}),v}return{status:"valid",value:e.data}}get value(){return this._def.value}}function eb(e,t){return new ev({values:e,typeName:u.ZodEnum,...C(t)})}e_.create=(e,t)=>new e_({value:e,typeName:u.ZodLiteral,...C(t)});class ev extends R{_parse(e){if("string"!=typeof e.data){let t=this._getOrReturnCtx(e),r=this._def.values;return _(t,{expected:i.joinValues(r),received:t.parsedType,code:f.invalid_type}),v}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){let t=this._getOrReturnCtx(e),r=this._def.values;return _(t,{received:t.data,code:f.invalid_enum_value,options:r}),v}return S(e.data)}get options(){return this._def.values}get enum(){let e={};for(let t of this._def.values)e[t]=t;return e}get Values(){let e={};for(let t of this._def.values)e[t]=t;return e}get Enum(){let e={};for(let t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return ev.create(e,{...this._def,...t})}exclude(e,t=this._def){return ev.create(this.options.filter(t=>!e.includes(t)),{...this._def,...t})}}ev.create=eb;class ew extends R{_parse(e){let t=i.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(e);if(r.parsedType!==c.string&&r.parsedType!==c.number){let e=i.objectValues(t);return _(r,{expected:i.joinValues(e),received:r.parsedType,code:f.invalid_type}),v}if(this._cache||(this._cache=new Set(i.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){let e=i.objectValues(t);return _(r,{received:r.data,code:f.invalid_enum_value,options:e}),v}return S(e.data)}get enum(){return this._def.values}}ew.create=(e,t)=>new ew({values:e,typeName:u.ZodNativeEnum,...C(t)});class eS extends R{unwrap(){return this._def.type}_parse(e){let{ctx:t}=this._processInputParams(e);return t.parsedType!==c.promise&&!1===t.common.async?(_(t,{code:f.invalid_type,expected:c.promise,received:t.parsedType}),v):S((t.parsedType===c.promise?t.data:Promise.resolve(t.data)).then(e=>this._def.type.parseAsync(e,{path:t.path,errorMap:t.common.contextualErrorMap})))}}eS.create=(e,t)=>new eS({type:e,typeName:u.ZodPromise,...C(t)});class ex extends R{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===u.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){let{status:t,ctx:r}=this._processInputParams(e),s=this._def.effect||null,a={addIssue:e=>{_(r,e),e.fatal?t.abort():t.dirty()},get path(){return r.path}};if(a.addIssue=a.addIssue.bind(a),"preprocess"===s.type){let e=s.transform(r.data,a);if(r.common.async)return Promise.resolve(e).then(async e=>{if("aborted"===t.value)return v;let s=await this._def.schema._parseAsync({data:e,path:r.path,parent:r});return"aborted"===s.status?v:"dirty"===s.status||"dirty"===t.value?w(s.value):s});{if("aborted"===t.value)return v;let s=this._def.schema._parseSync({data:e,path:r.path,parent:r});return"aborted"===s.status?v:"dirty"===s.status||"dirty"===t.value?w(s.value):s}}if("refinement"===s.type){let e=e=>{let t=s.refinement(e,a);if(r.common.async)return Promise.resolve(t);if(t instanceof Promise)throw Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return e};if(!1!==r.common.async)return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(r=>"aborted"===r.status?v:("dirty"===r.status&&t.dirty(),e(r.value).then(()=>({status:t.value,value:r.value}))));{let s=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return"aborted"===s.status?v:("dirty"===s.status&&t.dirty(),e(s.value),{status:t.value,value:s.value})}}if("transform"===s.type)if(!1!==r.common.async)return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(e=>k(e)?Promise.resolve(s.transform(e.value,a)).then(e=>({status:t.value,value:e})):v);else{let e=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!k(e))return v;let i=s.transform(e.value,a);if(i instanceof Promise)throw Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:i}}i.assertNever(s)}}ex.create=(e,t,r)=>new ex({schema:e,typeName:u.ZodEffects,effect:t,...C(r)}),ex.createWithPreprocess=(e,t,r)=>new ex({schema:t,effect:{type:"preprocess",transform:e},typeName:u.ZodEffects,...C(r)});class eT extends R{_parse(e){return this._getType(e)===c.undefined?S(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}eT.create=(e,t)=>new eT({innerType:e,typeName:u.ZodOptional,...C(t)});class ek extends R{_parse(e){return this._getType(e)===c.null?S(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}ek.create=(e,t)=>new ek({innerType:e,typeName:u.ZodNullable,...C(t)});class eI extends R{_parse(e){let{ctx:t}=this._processInputParams(e),r=t.data;return t.parsedType===c.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}eI.create=(e,t)=>new eI({innerType:e,typeName:u.ZodDefault,defaultValue:"function"==typeof t.default?t.default:()=>t.default,...C(t)});class eE extends R{_parse(e){let{ctx:t}=this._processInputParams(e),r={...t,common:{...t.common,issues:[]}},s=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return I(s)?s.then(e=>({status:"valid",value:"valid"===e.status?e.value:this._def.catchValue({get error(){return new m(r.common.issues)},input:r.data})})):{status:"valid",value:"valid"===s.status?s.value:this._def.catchValue({get error(){return new m(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}}eE.create=(e,t)=>new eE({innerType:e,typeName:u.ZodCatch,catchValue:"function"==typeof t.catch?t.catch:()=>t.catch,...C(t)});class eA extends R{_parse(e){if(this._getType(e)!==c.nan){let t=this._getOrReturnCtx(e);return _(t,{code:f.invalid_type,expected:c.nan,received:t.parsedType}),v}return{status:"valid",value:e.data}}}eA.create=e=>new eA({typeName:u.ZodNaN,...C(e)}),Symbol("zod_brand");class eC extends R{_parse(e){let{ctx:t}=this._processInputParams(e),r=t.data;return this._def.type._parse({data:r,path:t.path,parent:t})}unwrap(){return this._def.type}}class eR extends R{_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.common.async)return(async()=>{let e=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return"aborted"===e.status?v:"dirty"===e.status?(t.dirty(),w(e.value)):this._def.out._parseAsync({data:e.value,path:r.path,parent:r})})();{let e=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return"aborted"===e.status?v:"dirty"===e.status?(t.dirty(),{status:"dirty",value:e.value}):this._def.out._parseSync({data:e.value,path:r.path,parent:r})}}static create(e,t){return new eR({in:e,out:t,typeName:u.ZodPipeline})}}class eO extends R{_parse(e){let t=this._def.innerType._parse(e),r=e=>(k(e)&&(e.value=Object.freeze(e.value)),e);return I(t)?t.then(e=>r(e)):r(t)}unwrap(){return this._def.innerType}}eO.create=(e,t)=>new eO({innerType:e,typeName:u.ZodReadonly,...C(t)}),eo.lazycreate,function(e){e.ZodString="ZodString",e.ZodNumber="ZodNumber",e.ZodNaN="ZodNaN",e.ZodBigInt="ZodBigInt",e.ZodBoolean="ZodBoolean",e.ZodDate="ZodDate",e.ZodSymbol="ZodSymbol",e.ZodUndefined="ZodUndefined",e.ZodNull="ZodNull",e.ZodAny="ZodAny",e.ZodUnknown="ZodUnknown",e.ZodNever="ZodNever",e.ZodVoid="ZodVoid",e.ZodArray="ZodArray",e.ZodObject="ZodObject",e.ZodUnion="ZodUnion",e.ZodDiscriminatedUnion="ZodDiscriminatedUnion",e.ZodIntersection="ZodIntersection",e.ZodTuple="ZodTuple",e.ZodRecord="ZodRecord",e.ZodMap="ZodMap",e.ZodSet="ZodSet",e.ZodFunction="ZodFunction",e.ZodLazy="ZodLazy",e.ZodLiteral="ZodLiteral",e.ZodEnum="ZodEnum",e.ZodEffects="ZodEffects",e.ZodNativeEnum="ZodNativeEnum",e.ZodOptional="ZodOptional",e.ZodNullable="ZodNullable",e.ZodDefault="ZodDefault",e.ZodCatch="ZodCatch",e.ZodPromise="ZodPromise",e.ZodBranded="ZodBranded",e.ZodPipeline="ZodPipeline",e.ZodReadonly="ZodReadonly"}(u||(u={})),W.create,Y.create,eA.create,H.create,G.create,X.create,Q.create,ee.create,et.create,er.create,es.create,ea.create,ei.create,en.create,eo.create,eo.strictCreate,eu.create,eh.create,ed.create,ec.create,ep.create,ef.create,em.create,eg.create,ey.create,e_.create,ev.create,ew.create,eS.create,ex.create,eT.create,ek.create,ex.createWithPreprocess,eR.create;let eP=Symbol("Let zodToJsonSchema decide on which parser to use"),eM={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},eN=e=>"string"==typeof e?{...eM,name:e}:{...eM,...e},eB=e=>{let t=eN(e),r=void 0!==t.name?[...t.basePath,t.definitionPath,t.name]:t.basePath;return{...t,currentPath:r,propertyPath:void 0,seen:new Map(Object.entries(t.definitions).map(([e,r])=>[r._def,{def:r._def,path:[...t.basePath,t.definitionPath,e],jsonSchema:void 0}]))}};function ej(e,t,r,s){s?.errorMessages&&r&&(e.errorMessage={...e.errorMessage,[t]:r})}function eZ(e,t,r,s,a){e[t]=r,ej(e,t,s,a)}function eL(e,t){return e2(e.type._def,t)}let e$=(e,t)=>e2(e.innerType._def,t),eD=(e,t)=>{let r={type:"integer",format:"unix-time"};if("openApi3"===t.target)return r;for(let s of e.checks)switch(s.kind){case"min":eZ(r,"minimum",s.value,s.message,t);break;case"max":eZ(r,"maximum",s.value,s.message,t)}return r},eU=e=>(!("type"in e)||"string"!==e.type)&&"allOf"in e,eF={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(void 0===a&&(a=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),a),ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function ez(e,t){let r={type:"string"};if(e.checks)for(let s of e.checks)switch(s.kind){case"min":eZ(r,"minLength","number"==typeof r.minLength?Math.max(r.minLength,s.value):s.value,s.message,t);break;case"max":eZ(r,"maxLength","number"==typeof r.maxLength?Math.min(r.maxLength,s.value):s.value,s.message,t);break;case"email":switch(t.emailStrategy){case"format:email":eJ(r,"email",s.message,t);break;case"format:idn-email":eJ(r,"idn-email",s.message,t);break;case"pattern:zod":eK(r,eF.email,s.message,t)}break;case"url":eJ(r,"uri",s.message,t);break;case"uuid":eJ(r,"uuid",s.message,t);break;case"regex":eK(r,s.regex,s.message,t);break;case"cuid":eK(r,eF.cuid,s.message,t);break;case"cuid2":eK(r,eF.cuid2,s.message,t);break;case"startsWith":eK(r,RegExp(`^${eq(s.value,t)}`),s.message,t);break;case"endsWith":eK(r,RegExp(`${eq(s.value,t)}$`),s.message,t);break;case"datetime":eJ(r,"date-time",s.message,t);break;case"date":eJ(r,"date",s.message,t);break;case"time":eJ(r,"time",s.message,t);break;case"duration":eJ(r,"duration",s.message,t);break;case"length":eZ(r,"minLength","number"==typeof r.minLength?Math.max(r.minLength,s.value):s.value,s.message,t),eZ(r,"maxLength","number"==typeof r.maxLength?Math.min(r.maxLength,s.value):s.value,s.message,t);break;case"includes":eK(r,RegExp(eq(s.value,t)),s.message,t);break;case"ip":"v6"!==s.version&&eJ(r,"ipv4",s.message,t),"v4"!==s.version&&eJ(r,"ipv6",s.message,t);break;case"base64url":eK(r,eF.base64url,s.message,t);break;case"jwt":eK(r,eF.jwt,s.message,t);break;case"cidr":"v6"!==s.version&&eK(r,eF.ipv4Cidr,s.message,t),"v4"!==s.version&&eK(r,eF.ipv6Cidr,s.message,t);break;case"emoji":eK(r,eF.emoji(),s.message,t);break;case"ulid":eK(r,eF.ulid,s.message,t);break;case"base64":switch(t.base64Strategy){case"format:binary":eJ(r,"binary",s.message,t);break;case"contentEncoding:base64":eZ(r,"contentEncoding","base64",s.message,t);break;case"pattern:zod":eK(r,eF.base64,s.message,t)}break;case"nanoid":eK(r,eF.nanoid,s.message,t)}return r}function eq(e,t){return"escape"===t.patternStrategy?function(e){let t="";for(let r=0;r<e.length;r++)eV.has(e[r])||(t+="\\"),t+=e[r];return t}(e):e}let eV=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function eJ(e,t,r,s){e.format||e.anyOf?.some(e=>e.format)?(e.anyOf||(e.anyOf=[]),e.format&&(e.anyOf.push({format:e.format,...e.errorMessage&&s.errorMessages&&{errorMessage:{format:e.errorMessage.format}}}),delete e.format,e.errorMessage&&(delete e.errorMessage.format,0===Object.keys(e.errorMessage).length&&delete e.errorMessage)),e.anyOf.push({format:t,...r&&s.errorMessages&&{errorMessage:{format:r}}})):eZ(e,"format",t,r,s)}function eK(e,t,r,s){e.pattern||e.allOf?.some(e=>e.pattern)?(e.allOf||(e.allOf=[]),e.pattern&&(e.allOf.push({pattern:e.pattern,...e.errorMessage&&s.errorMessages&&{errorMessage:{pattern:e.errorMessage.pattern}}}),delete e.pattern,e.errorMessage&&(delete e.errorMessage.pattern,0===Object.keys(e.errorMessage).length&&delete e.errorMessage)),e.allOf.push({pattern:eW(t,s),...r&&s.errorMessages&&{errorMessage:{pattern:r}}})):eZ(e,"pattern",eW(t,s),r,s)}function eW(e,t){if(!t.applyRegexFlags||!e.flags)return e.source;let r={i:e.flags.includes("i"),m:e.flags.includes("m"),s:e.flags.includes("s")},s=r.i?e.source.toLowerCase():e.source,a="",i=!1,n=!1,o=!1;for(let e=0;e<s.length;e++){if(i){a+=s[e],i=!1;continue}if(r.i){if(n){if(s[e].match(/[a-z]/)){o?(a+=s[e],a+=`${s[e-2]}-${s[e]}`.toUpperCase(),o=!1):"-"===s[e+1]&&s[e+2]?.match(/[a-z]/)?(a+=s[e],o=!0):a+=`${s[e]}${s[e].toUpperCase()}`;continue}}else if(s[e].match(/[a-z]/)){a+=`[${s[e]}${s[e].toUpperCase()}]`;continue}}if(r.m){if("^"===s[e]){a+=`(^|(?<=[\r
]))`;continue}else if("$"===s[e]){a+=`($|(?=[\r
]))`;continue}}if(r.s&&"."===s[e]){a+=n?`${s[e]}\r
`:`[${s[e]}\r
]`;continue}a+=s[e],"\\"===s[e]?i=!0:n&&"]"===s[e]?n=!1:n||"["!==s[e]||(n=!0)}try{new RegExp(a)}catch{return console.warn(`Could not convert regex pattern at ${t.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),e.source}return a}function eY(e,t){if("openAi"===t.target&&console.warn("Warning: OpenAI may not support records in schemas! Try an array of key-value pairs instead."),"openApi3"===t.target&&e.keyType?._def.typeName===u.ZodEnum)return{type:"object",required:e.keyType._def.values,properties:e.keyType._def.values.reduce((r,s)=>({...r,[s]:e2(e.valueType._def,{...t,currentPath:[...t.currentPath,"properties",s]})??{}}),{}),additionalProperties:t.rejectedAdditionalProperties};let r={type:"object",additionalProperties:e2(e.valueType._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??t.allowedAdditionalProperties};if("openApi3"===t.target)return r;if(e.keyType?._def.typeName===u.ZodString&&e.keyType._def.checks?.length){let{type:s,...a}=ez(e.keyType._def,t);return{...r,propertyNames:a}}if(e.keyType?._def.typeName===u.ZodEnum)return{...r,propertyNames:{enum:e.keyType._def.values}};if(e.keyType?._def.typeName===u.ZodBranded&&e.keyType._def.type._def.typeName===u.ZodString&&e.keyType._def.type._def.checks?.length){let{type:s,...a}=eL(e.keyType._def,t);return{...r,propertyNames:a}}return r}let eH={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"},eG=(e,t)=>{let r=(e.options instanceof Map?Array.from(e.options.values()):e.options).map((e,r)=>e2(e._def,{...t,currentPath:[...t.currentPath,"anyOf",`${r}`]})).filter(e=>!!e&&(!t.strictUnions||"object"==typeof e&&Object.keys(e).length>0));return r.length?{anyOf:r}:void 0},eX=(e,t)=>{if(t.currentPath.toString()===t.propertyPath?.toString())return e2(e.innerType._def,t);let r=e2(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","1"]});return r?{anyOf:[{not:{}},r]}:{}},eQ=(e,t)=>{if("input"===t.pipeStrategy)return e2(e.in._def,t);if("output"===t.pipeStrategy)return e2(e.out._def,t);let r=e2(e.in._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),s=e2(e.out._def,{...t,currentPath:[...t.currentPath,"allOf",r?"1":"0"]});return{allOf:[r,s].filter(e=>void 0!==e)}},e0=(e,t)=>e2(e.innerType._def,t),e1=(e,t,r)=>{switch(t){case u.ZodString:return ez(e,r);case u.ZodNumber:return function(e,t){let r={type:"number"};if(!e.checks)return r;for(let s of e.checks)switch(s.kind){case"int":r.type="integer",ej(r,"type",s.message,t);break;case"min":"jsonSchema7"===t.target?s.inclusive?eZ(r,"minimum",s.value,s.message,t):eZ(r,"exclusiveMinimum",s.value,s.message,t):(s.inclusive||(r.exclusiveMinimum=!0),eZ(r,"minimum",s.value,s.message,t));break;case"max":"jsonSchema7"===t.target?s.inclusive?eZ(r,"maximum",s.value,s.message,t):eZ(r,"exclusiveMaximum",s.value,s.message,t):(s.inclusive||(r.exclusiveMaximum=!0),eZ(r,"maximum",s.value,s.message,t));break;case"multipleOf":eZ(r,"multipleOf",s.value,s.message,t)}return r}(e,r);case u.ZodObject:return function(e,t){let r="openAi"===t.target,s={type:"object",properties:{}},a=[],i=e.shape();for(let e in i){let n=i[e];if(void 0===n||void 0===n._def)continue;let o=function(e){try{return e.isOptional()}catch{return!0}}(n);o&&r&&(n instanceof eT&&(n=n._def.innerType),n.isNullable()||(n=n.nullable()),o=!1);let u=e2(n._def,{...t,currentPath:[...t.currentPath,"properties",e],propertyPath:[...t.currentPath,"properties",e]});void 0!==u&&(s.properties[e]=u,o||a.push(e))}a.length&&(s.required=a);let n=function(e,t){if("ZodNever"!==e.catchall._def.typeName)return e2(e.catchall._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]});switch(e.unknownKeys){case"passthrough":return t.allowedAdditionalProperties;case"strict":return t.rejectedAdditionalProperties;case"strip":return"strict"===t.removeAdditionalStrategy?t.allowedAdditionalProperties:t.rejectedAdditionalProperties}}(e,t);return void 0!==n&&(s.additionalProperties=n),s}(e,r);case u.ZodBigInt:return function(e,t){let r={type:"integer",format:"int64"};if(!e.checks)return r;for(let s of e.checks)switch(s.kind){case"min":"jsonSchema7"===t.target?s.inclusive?eZ(r,"minimum",s.value,s.message,t):eZ(r,"exclusiveMinimum",s.value,s.message,t):(s.inclusive||(r.exclusiveMinimum=!0),eZ(r,"minimum",s.value,s.message,t));break;case"max":"jsonSchema7"===t.target?s.inclusive?eZ(r,"maximum",s.value,s.message,t):eZ(r,"exclusiveMaximum",s.value,s.message,t):(s.inclusive||(r.exclusiveMaximum=!0),eZ(r,"maximum",s.value,s.message,t));break;case"multipleOf":eZ(r,"multipleOf",s.value,s.message,t)}return r}(e,r);case u.ZodBoolean:return{type:"boolean"};case u.ZodDate:return function e(t,r,s){let a=s??r.dateStrategy;if(Array.isArray(a))return{anyOf:a.map((s,a)=>e(t,r,s))};switch(a){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return eD(t,r)}}(e,r);case u.ZodUndefined:return{not:{}};case u.ZodNull:return"openApi3"===r.target?{enum:["null"],nullable:!0}:{type:"null"};case u.ZodArray:return function(e,t){let r={type:"array"};return e.type?._def&&e.type?._def?.typeName!==u.ZodAny&&(r.items=e2(e.type._def,{...t,currentPath:[...t.currentPath,"items"]})),e.minLength&&eZ(r,"minItems",e.minLength.value,e.minLength.message,t),e.maxLength&&eZ(r,"maxItems",e.maxLength.value,e.maxLength.message,t),e.exactLength&&(eZ(r,"minItems",e.exactLength.value,e.exactLength.message,t),eZ(r,"maxItems",e.exactLength.value,e.exactLength.message,t)),r}(e,r);case u.ZodUnion:case u.ZodDiscriminatedUnion:return function(e,t){if("openApi3"===t.target)return eG(e,t);let r=e.options instanceof Map?Array.from(e.options.values()):e.options;if(r.every(e=>e._def.typeName in eH&&(!e._def.checks||!e._def.checks.length))){let e=r.reduce((e,t)=>{let r=eH[t._def.typeName];return r&&!e.includes(r)?[...e,r]:e},[]);return{type:e.length>1?e:e[0]}}if(r.every(e=>"ZodLiteral"===e._def.typeName&&!e.description)){let e=r.reduce((e,t)=>{let r=typeof t._def.value;switch(r){case"string":case"number":case"boolean":return[...e,r];case"bigint":return[...e,"integer"];case"object":if(null===t._def.value)return[...e,"null"];default:return e}},[]);if(e.length===r.length){let t=e.filter((e,t,r)=>r.indexOf(e)===t);return{type:t.length>1?t:t[0],enum:r.reduce((e,t)=>e.includes(t._def.value)?e:[...e,t._def.value],[])}}}else if(r.every(e=>"ZodEnum"===e._def.typeName))return{type:"string",enum:r.reduce((e,t)=>[...e,...t._def.values.filter(t=>!e.includes(t))],[])};return eG(e,t)}(e,r);case u.ZodIntersection:return function(e,t){let r=[e2(e.left._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),e2(e.right._def,{...t,currentPath:[...t.currentPath,"allOf","1"]})].filter(e=>!!e),s="jsonSchema2019-09"===t.target?{unevaluatedProperties:!1}:void 0,a=[];return r.forEach(e=>{if(eU(e))a.push(...e.allOf),void 0===e.unevaluatedProperties&&(s=void 0);else{let t=e;if("additionalProperties"in e&&!1===e.additionalProperties){let{additionalProperties:r,...s}=e;t=s}else s=void 0;a.push(t)}}),a.length?{allOf:a,...s}:void 0}(e,r);case u.ZodTuple:return function(e,t){return e.rest?{type:"array",minItems:e.items.length,items:e.items.map((e,r)=>e2(e._def,{...t,currentPath:[...t.currentPath,"items",`${r}`]})).reduce((e,t)=>void 0===t?e:[...e,t],[]),additionalItems:e2(e.rest._def,{...t,currentPath:[...t.currentPath,"additionalItems"]})}:{type:"array",minItems:e.items.length,maxItems:e.items.length,items:e.items.map((e,r)=>e2(e._def,{...t,currentPath:[...t.currentPath,"items",`${r}`]})).reduce((e,t)=>void 0===t?e:[...e,t],[])}}(e,r);case u.ZodRecord:return eY(e,r);case u.ZodLiteral:return function(e,t){let r=typeof e.value;return"bigint"!==r&&"number"!==r&&"boolean"!==r&&"string"!==r?{type:Array.isArray(e.value)?"array":"object"}:"openApi3"===t.target?{type:"bigint"===r?"integer":r,enum:[e.value]}:{type:"bigint"===r?"integer":r,const:e.value}}(e,r);case u.ZodEnum:return{type:"string",enum:Array.from(e.values)};case u.ZodNativeEnum:return function(e){let t=e.values,r=Object.keys(e.values).filter(e=>"number"!=typeof t[t[e]]).map(e=>t[e]),s=Array.from(new Set(r.map(e=>typeof e)));return{type:1===s.length?"string"===s[0]?"string":"number":["string","number"],enum:r}}(e);case u.ZodNullable:return function(e,t){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(e.innerType._def.typeName)&&(!e.innerType._def.checks||!e.innerType._def.checks.length))return"openApi3"===t.target?{type:eH[e.innerType._def.typeName],nullable:!0}:{type:[eH[e.innerType._def.typeName],"null"]};if("openApi3"===t.target){let r=e2(e.innerType._def,{...t,currentPath:[...t.currentPath]});return r&&"$ref"in r?{allOf:[r],nullable:!0}:r&&{...r,nullable:!0}}let r=e2(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","0"]});return r&&{anyOf:[r,{type:"null"}]}}(e,r);case u.ZodOptional:return eX(e,r);case u.ZodMap:return function(e,t){return"record"===t.mapStrategy?eY(e,t):{type:"array",maxItems:125,items:{type:"array",items:[e2(e.keyType._def,{...t,currentPath:[...t.currentPath,"items","items","0"]})||{},e2(e.valueType._def,{...t,currentPath:[...t.currentPath,"items","items","1"]})||{}],minItems:2,maxItems:2}}}(e,r);case u.ZodSet:return function(e,t){let r={type:"array",uniqueItems:!0,items:e2(e.valueType._def,{...t,currentPath:[...t.currentPath,"items"]})};return e.minSize&&eZ(r,"minItems",e.minSize.value,e.minSize.message,t),e.maxSize&&eZ(r,"maxItems",e.maxSize.value,e.maxSize.message,t),r}(e,r);case u.ZodLazy:return()=>e.getter()._def;case u.ZodPromise:return e2(e.type._def,r);case u.ZodNaN:case u.ZodNever:return{not:{}};case u.ZodEffects:return function(e,t){return"input"===t.effectStrategy?e2(e.schema._def,t):{}}(e,r);case u.ZodAny:case u.ZodUnknown:return{};case u.ZodDefault:return function(e,t){return{...e2(e.innerType._def,t),default:e.defaultValue()}}(e,r);case u.ZodBranded:return eL(e,r);case u.ZodReadonly:return e0(e,r);case u.ZodCatch:return e$(e,r);case u.ZodPipeline:return eQ(e,r);case u.ZodFunction:case u.ZodVoid:case u.ZodSymbol:default:return}};function e2(e,t,r=!1){let s=t.seen.get(e);if(t.override){let a=t.override?.(e,t,s,r);if(a!==eP)return a}if(s&&!r){let e=e4(s,t);if(void 0!==e)return e}let a={def:e,path:t.currentPath,jsonSchema:void 0};t.seen.set(e,a);let i=e1(e,e.typeName,t),n="function"==typeof i?e2(i(),t):i;if(n&&e5(e,t,n),t.postProcess){let r=t.postProcess(n,e,t);return a.jsonSchema=n,r}return a.jsonSchema=n,n}let e4=(e,t)=>{switch(t.$refStrategy){case"root":return{$ref:e.path.join("/")};case"relative":return{$ref:e9(t.currentPath,e.path)};case"none":case"seen":if(e.path.length<t.currentPath.length&&e.path.every((e,r)=>t.currentPath[r]===e))return console.warn(`Recursive reference detected at ${t.currentPath.join("/")}! Defaulting to any`),{};return"seen"===t.$refStrategy?{}:void 0}},e9=(e,t)=>{let r=0;for(;r<e.length&&r<t.length&&e[r]===t[r];r++);return[(e.length-r).toString(),...t.slice(r)].join("/")},e5=(e,t,r)=>(e.description&&(r.description=e.description,t.markdownDescription&&(r.markdownDescription=e.description)),r),e6=(e,t)=>{let r=eB(t),s="object"==typeof t&&t.definitions?Object.entries(t.definitions).reduce((e,[t,s])=>({...e,[t]:e2(s._def,{...r,currentPath:[...r.basePath,r.definitionPath,t]},!0)??{}}),{}):void 0,a="string"==typeof t?t:t?.nameStrategy==="title"?void 0:t?.name,i=e2(e._def,void 0===a?r:{...r,currentPath:[...r.basePath,r.definitionPath,a]},!1)??{},n="object"==typeof t&&void 0!==t.name&&"title"===t.nameStrategy?t.name:void 0;void 0!==n&&(i.title=n);let o=void 0===a?s?{...i,[r.definitionPath]:s}:i:{$ref:[..."relative"===r.$refStrategy?[]:r.basePath,r.definitionPath,a].join("/"),[r.definitionPath]:{...s,[a]:i}};return"jsonSchema7"===r.target?o.$schema="http://json-schema.org/draft-07/schema#":("jsonSchema2019-09"===r.target||"openAi"===r.target)&&(o.$schema="https://json-schema.org/draft/2019-09/schema#"),"openAi"===r.target&&("anyOf"in o||"oneOf"in o||"allOf"in o||"type"in o&&Array.isArray(o.type))&&console.warn("Warning: OpenAI may not support schemas with unions as roots! Try wrapping it in an object property."),o};var e3=e=>Object.entries(e).map(([e,t])=>({type:"function",name:e,...t.description?{description:t.description}:void 0,parameters:t.parameters instanceof R?e6(t.parameters):t.parameters})),e8=()=>{let e=[],t={role:"assistant",content:[]},r={role:"tool",content:[]};return{addTextContentPart:s=>{r.content.length>0&&(e.push(t),e.push(r),t={role:"assistant",content:[]},r={role:"tool",content:[]}),t.content.push(s)},addToolCallPart:e=>{t.content.push({type:"tool-call",toolCallId:e.toolCallId,toolName:e.toolName,args:e.args}),r.content.push({type:"tool-result",toolCallId:e.toolCallId,toolName:e.toolName,..."artifact"in e?{artifact:e.artifact}:{},result:void 0===e.result?"Error: tool is has no configured code to run":e.result,isError:e.isError??void 0===e.result})},getMessages:()=>r.content.length>0?[...e,t,r]:[...e,t]}},e7=function(){let e,t,r=new Promise((r,s)=>{e=r,t=s});if(!e||!t)throw Error("Failed to create promise");return{promise:r,resolve:e,reject:t}},te=()=>{let e,t,r=[],s=!1,a=a=>{a.promise||(a.promise=a.reader.read().then(({done:i,value:n})=>{a.promise=void 0,i?(r.splice(r.indexOf(a),1),s&&0===r.length&&e.close()):e.enqueue(n),t?.resolve(),t=void 0}).catch(s=>{console.error(s),r.forEach(e=>{e.reader.cancel()}),r.length=0,e.error(s),t?.reject(s),t=void 0}))};return{readable:new ReadableStream({start(t){e=t},pull:()=>(t=e7(),r.forEach(e=>{a(e)}),t.promise),cancel(){r.forEach(e=>{e.reader.cancel()}),r.length=0}}),isSealed:()=>s,seal(){s=!0,0===r.length&&e.close()},addStream(e){if(s)throw Error("Cannot add streams after the run callback has settled.");let t={reader:e.getReader()};r.push(t),a(t)},enqueue(e){this.addStream(new ReadableStream({start(t){t.enqueue(e),t.close()}}))}}},tt=class{_controller;_isClosed=!1;constructor(e){this._controller=e}append(e){return this._controller.enqueue({type:"text-delta",path:[],textDelta:e}),this}close(){this._isClosed||(this._isClosed=!0,this._controller.enqueue({type:"part-finish",path:[]}),this._controller.close())}},tr=e=>new ReadableStream({start:t=>e.start?.(new tt(t)),pull:t=>e.pull?.(new tt(t)),cancel:t=>e.cancel?.(t)}),ts=()=>{let e;return[tr({start(t){e=t}}),e]},ta=class{constructor(e){this._controller=e;let t=tr({start:e=>{this._argsTextController=e}});this._mergeTask=t.pipeTo(new WritableStream({write:e=>{switch(e.type){case"text-delta":this._controller.enqueue(e);break;case"part-finish":this._controller.enqueue({type:"tool-call-args-text-finish",path:[]});break;default:throw Error(`Unexpected chunk type: ${e.type}`)}}}))}_isClosed=!1;_mergeTask;get argsText(){return this._argsTextController}_argsTextController;async setResponse(e){this._argsTextController.close(),await Promise.resolve(),this._controller.enqueue({type:"result",path:[],...void 0!==e.artifact?{artifact:e.artifact}:{},result:e.result,isError:e.isError??!1})}async close(){this._isClosed||(this._isClosed=!0,this._argsTextController.close(),await this._mergeTask,this._controller.enqueue({type:"part-finish",path:[]}),this._controller.close())}},ti=e=>new ReadableStream({start:t=>e.start?.(new ta(t)),pull:t=>e.pull?.(new ta(t)),cancel:t=>e.cancel?.(t)}),tn=()=>{let e;return[ti({start(t){e=t}}),e]},to=class{value=-1;up(){return++this.value}},tu=class extends TransformStream{constructor(e){super({transform(t,r){r.enqueue({...t,path:[e,...t.path]})}})}};TransformStream;var tl=class extends TransformStream{constructor(e){let t=new to,r=new Map;super({transform(s,a){"part-start"===s.type&&0===s.path.length&&r.set(t.up(),e.up());let[i,...n]=s.path;if(void 0===i)return void a.enqueue(s);let o=r.get(i);if(void 0===o)throw Error("Path not found");a.enqueue({...s,path:[o,...n]})}})}},th=((e,t=21)=>(r=t)=>{let s="",a=0|r;for(;a--;)s+=e[Math.random()*e.length|0];return s})("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",7),td=class{_merger=te();_append;_contentCounter=new to;get __internal_isClosed(){return this._merger.isSealed()}__internal_getReadable(){return this._merger.readable}_closeSubscriber;__internal_subscribeToClose(e){this._closeSubscriber=e}_addPart(e,t){this._append&&(this._append.controller.close(),this._append=void 0),this.enqueue({type:"part-start",part:e,path:[]}),this._merger.addStream(t.pipeThrough(new tu(this._contentCounter.value)))}merge(e){this._merger.addStream(e.pipeThrough(new tl(this._contentCounter)))}appendText(e){this._append?.kind!=="text"&&(this._append={kind:"text",controller:this.addTextPart()}),this._append.controller.append(e)}appendReasoning(e){this._append?.kind!=="reasoning"&&(this._append={kind:"reasoning",controller:this.addReasoningPart()}),this._append.controller.append(e)}addTextPart(){let[e,t]=ts();return this._addPart({type:"text"},e),t}addReasoningPart(){let[e,t]=ts();return this._addPart({type:"reasoning"},e),t}addToolCallPart(e){let t="string"==typeof e?{toolName:e}:e,r=t.toolName,s=t.toolCallId??th(),[a,i]=tn();return this._addPart({type:"tool-call",toolName:r,toolCallId:s},a),void 0!==t.argsText&&(i.argsText.append(t.argsText),i.argsText.close()),void 0!==t.args&&(i.argsText.append(JSON.stringify(t.args)),i.argsText.close()),void 0!==t.response&&i.setResponse(t.response),i}appendSource(e){this._addPart(e,new ReadableStream({start(e){e.enqueue({type:"part-finish",path:[]}),e.close()}}))}appendFile(e){this._addPart(e,new ReadableStream({start(e){e.enqueue({type:"part-finish",path:[]}),e.close()}}))}enqueue(e){this._merger.enqueue(e),"part-start"===e.type&&0===e.path.length&&this._contentCounter.up()}close(){this._merger.seal(),this._append?.controller?.close(),this._closeSubscriber?.()}},tc=class extends TransformStream{constructor(e,t,r){let s,[a,i]=function(){let e,{resolve:t,promise:r}=e7();return[function(e){let t,r=new td;try{t=e(r)}catch(e){throw r.__internal_isClosed||(r.enqueue({type:"error",path:[],error:String(e)}),r.close()),e}return t instanceof Promise?(async()=>{try{await t}catch(e){throw r.__internal_isClosed||r.enqueue({type:"error",path:[],error:String(e)}),e}finally{r.__internal_isClosed||r.close()}})():r.__internal_isClosed||r.close(),r.__internal_getReadable()}(s=>((e=s).__internal_subscribeToClose(t),r)),e]}();super({start:t=>(s=a.pipeTo(new WritableStream({write(e){t.enqueue(e)},abort(e){t.error(e)},close(){t.terminate()}})).catch(e=>{t.error(e)}),e.start?.(i)),transform:t=>e.transform?.(t,i),async flush(){await e.flush?.(i),i.close(),await s}},t,r)}},tp=class extends TransformStream{constructor(e){super(),Object.defineProperty(this,"readable",{value:e(super.readable),writable:!1})}},tf=(e=>(e.TextDelta="0",e.Data="2",e.Error="3",e.Annotation="8",e.ToolCall="9",e.ToolCallResult="a",e.StartToolCall="b",e.ToolCallArgsTextDelta="c",e.FinishMessage="d",e.FinishStep="e",e.StartStep="f",e.ReasoningDelta="g",e.Source="h",e.RedactedReasoning="i",e.ReasoningSignature="j",e.File="k",e.AuiUpdateStateOperations="aui-state",e))(tf||{}),tm=class extends TransformStream{buffer="";constructor(){super({transform:(e,t)=>{this.buffer+=e;let r=this.buffer.split("\n");for(let e=0;e<r.length-1;e++)t.enqueue(r[e]);this.buffer=r[r.length-1]||""},flush:()=>{if(this.buffer)throw Error(`Stream ended with an incomplete line: "${this.buffer}"`)}})}},tg=(TransformStream,class extends TransformStream{constructor(){super({transform:(e,t)=>{let r=e.indexOf(":");if(-1===r)throw Error("Invalid stream part");t.enqueue({type:e.slice(0,r),value:JSON.parse(e.slice(r+1))})}})}}),ty=class extends TransformStream{constructor(){let e=[];super({transform(t,r){if("part-start"===t.type)return 0!==t.path.length?void r.error(Error("Nested parts are not supported")):(e.push(t.part),void r.enqueue(t));if("text-delta"===t.type||"result"===t.type||"part-finish"===t.type||"tool-call-args-text-finish"===t.type){if(1!==t.path.length)return void r.error(Error(`${t.type} chunks must have a path of length 1`));let s=t.path[0];if(s<0||s>=e.length)return void r.error(Error(`Invalid path index: ${s}`));let a=e[s];return void r.enqueue({...t,meta:a})}r.enqueue(t)}})}},t_=[tf.StartToolCall,tf.ToolCall,tf.TextDelta,tf.ReasoningDelta,tf.Source,tf.Error,tf.FinishStep,tf.FinishMessage],tb=class extends tp{constructor(){super(e=>{let t,r=new Map,s=new tc({transform(e,s){let{type:a,value:i}=e;switch(t_.includes(a)&&(t?.close(),t=void 0),a){case tf.ReasoningDelta:s.appendReasoning(i);break;case tf.TextDelta:s.appendText(i);break;case tf.StartToolCall:{let{toolCallId:e,toolName:a}=i,n=s.addToolCallPart({toolCallId:e,toolName:a});r.set(e,n),t=n.argsText;break}case tf.ToolCallArgsTextDelta:{let{toolCallId:e,argsTextDelta:t}=i,s=r.get(e);if(!s)throw Error("Encountered tool call with unknown id: "+e);s.argsText.append(t);break}case tf.ToolCallResult:{let{toolCallId:e,artifact:t,result:s,isError:a}=i,n=r.get(e);if(!n)throw Error("Encountered tool call result with unknown id: "+e);n.setResponse({artifact:t,result:s,isError:a});break}case tf.ToolCall:{let{toolCallId:e,toolName:t,args:a}=i,n=r.get(e);n?n.argsText.close():(n=s.addToolCallPart({toolCallId:e,toolName:t,args:a}),r.set(e,n));break}case tf.FinishMessage:s.enqueue({type:"message-finish",path:[],...i});break;case tf.StartStep:s.enqueue({type:"step-start",path:[],...i});break;case tf.FinishStep:s.enqueue({type:"step-finish",path:[],...i});break;case tf.Data:s.enqueue({type:"data",path:[],data:i});break;case tf.Annotation:s.enqueue({type:"annotations",path:[],annotations:i});break;case tf.Source:s.appendSource({type:"source",...i});break;case tf.Error:s.enqueue({type:"error",path:[],error:i});break;case tf.File:s.appendFile({type:"file",...i});break;case tf.AuiUpdateStateOperations:s.enqueue({type:"update-state",path:[],operations:i});break;case tf.ReasoningSignature:case tf.RedactedReasoning:break;default:throw Error(`unsupported chunk type: ${a}`)}},flush(){t?.close(),t=void 0,r.forEach(e=>e.close()),r.clear()}});return e.pipeThrough(new TextDecoderStream).pipeThrough(new tm).pipeThrough(new tg).pipeThrough(s)})}},tv=Symbol.for("aui.tool-response"),tw=class e{get[tv](){return!0}artifact;result;isError;constructor(e){void 0!==e.artifact&&(this.artifact=e.artifact),this.result=e.result,this.isError=e.isError??!1}static[Symbol.hasInstance](e){return"object"==typeof e&&null!==e&&tv in e}static toResponse(t){return t instanceof e?t:new e({result:void 0===t?"<no result>":t})}},tS=r(4211),tx=Symbol("aui.parse-partial-json-object.meta"),tT=e=>e?.[tx],tk=e=>{if(0===e.length)return{[tx]:{state:"partial",partialPath:[]}};try{let t=tS.parse(e);if("object"!=typeof t||null===t)throw Error("argsText is expected to be an object");return t[tx]={state:"complete",partialPath:[]},t}catch{try{let[t,r]=function(e){let t,r=["ROOT"],s=-1,a=null,i=[];function n(){void 0!==t&&(i.push(JSON.parse('"'+t+'"')),t=void 0)}function o(e,t,i){switch(e){case'"':s=t,r.pop(),r.push(i),r.push("INSIDE_STRING"),n();break;case"f":case"t":case"n":s=t,a=t,r.pop(),r.push(i),r.push("INSIDE_LITERAL");break;case"-":r.pop(),r.push(i),r.push("INSIDE_NUMBER"),n();break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":s=t,r.pop(),r.push(i),r.push("INSIDE_NUMBER"),n();break;case"{":s=t,r.pop(),r.push(i),r.push("INSIDE_OBJECT_START"),n();break;case"[":s=t,r.pop(),r.push(i),r.push("INSIDE_ARRAY_START"),n()}}function u(e,a){switch(e){case",":r.pop(),r.push("INSIDE_OBJECT_AFTER_COMMA");break;case"}":s=a,r.pop(),t=i.pop()}}function l(e,a){switch(e){case",":r.pop(),r.push("INSIDE_ARRAY_AFTER_COMMA"),t=(Number(t)+1).toString();break;case"]":s=a,r.pop(),t=i.pop()}}for(let n=0;n<e.length;n++){let h=e[n];switch(r[r.length-1]){case"ROOT":o(h,n,"FINISH");break;case"INSIDE_OBJECT_START":switch(h){case'"':r.pop(),r.push("INSIDE_OBJECT_KEY"),t="";break;case"}":s=n,r.pop(),t=i.pop()}break;case"INSIDE_OBJECT_AFTER_COMMA":'"'===h&&(r.pop(),r.push("INSIDE_OBJECT_KEY"),t="");break;case"INSIDE_OBJECT_KEY":switch(h){case'"':r.pop(),r.push("INSIDE_OBJECT_AFTER_KEY");break;case"\\":r.push("INSIDE_STRING_ESCAPE"),t+=h;break;default:t+=h}break;case"INSIDE_OBJECT_AFTER_KEY":":"===h&&(r.pop(),r.push("INSIDE_OBJECT_BEFORE_VALUE"));break;case"INSIDE_OBJECT_BEFORE_VALUE":o(h,n,"INSIDE_OBJECT_AFTER_VALUE");break;case"INSIDE_OBJECT_AFTER_VALUE":u(h,n);break;case"INSIDE_STRING":switch(h){case'"':r.pop(),s=n,t=i.pop();break;case"\\":r.push("INSIDE_STRING_ESCAPE");break;default:s=n}break;case"INSIDE_ARRAY_START":"]"===h?(s=n,r.pop(),t=i.pop()):(s=n,t="0",o(h,n,"INSIDE_ARRAY_AFTER_VALUE"));break;case"INSIDE_ARRAY_AFTER_VALUE":switch(h){case",":r.pop(),r.push("INSIDE_ARRAY_AFTER_COMMA"),t=(Number(t)+1).toString();break;case"]":s=n,r.pop(),t=i.pop();break;default:s=n}break;case"INSIDE_ARRAY_AFTER_COMMA":o(h,n,"INSIDE_ARRAY_AFTER_VALUE");break;case"INSIDE_STRING_ESCAPE":r.pop(),"INSIDE_STRING"===r[r.length-1]?s=n:"INSIDE_OBJECT_KEY"===r[r.length-1]&&(t+=h);break;case"INSIDE_NUMBER":switch(h){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":s=n;break;case"e":case"E":case"-":case".":break;case",":r.pop(),t=i.pop(),"INSIDE_ARRAY_AFTER_VALUE"===r[r.length-1]&&l(h,n),"INSIDE_OBJECT_AFTER_VALUE"===r[r.length-1]&&u(h,n);break;case"}":r.pop(),t=i.pop(),"INSIDE_OBJECT_AFTER_VALUE"===r[r.length-1]&&u(h,n);break;case"]":r.pop(),t=i.pop(),"INSIDE_ARRAY_AFTER_VALUE"===r[r.length-1]&&l(h,n);break;default:r.pop(),t=i.pop()}break;case"INSIDE_LITERAL":{let t=e.substring(a,n+1);"false".startsWith(t)||"true".startsWith(t)||"null".startsWith(t)?s=n:(r.pop(),"INSIDE_OBJECT_AFTER_VALUE"===r[r.length-1]?u(h,n):"INSIDE_ARRAY_AFTER_VALUE"===r[r.length-1]&&l(h,n))}}}let h=e.slice(0,s+1);for(let t=r.length-1;t>=0;t--)switch(r[t]){case"INSIDE_STRING":h+='"';break;case"INSIDE_OBJECT_KEY":case"INSIDE_OBJECT_AFTER_KEY":case"INSIDE_OBJECT_AFTER_COMMA":case"INSIDE_OBJECT_START":case"INSIDE_OBJECT_BEFORE_VALUE":case"INSIDE_OBJECT_AFTER_VALUE":h+="}";break;case"INSIDE_ARRAY_START":case"INSIDE_ARRAY_AFTER_COMMA":case"INSIDE_ARRAY_AFTER_VALUE":h+="]";break;case"INSIDE_LITERAL":{let t=e.substring(a,e.length);"true".startsWith(t)?h+="true".slice(t.length):"false".startsWith(t)?h+="false".slice(t.length):"null".startsWith(t)&&(h+="null".slice(t.length))}}return[h,i]}(e),s=tS.parse(t);if("object"!=typeof s||null===s)throw Error("argsText is expected to be an object");return s[tx]={state:"partial",partialPath:r},s}catch{return}}},tI=(e,t,r)=>{if("object"!=typeof e||null===e)return t.state;if("complete"===t.state)return"complete";if(0===r.length)return t.state;let[s,...a]=r;if(!Object.prototype.hasOwnProperty.call(e,s))return"partial";let[i,...n]=t.partialPath;return s!==i?"complete":tI(e[s],{state:"partial",partialPath:n},a)},tE=(e,t)=>{let r=tT(e);if(!r)throw Error("unable to determine object state");return tI(e,r,t.map(String))};async function*tA(){let e=this.getReader();try{for(;;){let{done:t,value:r}=await e.read();if(t)break;yield r}}finally{e.releaseLock()}}function tC(e){return e[Symbol.asyncIterator]??=tA,e}function tR(e,t){let r=e;for(let e of t){if(null==r)return;r=r[e]}return r}var tO=class{resolve;reject;disposed=!1;fieldPath;constructor(e,t,r){this.resolve=e,this.reject=t,this.fieldPath=r}update(e){if(!this.disposed)try{if("complete"===tE(e,this.fieldPath)){let t=tR(e,this.fieldPath);void 0!==t&&(this.resolve(t),this.dispose())}}catch(e){this.reject(e),this.dispose()}}dispose(){this.disposed=!0}},tP=class{controller;disposed=!1;fieldPath;constructor(e,t){this.controller=e,this.fieldPath=t}update(e){if(!this.disposed)try{let t=tR(e,this.fieldPath);void 0!==t&&this.controller.enqueue(t),"complete"===tE(e,this.fieldPath)&&(this.controller.close(),this.dispose())}catch(e){this.controller.error(e),this.dispose()}}dispose(){this.disposed=!0}},tM=class{controller;disposed=!1;fieldPath;lastValue=void 0;constructor(e,t){this.controller=e,this.fieldPath=t}update(e){if(!this.disposed)try{let t=tR(e,this.fieldPath);if(void 0!==t&&"string"==typeof t){let e=t.substring(this.lastValue?.length||0);this.lastValue=t,this.controller.enqueue(e)}"complete"===tE(e,this.fieldPath)&&(this.controller.close(),this.dispose())}catch(e){this.controller.error(e),this.dispose()}}dispose(){this.disposed=!0}},tN=class{controller;disposed=!1;fieldPath;processedIndexes=new Set;constructor(e,t){this.controller=e,this.fieldPath=t}update(e){if(!this.disposed)try{let t=tR(e,this.fieldPath);if(!Array.isArray(t))return;for(let r=0;r<t.length;r++)if(!this.processedIndexes.has(r)){let s=[...this.fieldPath,r];"complete"===tE(e,s)&&(this.controller.enqueue(t[r]),this.processedIndexes.add(r))}"complete"===tE(e,this.fieldPath)&&(this.controller.close(),this.dispose())}catch(e){this.controller.error(e),this.dispose()}}dispose(){this.disposed=!0}},tB=class{argTextDeltas;handles=new Set;args=tk("");constructor(e){this.argTextDeltas=e,this.processStream()}async processStream(){try{let e="",t=this.argTextDeltas.getReader();for(;;){let{value:r,done:s}=await t.read();if(s)break;e+=r;let a=tk(e);if(void 0!==a)for(let e of(this.args=a,this.handles))e.update(a)}}catch(e){for(let t of(console.error("Error processing argument stream:",e),this.handles))t.dispose()}}get(...e){return new Promise((t,r)=>{let s=new tO(t,r,e);if(this.args&&"complete"===tE(this.args,e)){let r=tR(this.args,e);if(void 0!==r)return void t(r)}this.handles.add(s),s.update(this.args)})}streamValues(...e){return tC(new ReadableStream({start:t=>{let r=new tP(t,e);this.handles.add(r),r.update(this.args)},cancel:()=>{for(let e of this.handles)if(e instanceof tP){e.dispose(),this.handles.delete(e);break}}}))}streamText(...e){return tC(new ReadableStream({start:t=>{let r=new tM(t,e);this.handles.add(r),r.update(this.args)},cancel:()=>{for(let e of this.handles)if(e instanceof tM){e.dispose(),this.handles.delete(e);break}}}))}forEach(...e){return tC(new ReadableStream({start:t=>{let r=new tN(t,e);this.handles.add(r),r.update(this.args)},cancel:()=>{for(let e of this.handles)if(e instanceof tN){e.dispose(),this.handles.delete(e);break}}}))}},tj=class{constructor(e){this.promise=e}get(){return this.promise}},tZ=class{args;response;writable;resolve;argsText="";constructor(){let e=new TransformStream;this.writable=e.writable,this.args=new tB(e.readable);let{promise:t,resolve:r}=e7();this.resolve=r,this.response=new tj(t)}async appendArgsTextDelta(e){let t=this.writable.getWriter();try{await t.write(e)}catch(e){console.warn(e)}finally{t.releaseLock()}this.argsText+=e}setResponse(e){this.resolve(e)}result={get:async()=>(await this.response.get()).result}},tL=class extends tp{constructor(e){let t=new Map,r=new Map;super(s=>{let a=new TransformStream({transform(s,a){switch(("part-finish"!==s.type||"tool-call"!==s.meta.type)&&a.enqueue(s),s.type){case"part-start":if("tool-call"===s.part.type){let t=new tZ;r.set(s.part.toolCallId,t),e.streamCall({reader:t,toolCallId:s.part.toolCallId,toolName:s.part.toolName})}break;case"text-delta":if("tool-call"===s.meta.type){let e=s.meta.toolCallId,t=r.get(e);if(!t)throw Error("No controller found for tool call");t.appendArgsTextDelta(s.textDelta)}break;case"result":{if("tool-call"!==s.meta.type)break;let{toolCallId:e}=s.meta,t=r.get(e);if(!t)throw Error("No controller found for tool call");t.setResponse(new tw({result:s.result,artifact:s.artifact,isError:s.isError}));break}case"tool-call-args-text-finish":{if("tool-call"!==s.meta.type)break;let{toolCallId:i,toolName:n}=s.meta,o=r.get(i);if(!o)throw Error("No controller found for tool call");let u=function(e,t,r){try{let s=e();if("object"==typeof s&&null!==s&&"then"in s)return s.then(t,r);t(s)}catch(e){r(e)}}(()=>{let t;if(!o.argsText)throw console.log("Encountered tool call without args, this should never happen"),Error("Encountered tool call without args, this is unexpected.");try{t=tS.parse(o.argsText)}catch(e){throw Error(`Function parameter parsing failed. ${JSON.stringify(e.message)}`)}return e.execute({toolCallId:i,toolName:n,args:t})},e=>{if(void 0===e)return;let t=new tw({artifact:e.artifact,result:e.result,isError:e.isError});o.setResponse(t),a.enqueue({type:"result",path:s.path,...t})},e=>{let t=new tw({result:String(e),isError:!0});o.setResponse(t),a.enqueue({type:"result",path:s.path,...t})});u&&t.set(i,u);break}case"part-finish":{if("tool-call"!==s.meta.type)break;let{toolCallId:e}=s.meta,i=t.get(e);i?i.then(()=>{t.delete(e),r.delete(e),a.enqueue(s)}):a.enqueue(s)}}},async flush(){await Promise.all(t.values())}});return s.pipeThrough(new ty).pipeThrough(a)})}},t$=e=>"object"==typeof e&&null!==e&&"~standard"in e&&1===e["~standard"].version,tD=class e{_state;constructor(e=null){this._state=e}get state(){return this._state}append(t){this._state=t.reduce((t,r)=>e.apply(t,r),this._state)}static apply(t,r){let s=r.type;switch(s){case"set":return e.updatePath(t,r.path,()=>r.value);case"append-text":return e.updatePath(t,r.path,e=>{if("string"!=typeof e)throw Error(`Expected string at path [${r.path.join(", ")}]`);return e+r.value});default:throw Error(`Invalid operation type: ${s}`)}}static updatePath(e,t,r){if(0===t.length)return r(e);if("object"!=typeof(e??={}))throw Error(`Invalid path: [${t.join(", ")}]`);let[s,...a]=t;if(Array.isArray(e)){let i=Number(s);if(isNaN(i))throw Error(`Expected array index at [${t.join(", ")}]`);if(i>e.length||i<0)throw Error("Insert array index out of bounds");let n=[...e];return n[i]=this.updatePath(n[i],a,r),n}let i={...e};return i[s]=this.updatePath(i[s],a,r),i}},tU=()=>({role:"assistant",status:{type:"running"},parts:[],get content(){return this.parts},metadata:{unstable_state:null,unstable_data:[],unstable_annotations:[],steps:[],custom:{}}}),tF=(e,t,r)=>{if(0===e.parts.length)throw Error("No parts available to update.");if(1!==t.path.length)throw Error("Nested paths are not supported yet.");let s=t.path[0],a=r(e.parts[s]);return{...e,parts:[...e.parts.slice(0,s),a,...e.parts.slice(s+1)],get content(){return this.parts}}},tz=(e,t)=>{let r=t.part;if("text"===r.type||"reasoning"===r.type){let t={type:r.type,text:"",status:{type:"running"}};return{...e,parts:[...e.parts,t],get content(){return this.parts}}}if("tool-call"===r.type){let t={type:"tool-call",state:"partial-call",status:{type:"running",isArgsComplete:!1},toolCallId:r.toolCallId,toolName:r.toolName,argsText:"",args:{}};return{...e,parts:[...e.parts,t],get content(){return this.parts}}}if("source"===r.type){let t={type:"source",sourceType:r.sourceType,id:r.id,url:r.url,...r.title?{title:r.title}:void 0};return{...e,parts:[...e.parts,t],get content(){return this.parts}}}if("file"===r.type){let t={type:"file",mimeType:r.mimeType,data:r.data};return{...e,parts:[...e.parts,t],get content(){return this.parts}}}throw Error(`Unsupported part type: ${r.type}`)},tq=(e,t)=>tF(e,t,e=>{if("tool-call"!==e.type)throw Error("Last is not a tool call");return"partial-call"!==e.state?e:{...e,state:"call"}}),tV=(e,t)=>tF(e,t,e=>({...e,status:{type:"complete",reason:"unknown"}})),tJ=(e,t)=>tF(e,t,e=>{if("text"===e.type||"reasoning"===e.type)return{...e,text:e.text+t.textDelta};if("tool-call"===e.type){let r=e.argsText+t.textDelta,s=tk(r)??e.args;return{...e,argsText:r,args:s}}throw Error("text-delta received but part is neither text nor tool-call")}),tK=(e,t)=>tF(e,t,e=>{if("tool-call"===e.type)return{...e,state:"result",...void 0!==t.artifact?{artifact:t.artifact}:{},result:t.result,isError:t.isError??!1,status:{type:"complete",reason:"stop"}};throw Error("Result chunk received but part is not a tool-call")}),tW=(e,t)=>{let r=tY(t);return{...e,status:r}},tY=e=>"tool-calls"===e.finishReason?{type:"requires-action",reason:"tool-calls"}:"stop"===e.finishReason||"unknown"===e.finishReason?{type:"complete",reason:e.finishReason}:{type:"incomplete",reason:e.finishReason},tH=(e,t)=>({...e,metadata:{...e.metadata,unstable_annotations:[...e.metadata.unstable_annotations,...t.annotations]}}),tG=(e,t)=>({...e,metadata:{...e.metadata,unstable_data:[...e.metadata.unstable_data,...t.data]}}),tX=(e,t)=>({...e,metadata:{...e.metadata,steps:[...e.metadata.steps,{state:"started",messageId:t.messageId}]}}),tQ=(e,t)=>{let r=e.metadata.steps.slice(),s=r.length-1;return r.length>0&&r[s]?.state==="started"?r[s]={...r[s],state:"finished",finishReason:t.finishReason,usage:t.usage,isContinued:t.isContinued}:r.push({state:"finished",messageId:th(),finishReason:t.finishReason,usage:t.usage,isContinued:t.isContinued}),{...e,metadata:{...e.metadata,steps:r}}},t0=(e,t)=>({...e,status:{type:"incomplete",reason:"error",error:t.error}}),t1=(e,t)=>{let r=new tD(e.metadata.unstable_state);return r.append(t.operations),{...e,metadata:{...e.metadata,unstable_state:r.state}}},t2=class extends TransformStream{constructor({initialMessage:e}={}){let t=e??tU();super({transform(e,r){let s=e.type;switch(s){case"part-start":t=tz(t,e);break;case"tool-call-args-text-finish":t=tq(t,e);break;case"part-finish":t=tV(t,e);break;case"text-delta":t=tJ(t,e);break;case"result":t=tK(t,e);break;case"message-finish":t=tW(t,e);break;case"annotations":t=tH(t,e);break;case"data":t=tG(t,e);break;case"step-start":t=tX(t,e);break;case"step-finish":t=tQ(t,e);break;case"error":t=t0(t,e);break;case"update-state":t=t1(t,e);break;default:throw Error(`Unsupported chunk type: ${s}`)}r.enqueue(t)},flush(e){if(t.status?.type==="running"){let r=t.parts?.at(-1)?.type==="tool-call";t=tW(t,{type:"message-finish",path:[],finishReason:r?"tool-calls":"unknown",usage:{promptTokens:0,completionTokens:0}}),e.enqueue(t)}}})}},t4=e=>Object.fromEntries(Object.entries(e).map(([e,t])=>[e,{...t.description?{description:t.description}:void 0,parameters:t.parameters instanceof R?e6(t.parameters):t.parameters}])),t9=e=>Object.fromEntries(Object.entries(e).filter(([,e])=>!e.disabled&&"backend"!==e.type)),t5=class{constructor(e){this.options=e}async *run({messages:e,runConfig:t,abortSignal:r,context:s,unstable_assistantMessageId:a,unstable_getMessage:i}){let n="function"==typeof this.options.headers?await this.options.headers():this.options.headers;r.addEventListener("abort",()=>{r.reason?.detach||this.options.onCancel?.()},{once:!0});let o=new Headers(n);o.set("Content-Type","application/json");let u=await fetch(this.options.api,{method:"POST",headers:o,credentials:this.options.credentials??"same-origin",body:JSON.stringify({system:s.system,messages:this.options.unstable_AISDKInterop?function(e,t={}){let r=t.unstable_includeId??!1;return e.flatMap(e=>{let t=e.role;switch(t){case"system":return[{...r?{unstable_id:e.id}:{},role:"system",content:e.content[0].text}];case"user":{let t="attachments"in e?e.attachments:[],s=[...e.content,...t.map(e=>e.content).flat()];return[{...r?{unstable_id:e.id}:{},role:"user",content:s.map(e=>{let t=e.type;switch(t){case"text":return e;case"image":return{type:"image",image:new URL(e.image)};case"file":return{type:"file",data:new URL(e.data),mimeType:e.mimeType};default:throw Error(`Unspported content part type: ${t}`)}})}]}case"assistant":{let t=e8();for(let r of e.content){let e=r.type;switch(e){case"reasoning":case"source":case"file":break;case"text":t.addTextContentPart(r);break;case"tool-call":t.addToolCallPart(r);break;default:throw Error(`Unhandled content part type: ${e}`)}}return t.getMessages()}default:throw Error(`Unknown message role: ${t}`)}})}(e,{unstable_includeId:this.options.unstable_sendMessageIds||this.options.sendExtraMessageFields}):h(e,{unstable_includeId:this.options.unstable_sendMessageIds||this.options.sendExtraMessageFields}),tools:"v2"===this.options.unstable_AISDKInterop?t4(t9(s.tools??{})):e3(t9(s.tools??{})),unstable_assistantMessageId:a,runConfig:t,state:i().metadata.unstable_state,...s.callSettings,...s.config,...this.options.body}),signal:r});await this.options.onResponse?.(u);try{var l;if(!u.ok)throw Error(`Status ${u.status}: ${await u.text()}`);if(!u.body)throw Error("Response body is null");let e=u.body.pipeThrough(new tb).pipeThrough((l=s.tools,new tL({execute:e=>(function(e,t,r){let s=e?.[r.toolName];if(s&&s.execute)return(async e=>{let a=e;if(t$(s.parameters)){let e=s.parameters["~standard"].validate(r.args);e instanceof Promise&&(e=await e),e.issues&&(a=s.experimental_onSchemaValidationError??(()=>{throw Error(`Function parameter validation failed. ${JSON.stringify(e.issues)}`)}))}let i=await a(r.args,{toolCallId:r.toolCallId,abortSignal:t});return tw.toResponse(i)})(s.execute)})(l,r,e),streamCall:({reader:e,...t})=>{l?.[t.toolName]?.streamCall?.(e,{toolCallId:t.toolCallId,abortSignal:r})}}))).pipeThrough(new t2);yield*tC(e),this.options.onFinish?.(i())}catch(e){throw this.options.onError?.(e),e}}},t6=e=>{let{cloud:t,initialMessages:r,maxSteps:s,adapters:a,unstable_humanToolNames:i,...n}=e;return{localRuntimeOptions:{cloud:t,initialMessages:r,maxSteps:s,adapters:a,unstable_humanToolNames:i},otherOptions:n}},t3=r(2115),t8=e=>Array.from(e).map(e=>e.getModelContext()).sort((e,t)=>(t.priority??0)-(e.priority??0)).reduce((e,t)=>{if(t.system&&(e.system?e.system+=`

${t.system}`:e.system=t.system),t.tools)for(let[r,s]of Object.entries(t.tools)){let t=e.tools?.[r];if(t&&t!==s)throw Error(`You tried to define a tool with the name ${r}, but it already exists.`);e.tools||(e.tools={}),e.tools[r]=s}return t.config&&(e.config={...e.config,...t.config}),t.callSettings&&(e.callSettings={...e.callSettings,...t.callSettings}),e},{}),t7=class{_providers=new Set;getModelContext(){return t8(this._providers)}registerModelContextProvider(e){this._providers.add(e);let t=e.subscribe?.(()=>{this.notifySubscribers()});return this.notifySubscribers(),()=>{this._providers.delete(e),t?.(),this.notifySubscribers()}}_subscribers=new Set;notifySubscribers(){for(let e of this._subscribers)e()}subscribe(e){return this._subscribers.add(e),()=>this._subscribers.delete(e)}},re=class{_contextProvider=new t7;registerModelContextProvider(e){return this._contextProvider.registerModelContextProvider(e)}},rt=((e,t=21)=>(r=t)=>{let s="",a=0|r;for(;a--;)s+=e[Math.random()*e.length|0];return s})("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",7),rr=()=>`__optimistic__${rt()}`,rs=(e,t,r)=>{let{role:s,id:a,createdAt:i,attachments:n,status:o,metadata:u}=e,l={id:a??t,createdAt:i??new Date},h="string"==typeof e.content?[{type:"text",text:e.content}]:e.content;if("user"!==s&&n?.length)throw Error("attachments are only supported for user messages");if("assistant"!==s&&o)throw Error("status is only supported for assistant messages");if("assistant"!==s&&u?.steps)throw Error("metadata.steps is only supported for assistant messages");switch(s){case"assistant":return{...l,role:s,content:h.map(e=>{let t=e.type;switch(t){case"text":case"reasoning":if(0===e.text.trim().length)return null;return e;case"file":case"source":return e;case"tool-call":if(e.args)return{...e,toolCallId:e.toolCallId??"tool-"+rt(),args:e.args,argsText:JSON.stringify(e.args)};return{...e,toolCallId:e.toolCallId??"tool-"+rt(),args:e.args??tk(e.argsText??"")??{},argsText:e.argsText??""};default:throw Error(`Unsupported assistant content part type: ${t}`)}}).filter(e=>!!e),status:o??r,metadata:{unstable_state:u?.unstable_state??null,unstable_annotations:u?.unstable_annotations??[],unstable_data:u?.unstable_data??[],custom:u?.custom??{},steps:u?.steps??[]}};case"user":return{...l,role:s,content:h.map(e=>{let t=e.type;switch(t){case"text":case"image":case"audio":case"file":return e;default:throw Error(`Unsupported user content part type: ${t}`)}}),attachments:n??[],metadata:{custom:u?.custom??{}}};case"system":if(1!==h.length||"text"!==h[0].type)throw Error("System messages must have exactly one text content part.");return{...l,role:s,content:h,metadata:{custom:u?.custom??{}}};default:throw Error(`Unknown message role: ${s}`)}},ra=(e,t)=>void 0===t?e.status?.type==="requires-action"&&"tool-calls"===e.status.reason&&e.content.every(e=>"tool-call"!==e.type||!!e.result):e.status?.type==="requires-action"&&"tool-calls"===e.status.reason&&e.content.every(e=>"tool-call"!==e.type||!!e.result||!t.includes(e.toolName)),ri=Object.freeze({type:"running"}),rn=Object.freeze({type:"complete",reason:"unknown"}),ro=(e,t)=>e&&t?ri:rn,ru={fromArray:e=>{let t=e.map(e=>rs(e,rt(),ro(!1,!1)));return{messages:t.map((e,r)=>({parentId:r>0?t[r-1].id:null,message:e}))}}},rl=e=>e.next?rl(e.next):"current"in e?e:null,rh=class{constructor(e){this.func=e}_value=null;get value(){return null===this._value&&(this._value=this.func()),this._value}dirty(){this._value=null}},rd=class{messages=new Map;head=null;root={children:[],next:null};performOp(e,t,r){let s=t.prev??this.root,a=e??this.root;if("relink"!==r||s!==a){if("link"!==r&&(s.children=s.children.filter(e=>e!==t.current.id),s.next===t)){let e=s.children.at(-1),t=e?this.messages.get(e):null;if(void 0===t)throw Error("MessageRepository(performOp/cut): Fallback sibling message not found. This is likely an internal bug in assistant-ui.");s.next=t}if("cut"!==r){for(let r=e;r;r=r.prev)if(r.current.id===t.current.id)throw Error("MessageRepository(performOp/link): A message with the same id already exists in the parent tree. This error occurs if the same message id is found multiple times. This is likely an internal bug in assistant-ui.");a.children=[...a.children,t.current.id],(rl(t)===this.head||null===a.next)&&(a.next=t),t.prev=e}}}_messages=new rh(()=>{let e=Array(this.head?.level??0);for(let t=this.head;t;t=t.prev)e[t.level]=t.current;return e});get headId(){return this.head?.current.id??null}getMessages(){return this._messages.value}addOrUpdateMessage(e,t){let r=this.messages.get(t.id),s=e?this.messages.get(e):null;if(void 0===s)throw Error("MessageRepository(addOrUpdateMessage): Parent message not found. This is likely an internal bug in assistant-ui.");if(r){r.current=t,this.performOp(s,r,"relink"),this._messages.dirty();return}let a={prev:s,current:t,next:null,children:[],level:s?s.level+1:0};this.messages.set(t.id,a),this.performOp(s,a,"link"),this.head===s&&(this.head=a),this._messages.dirty()}getMessage(e){let t=this.messages.get(e);if(!t)throw Error("MessageRepository(updateMessage): Message not found. This is likely an internal bug in assistant-ui.");return{parentId:t.prev?.current.id??null,message:t.current}}appendOptimisticMessage(e,t){let r;do r=rr();while(this.messages.has(r));return this.addOrUpdateMessage(e,rs(t,r,{type:"running"})),r}deleteMessage(e,t){let r=this.messages.get(e);if(!r)throw Error("MessageRepository(deleteMessage): Optimistic message not found. This is likely an internal bug in assistant-ui.");let s=void 0===t?r.prev:null===t?null:this.messages.get(t);if(void 0===s)throw Error("MessageRepository(deleteMessage): Replacement not found. This is likely an internal bug in assistant-ui.");for(let e of r.children){let t=this.messages.get(e);if(!t)throw Error("MessageRepository(deleteMessage): Child message not found. This is likely an internal bug in assistant-ui.");this.performOp(s,t,"relink")}this.performOp(null,r,"cut"),this.messages.delete(e),this.head===r&&(this.head=rl(s??this.root)),this._messages.dirty()}getBranches(e){let t=this.messages.get(e);if(!t)throw Error("MessageRepository(getBranches): Message not found. This is likely an internal bug in assistant-ui.");let{children:r}=t.prev??this.root;return r}switchToBranch(e){let t=this.messages.get(e);if(!t)throw Error("MessageRepository(switchToBranch): Branch not found. This is likely an internal bug in assistant-ui.");(t.prev??this.root).next=t,this.head=rl(t),this._messages.dirty()}resetHead(e){if(null===e){this.head=null,this._messages.dirty();return}let t=this.messages.get(e);if(!t)throw Error("MessageRepository(resetHead): Branch not found. This is likely an internal bug in assistant-ui.");this.head=t;for(let e=t;e;e=e.prev)e.prev&&(e.prev.next=e);this._messages.dirty()}clear(){this.messages.clear(),this.head=null,this.root={children:[],next:null},this._messages.dirty()}export(){let e=[];for(let[,t]of this.messages)e.push({message:t.current,parentId:t.prev?.current.id??null});return{headId:this.head?.current.id??null,messages:e}}import({headId:e,messages:t}){for(let{message:e,parentId:r}of t)this.addOrUpdateMessage(r,e);this.resetHead(e??t.at(-1)?.message.id??null)}},rc=class{_subscribers=new Set;subscribe(e){return this._subscribers.add(e),()=>this._subscribers.delete(e)}waitForUpdate(){return new Promise(e=>{let t=this.subscribe(()=>{t(),e()})})}_notifySubscribers(){let e=[];for(let t of this._subscribers)try{t()}catch(t){e.push(t)}if(e.length>0)if(1===e.length)throw e[0];else throw AggregateError(e)}},rp=e=>"complete"===e.status.type,rf=class extends rc{isEditing=!0;getAttachmentAccept(){return this.getAttachmentAdapter()?.accept??"*"}_attachments=[];get attachments(){return this._attachments}setAttachments(e){this._attachments=e,this._notifySubscribers()}get isEmpty(){return!this.text.trim()&&!this.attachments.length}_text="";get text(){return this._text}_role="user";get role(){return this._role}_runConfig={};get runConfig(){return this._runConfig}setText(e){this._text!==e&&(this._text=e,this._notifySubscribers())}setRole(e){this._role!==e&&(this._role=e,this._notifySubscribers())}setRunConfig(e){this._runConfig!==e&&(this._runConfig=e,this._notifySubscribers())}_emptyTextAndAttachments(){this._attachments=[],this._text="",this._notifySubscribers()}async _onClearAttachments(){let e=this.getAttachmentAdapter();e&&await Promise.all(this._attachments.map(t=>e.remove(t)))}async reset(){if(0===this._attachments.length&&""===this._text&&"user"===this._role&&0===Object.keys(this._runConfig).length)return;this._role="user",this._runConfig={};let e=this._onClearAttachments();this._emptyTextAndAttachments(),await e}async clearAttachments(){let e=this._onClearAttachments();this.setAttachments([]),await e}async send(){let e=this.getAttachmentAdapter(),t=e&&this.attachments.length>0?await Promise.all(this.attachments.map(async t=>rp(t)?t:await e.send(t))):[],r={createdAt:new Date,role:this.role,content:this.text?[{type:"text",text:this.text}]:[],attachments:t,runConfig:this.runConfig,metadata:{custom:{}}};this._emptyTextAndAttachments(),this.handleSend(r),this._notifyEventSubscribers("send")}cancel(){this.handleCancel()}async addAttachment(e){let t=this.getAttachmentAdapter();if(!t)throw Error("Attachments are not supported");let r=e=>{let t=this._attachments.findIndex(t=>t.id===e.id);-1!==t?this._attachments=[...this._attachments.slice(0,t),e,...this._attachments.slice(t+1)]:(this._attachments=[...this._attachments,e],this._notifyEventSubscribers("attachment_add")),this._notifySubscribers()},s=t.add({file:e});if(Symbol.asyncIterator in s)for await(let e of s)r(e);else r(await s);this._notifyEventSubscribers("attachment_add"),this._notifySubscribers()}async removeAttachment(e){let t=this.getAttachmentAdapter();if(!t)throw Error("Attachments are not supported");let r=this._attachments.findIndex(t=>t.id===e);if(-1===r)throw Error("Attachment not found");let s=this._attachments[r];await t.remove(s),this._attachments=[...this._attachments.slice(0,r),...this._attachments.slice(r+1)],this._notifySubscribers()}_eventSubscribers=new Map;_notifyEventSubscribers(e){let t=this._eventSubscribers.get(e);if(t)for(let e of t)e()}unstable_on(e,t){let r=this._eventSubscribers.get(e);return r?r.add(t):this._eventSubscribers.set(e,new Set([t])),()=>{let r=this._eventSubscribers.get(e);r&&r.delete(t)}}},rm=class extends rf{constructor(e){super(),this.runtime=e,this.connect()}_canCancel=!1;get canCancel(){return this._canCancel}get attachments(){return super.attachments}getAttachmentAdapter(){return this.runtime.adapters?.attachments}connect(){return this.runtime.subscribe(()=>{this.canCancel!==this.runtime.capabilities.cancel&&(this._canCancel=this.runtime.capabilities.cancel,this._notifySubscribers())})}async handleSend(e){this.runtime.append({...e,parentId:this.runtime.messages.at(-1)?.id??null,sourceId:null})}async handleCancel(){this.runtime.cancelRun()}},rg=e=>e.content.filter(e=>"text"===e.type).map(e=>e.text).join("\n\n"),ry=class extends rf{constructor(e,t,{parentId:r,message:s}){super(),this.runtime=e,this.endEditCallback=t,this._parentId=r,this._sourceId=s.id,this._previousText=rg(s),this.setText(this._previousText),this.setRole(s.role),this.setAttachments(s.attachments??[]),this._nonTextParts=s.content.filter(e=>"text"!==e.type),this.setRunConfig({...e.composer.runConfig})}get canCancel(){return!0}getAttachmentAdapter(){return this.runtime.adapters?.attachments}_nonTextParts;_previousText;_parentId;_sourceId;async handleSend(e){rg(e)!==this._previousText&&this.runtime.append({...e,content:[...e.content,...this._nonTextParts],parentId:this._parentId,sourceId:this._sourceId}),this.handleCancel()}handleCancel(){this.endEditCallback(),this._notifySubscribers()}},r_=class{constructor(e){this._contextProvider=e}_subscriptions=new Set;_isInitialized=!1;repository=new rd;get messages(){return this.repository.getMessages()}get state(){let e;for(let t of this.messages)if("assistant"===t.role){e=t;break}return e?.metadata.unstable_state??null}composer=new rm(this);getModelContext(){return this._contextProvider.getModelContext()}_editComposers=new Map;getEditComposer(e){return this._editComposers.get(e)}beginEdit(e){if(this._editComposers.has(e))throw Error("Edit already in progress");this._editComposers.set(e,new ry(this,()=>this._editComposers.delete(e),this.repository.getMessage(e))),this._notifySubscribers()}getMessageById(e){return this.repository.getMessage(e)}getBranches(e){return this.repository.getBranches(e)}switchToBranch(e){this.repository.switchToBranch(e),this._notifySubscribers()}_notifySubscribers(){for(let e of this._subscriptions)e()}_notifyEventSubscribers(e){let t=this._eventSubscribers.get(e);if(t)for(let e of t)e()}subscribe(e){return this._subscriptions.add(e),()=>this._subscriptions.delete(e)}_submittedFeedback={};getSubmittedFeedback(e){return this._submittedFeedback[e]}submitFeedback({messageId:e,type:t}){let r=this.adapters?.feedback;if(!r)throw Error("Feedback adapter not configured");let{message:s}=this.repository.getMessage(e);r.submit({message:s,type:t}),this._submittedFeedback[e]={type:t},this._notifySubscribers()}_stopSpeaking;speech;speak(e){let t=this.adapters?.speech;if(!t)throw Error("Speech adapter not configured");let{message:r}=this.repository.getMessage(e);this._stopSpeaking?.();let s=t.speak(rg(r)),a=s.subscribe(()=>{"ended"===s.status.type?(this._stopSpeaking=void 0,this.speech=void 0):this.speech={messageId:e,status:s.status},this._notifySubscribers()});this.speech={messageId:e,status:s.status},this._notifySubscribers(),this._stopSpeaking=()=>{s.cancel(),a(),this.speech=void 0,this._stopSpeaking=void 0}}stopSpeaking(){if(!this._stopSpeaking)throw Error("No message is being spoken");this._stopSpeaking(),this._notifySubscribers()}ensureInitialized(){this._isInitialized||(this._isInitialized=!0,this._notifyEventSubscribers("initialize"))}export(){return this.repository.export()}import(e){this.ensureInitialized(),this.repository.clear(),this.repository.import(e),this._notifySubscribers()}_eventSubscribers=new Map;unstable_on(e,t){if("model-context-update"===e)return this._contextProvider.subscribe?.(t)??(()=>{});let r=this._eventSubscribers.get(e);return r?r.add(t):this._eventSubscribers.set(e,new Set([t])),()=>{this._eventSubscribers.get(e).delete(t)}}},rb=class extends r_{capabilities={switchToBranch:!0,edit:!0,reload:!0,cancel:!0,unstable_copy:!0,speech:!1,attachments:!1,feedback:!1};abortController=null;isDisabled=!1;_suggestions=[];_suggestionsController=null;get suggestions(){return this._suggestions}get adapters(){return this._options.adapters}constructor(e,t){super(e),this.__internal_setOptions(t)}_options;_lastRunConfig={};get extras(){}__internal_setOptions(e){if(this._options===e)return;this._options=e;let t=!1,r=e.adapters?.speech!==void 0;this.capabilities.speech!==r&&(this.capabilities.speech=r,t=!0);let s=e.adapters?.attachments!==void 0;this.capabilities.attachments!==s&&(this.capabilities.attachments=s,t=!0);let a=e.adapters?.feedback!==void 0;this.capabilities.feedback!==a&&(this.capabilities.feedback=a,t=!0),t&&this._notifySubscribers()}_loadPromise;__internal_load(){if(this._loadPromise)return this._loadPromise;let e=this.adapters.history?.load()??Promise.resolve(null);return this._loadPromise=e.then(e=>{if(!e)return;this.repository.import(e),this._notifySubscribers();let t=this.adapters.history?.resume?.bind(this.adapters.history);e.unstable_resume&&t&&this.startRun({parentId:this.repository.headId,sourceId:this.repository.headId,runConfig:this._lastRunConfig},t)}),this._loadPromise}async append(e){this.ensureInitialized();let t=rs(e,rt(),{type:"complete",reason:"unknown"});this.repository.addOrUpdateMessage(e.parentId,t),this._options.adapters.history?.append({parentId:e.parentId,message:t}),e.startRun??"user"===e.role?await this.startRun({parentId:t.id,sourceId:e.sourceId,runConfig:e.runConfig??{}}):(this.repository.resetHead(t.id),this._notifySubscribers())}resumeRun({stream:e,...t}){return this.startRun(t,e)}async startRun({parentId:e,runConfig:t},r){this.ensureInitialized(),this.repository.resetHead(e);let s={id:rt(),role:"assistant",status:{type:"running"},content:[],metadata:{unstable_state:this.state,unstable_annotations:[],unstable_data:[],steps:[],custom:{}},createdAt:new Date};this._notifyEventSubscribers("run-start");try{this._suggestions=[],this._suggestionsController?.abort(),this._suggestionsController=null;do s=await this.performRoundtrip(e,s,t,r),r=void 0;while(ra(s,this._options.unstable_humanToolNames))}finally{this._notifyEventSubscribers("run-end")}this._suggestionsController=new AbortController;let a=this._suggestionsController.signal;if(this.adapters.suggestion&&s.status?.type!=="requires-action"){let e=this.adapters.suggestion?.generate({messages:this.messages});if(Symbol.asyncIterator in e)for await(let t of e){if(a.aborted)break;this._suggestions=t}else{let t=await e;if(a.aborted)return;this._suggestions=t}}}async performRoundtrip(e,t,r,s){let a=this.repository.getMessages();this.abortController?.abort(),this.abortController=new AbortController;let i=t.content,n=t.metadata?.unstable_annotations,o=t.metadata?.unstable_data,u=t.metadata?.steps,l=t.metadata?.custom,h=r=>{let s=r.metadata?.steps,a=s?[...u??[],...s]:void 0,h=r.metadata?.unstable_annotations,d=r.metadata?.unstable_data,c=h?[...n??[],...h]:void 0,p=d?[...o??[],...d]:void 0;t={...t,...r.content?{content:[...i,...r.content??[]]}:void 0,status:r.status??t.status,...r.metadata?{metadata:{...t.metadata,...r.metadata.unstable_state?{unstable_state:r.metadata.unstable_state}:void 0,...c?{unstable_annotations:c}:void 0,...p?{unstable_data:p}:void 0,...a?{steps:a}:void 0,...r.metadata?.custom?{custom:{...l??{},...r.metadata.custom}}:void 0}}:void 0},this.repository.addOrUpdateMessage(e,t),this._notifySubscribers()},d=this._options.maxSteps??2;if((t.metadata?.steps?.length??0)>=d)return h({status:{type:"incomplete",reason:"tool-calls"}}),t;h({status:{type:"running"}});try{this._lastRunConfig=r??{};let e=this.getModelContext();s=s??this.adapters.chatModel.run.bind(this.adapters.chatModel);let i=this.abortController.signal,n=s({messages:a,runConfig:this._lastRunConfig,abortSignal:i,context:e,config:e,unstable_assistantMessageId:t.id,unstable_getMessage:()=>t});if(Symbol.asyncIterator in n)for await(let e of n){if(i.aborted){h({status:{type:"incomplete",reason:"cancelled"}});break}h(e)}else h(await n);"running"===t.status.type&&h({status:{type:"complete",reason:"unknown"}})}catch(e){if(e instanceof Error&&"AbortError"===e.name)h({status:{type:"incomplete",reason:"cancelled"}});else throw h({status:{type:"incomplete",reason:"error",error:e instanceof Error?e.message:`[${typeof e}] ${new String(e).toString()}`}}),e}finally{this.abortController=null,("complete"===t.status.type||"incomplete"===t.status.type)&&await this._options.adapters.history?.append({parentId:e,message:t})}return t}detach(){this.abortController?.abort({detach:!0}),this.abortController=null}cancelRun(){this.abortController?.abort({detach:!1}),this.abortController=null}addToolResult({messageId:e,toolCallId:t,result:r,isError:s,artifact:a}){let i=this.repository.getMessage(e),{parentId:n}=i,{message:o}=i;if("assistant"!==o.role)throw Error("Tried to add tool result to non-assistant message");let u=!1,l=!1,h=o.content.map(e=>"tool-call"!==e.type||e.toolCallId!==t?e:(l=!0,e.result||(u=!0),{...e,result:r,artifact:a,isError:s}));if(!l)throw Error("Tried to add tool result to non-existing tool call");o={...o,content:h},this.repository.addOrUpdateMessage(n,o),u&&ra(o,this._options.unstable_humanToolNames)&&this.performRoundtrip(n,o,this._lastRunConfig)}},rv=Object.freeze([]),rw=class extends rc{_mainThread;constructor(e){super(),this._mainThread=e()}getMainThreadRuntimeCore(){return this._mainThread}get newThreadId(){throw Error("Method not implemented.")}get threadIds(){throw rv}get archivedThreadIds(){throw rv}get mainThreadId(){return"__DEFAULT_ID__"}getThreadRuntimeCore(){throw Error("Method not implemented.")}getLoadThreadsPromise(){throw Error("Method not implemented.")}getItemById(e){if(e===this.mainThreadId)return{status:"regular",threadId:this.mainThreadId,remoteId:this.mainThreadId,externalId:void 0,title:void 0,isMain:!0};throw Error("Method not implemented")}async switchToThread(){throw Error("Method not implemented.")}switchToNewThread(){throw Error("Method not implemented.")}rename(){throw Error("Method not implemented.")}archive(){throw Error("Method not implemented.")}detach(){throw Error("Method not implemented.")}unarchive(){throw Error("Method not implemented.")}delete(){throw Error("Method not implemented.")}initialize(){throw Error("Method not implemented.")}generateTitle(){throw Error("Method not implemented.")}},rS=class extends re{threads;Provider=void 0;_options;constructor(e,t){super(),this._options=e,this.threads=new rw(()=>new rb(this._contextProvider,this._options)),t&&this.threads.getMainThreadRuntimeCore().import(ru.fromArray(t))}},rx=r(5155),rT=(0,t3.createContext)(null),rk=({adapters:e,children:t})=>{let r=(0,t3.useContext)(rT);return(0,rx.jsx)(rT.Provider,{value:{...r,...e},children:t})},rI=()=>(0,t3.useContext)(rT),rE=r(5453),rA=r(7119),rC=r(3357),rR=r(1386),rO=class extends rc{startThreadRuntime(e){return this.instances.has(e)||(this.instances.set(e,{}),this.useAliveThreadsKeysChanged.setState({},!0)),new Promise((t,r)=>{let s=()=>{let s=this.instances.get(e);if(s){if(!s.runtime)return;a(),t(s.runtime)}else a(),r(Error("Thread was deleted before runtime was started"))},a=this.subscribe(s);s()})}getThreadRuntimeCore(e){let t=this.instances.get(e);if(!t)throw Error("getThreadRuntimeCore not found. This is a bug in assistant-ui.");return t.runtime}stopThreadRuntime(e){this.instances.delete(e),this.useAliveThreadsKeysChanged.setState({},!0)}setRuntimeHook(e){this.useRuntimeHook.getState().useRuntime!==e&&this.useRuntimeHook.setState({useRuntime:e},!0)}constructor(e){super(),this.instances=new Map,this.useAliveThreadsKeysChanged=(0,rE.v)(()=>({})),this._InnerActiveThreadProvider=()=>{let{id:e}=(0,rR.Xi)(),{useRuntime:t}=this.useRuntimeHook(),r=t(),s=r.thread.__internal_threadBinding,a=(0,t3.useCallback)(()=>{let t=this.instances.get(e);if(!t)throw Error("Thread not found. This is a bug in assistant-ui.");t.runtime=s.getState(),i&&this._notifySubscribers()},[e,s]),i=(0,t3.useRef)(!1);i.current||a(),(0,t3.useEffect)(()=>(i.current=!0,a(),s.outerSubscribe(a)),[s,a]);let n=(0,rR.pK)();return(0,t3.useEffect)(()=>r.threads.main.unstable_on("initialize",()=>{if("new"===n.getState().status){n.initialize();let e=r.thread.unstable_on("run-end",()=>{e(),n.generateTitle()})}}),[r,n]),null},this._OuterActiveThreadProvider=(0,t3.memo)(e=>{let{threadId:t,provider:r}=e,s=(0,rA.Ij)(),a=(0,t3.useMemo)(()=>s.threads.getItemById(t),[s,t]);return(0,rx.jsx)(rC.X,{runtime:a,children:(0,rx.jsx)(r,{children:(0,rx.jsx)(this._InnerActiveThreadProvider,{})})})}),this.__internal_RenderThreadRuntimes=e=>{let{provider:t}=e;return this.useAliveThreadsKeysChanged(),Array.from(this.instances.keys()).map(e=>(0,rx.jsx)(this._OuterActiveThreadProvider,{threadId:e,provider:t},e))},this.useRuntimeHook=(0,rE.v)(()=>({useRuntime:e}))}},rP=Error("This is the empty thread, a placeholder for the main thread. You cannot perform any actions on this thread instance. This error is probably because you tried to call a thread method in your render function. Call the method inside a `useEffect` hook instead."),rM={getMessageById(){},getBranches:()=>[],switchToBranch(){throw rP},append(){throw rP},startRun(){throw rP},resumeRun(){throw rP},cancelRun(){throw rP},addToolResult(){throw rP},speak(){throw rP},stopSpeaking(){throw rP},getSubmittedFeedback(){},submitFeedback(){throw rP},getModelContext:()=>({}),composer:{attachments:[],getAttachmentAccept:()=>"*",async addAttachment(){throw rP},async removeAttachment(){throw rP},isEditing:!1,canCancel:!1,isEmpty:!0,text:"",setText(){throw rP},role:"user",setRole(){throw rP},runConfig:{},setRunConfig(){throw rP},async reset(){},async clearAttachments(){},send(){throw rP},cancel(){},subscribe:()=>()=>{},unstable_on:()=>()=>{}},getEditComposer(){},beginEdit(){throw rP},speech:void 0,capabilities:{switchToBranch:!1,edit:!1,reload:!1,cancel:!1,unstable_copy:!1,speech:!1,attachments:!1,feedback:!1},isDisabled:!0,messages:[],state:null,suggestions:[],extras:void 0,subscribe:()=>()=>{},import(){throw rP},export:()=>({messages:[]}),unstable_on:()=>()=>{}},rN=(e,t,r)=>r.reduce((e,r)=>r?.(e,t)??e,e),rB=class extends rc{_pendingTransforms=[];_baseValue;_cachedValue;constructor(e){super(),this._baseValue=e,this._cachedValue=e}_updateState(){this._cachedValue=this._pendingTransforms.reduce((e,t)=>rN(e,t.task,[t.loading,t.optimistic]),this._baseValue),this._notifySubscribers()}get baseValue(){return this._baseValue}get value(){return this._cachedValue}update(e){this._baseValue=e,this._updateState()}async optimisticUpdate(e){let t=e.execute(),r={...e,task:t};try{this._pendingTransforms.push(r),this._updateState();let s=await t;return this._baseValue=rN(this._baseValue,s,[e.optimistic,e.then]),s}finally{let e=this._pendingTransforms.indexOf(r);e>-1&&this._pendingTransforms.splice(e,1),this._updateState()}}},rj=class e{constructor(e){this.readable=e,this.readable=e}static fromAssistantStream(t){return new e(t.pipeThrough(new t2))}async unstable_result(){let e;for await(let t of this)e=t;return e||{role:"assistant",status:{type:"complete",reason:"unknown"},parts:[],content:[],metadata:{unstable_state:null,unstable_data:[],unstable_annotations:[],steps:[],custom:{}}}}[Symbol.asyncIterator](){let e=this.readable.getReader();return{async next(){let{done:t,value:r}=await e.read();return t?{done:!0,value:void 0}:{done:!1,value:r}}}}tee(){let[t,r]=this.readable.tee();return[new e(t),new e(r)]}},rZ=(e,t)=>{let r=e.threadIdMap[t];if(void 0!==r)return e.threadData[r]},rL=(e,t,r)=>{let s=rZ(e,t);if(!s)return e;let{threadId:a,remoteId:i,status:n}=s;if(n===r)return e;let o={...e};switch(n){case"new":o.newThreadId=void 0;break;case"regular":o.threadIds=o.threadIds.filter(e=>e!==a);break;case"archived":o.archivedThreadIds=o.archivedThreadIds.filter(e=>e!==a);break;default:throw Error("Unsupported state: ".concat(n))}switch(r){case"regular":o.threadIds=[a,...o.threadIds];break;case"archived":o.archivedThreadIds=[a,...o.archivedThreadIds];break;case"deleted":o.threadData=Object.fromEntries(Object.entries(o.threadData).filter(e=>{let[t]=e;return t!==a})),o.threadIdMap=Object.fromEntries(Object.entries(o.threadIdMap).filter(e=>{let[t]=e;return t!==a&&t!==i}));break;default:throw Error("Unsupported state: ".concat(r))}return"deleted"!==r&&(o.threadData={...o.threadData,[a]:{...s,status:r}}),o},r$=class extends rc{getLoadThreadsPromise(){return this._loadThreadsPromise||(this._loadThreadsPromise=this._state.optimisticUpdate({execute:()=>this._options.adapter.list(),loading:e=>({...e,isLoading:!0}),then:(e,t)=>{let r=[],s=[],a={},i={};for(let e of t.threads){switch(e.status){case"regular":r.push(e.remoteId);break;case"archived":s.push(e.remoteId);break;default:{let t=e.status;throw Error("Unsupported state: ".concat(t))}}let t=e.remoteId;a[e.remoteId]=t,i[t]={threadId:e.remoteId,remoteId:e.remoteId,externalId:e.externalId,status:e.status,title:e.title,initializeTask:Promise.resolve({remoteId:e.remoteId,externalId:e.externalId})}}return{...e,threadIds:r,archivedThreadIds:s,threadIdMap:{...e.threadIdMap,...a},threadData:{...e.threadData,...i}}}}).then(()=>{})),this._loadThreadsPromise}__internal_setOptions(e){var t;if(this._options===e)return;this._options=e;let r=null!=(t=e.adapter.unstable_Provider)?t:t3.Fragment;r!==this.useProvider.getState().Provider&&this.useProvider.setState({Provider:r},!0),this._hookManager.setRuntimeHook(e.runtimeHook)}__internal_load(){this.getLoadThreadsPromise()}get threadIds(){return this._state.value.threadIds}get archivedThreadIds(){return this._state.value.archivedThreadIds}get newThreadId(){return this._state.value.newThreadId}get mainThreadId(){return this._mainThreadId}getMainThreadRuntimeCore(){let e=this._hookManager.getThreadRuntimeCore(this._mainThreadId);return e||rM}getThreadRuntimeCore(e){let t=this.getItemById(e);if(!t)throw Error("Thread not found");let r=this._hookManager.getThreadRuntimeCore(t.threadId);if(!r)throw Error("Thread not found");return r}getItemById(e){return rZ(this._state.value,e)}async switchToThread(e){let t=this.getItemById(e);if(!t)throw Error("Thread not found");if(this._mainThreadId===t.threadId)return;let r=this._hookManager.startThreadRuntime(t.threadId);void 0!==this.mainThreadId?await r:r.then(()=>this._notifySubscribers()),"archived"===t.status&&await this.unarchive(t.threadId),this._mainThreadId=t.threadId,this._notifySubscribers()}async switchToNewThread(){for(;void 0!==this._state.baseValue.newThreadId&&void 0===this._state.value.newThreadId;)await this._state.waitForUpdate();let e=this._state.value,t=this._state.value.newThreadId;if(void 0===t){do t="__LOCALID_".concat(rt());while(e.threadIdMap[t]);let r=t;this._state.update({...e,newThreadId:t,threadIdMap:{...e.threadIdMap,[t]:r},threadData:{...e.threadData,[t]:{status:"new",threadId:t}}})}return this.switchToThread(t)}rename(e,t){let r=this.getItemById(e);if(!r)throw Error("Thread not found");if("new"===r.status)throw Error("Thread is not yet initialized");return this._state.optimisticUpdate({execute:async()=>{let{remoteId:e}=await r.initializeTask;return this._options.adapter.rename(e,t)},optimistic:r=>{let s=rZ(r,e);return s?{...r,threadData:{...r.threadData,[s.threadId]:{...s,title:t}}}:r}})}async _ensureThreadIsNotMain(e){if(e===this.newThreadId)throw Error("Cannot ensure new thread is not main");e===this._mainThreadId&&await this.switchToNewThread()}async archive(e){let t=this.getItemById(e);if(!t)throw Error("Thread not found");if("regular"!==t.status)throw Error("Thread is not yet initialized or already archived");return this._state.optimisticUpdate({execute:async()=>{await this._ensureThreadIsNotMain(t.threadId);let{remoteId:e}=await t.initializeTask;return this._options.adapter.archive(e)},optimistic:e=>rL(e,t.threadId,"archived")})}unarchive(e){let t=this.getItemById(e);if(!t)throw Error("Thread not found");if("archived"!==t.status)throw Error("Thread is not archived");return this._state.optimisticUpdate({execute:async()=>{try{let{remoteId:e}=await t.initializeTask;return await this._options.adapter.unarchive(e)}catch(e){throw await this._ensureThreadIsNotMain(t.threadId),e}},optimistic:e=>rL(e,t.threadId,"regular")})}async delete(e){let t=this.getItemById(e);if(!t)throw Error("Thread not found");if("regular"!==t.status&&"archived"!==t.status)throw Error("Thread is not yet initialized");return this._state.optimisticUpdate({execute:async()=>{await this._ensureThreadIsNotMain(t.threadId);let{remoteId:e}=await t.initializeTask;return await this._options.adapter.delete(e)},optimistic:e=>rL(e,t.threadId,"deleted")})}async detach(e){let t=this.getItemById(e);if(!t)throw Error("Thread not found");if("regular"!==t.status&&"archived"!==t.status)throw Error("Thread is not yet initialized");await this._ensureThreadIsNotMain(t.threadId),this._hookManager.stopThreadRuntime(t.threadId)}constructor(e,t){super(),this._state=new rB({isLoading:!1,newThreadId:void 0,threadIds:[],archivedThreadIds:[],threadIdMap:{},threadData:{}}),this.initialize=async e=>{if(this._state.value.newThreadId!==e){let t=this.getItemById(e);if(!t)throw Error("Thread not found");if("new"===t.status)throw Error("Unexpected new state");return t.initializeTask}return this._state.optimisticUpdate({execute:()=>this._options.adapter.initialize(e),optimistic:t=>rL(t,e,"regular"),loading:(t,r)=>({...t,threadData:{...t.threadData,[e]:{...t.threadData[e],initializeTask:r}}}),then:(t,r)=>{let{remoteId:s,externalId:a}=r,i=rZ(t,e);return i?{...t,threadIdMap:{...t.threadIdMap,[s]:e},threadData:{...t.threadData,[e]:{...i,initializeTask:Promise.resolve({remoteId:s,externalId:a}),remoteId:s,externalId:a}}}:t}})},this.generateTitle=async e=>{let t=this.getItemById(e);if(!t)throw Error("Thread not found");if("new"===t.status)throw Error("Thread is not yet initialized");let{remoteId:r}=await t.initializeTask,s=this.getThreadRuntimeCore(e).messages,a=await this._options.adapter.generateTitle(r,s);for await(let e of rj.fromAssistantStream(a)){var i;let r=null==(i=e.parts.filter(e=>"text"===e.type)[0])?void 0:i.text,s=this._state.baseValue;this._state.update({...s,threadData:{...s.threadData,[t.threadId]:{...t,title:r}}})}},this.useBoundIds=(0,rE.v)(()=>[]),this.__internal_RenderComponent=()=>{let e=(0,t3.useId)();(0,t3.useEffect)(()=>(this.useBoundIds.setState(t=>[...t,e],!0),()=>{this.useBoundIds.setState(t=>t.filter(t=>t!==e),!0)}),[e]);let t=this.useBoundIds(),{Provider:r}=this.useProvider(),s={modelContext:this.contextProvider};return(0===t.length||t[0]===e)&&(0,rx.jsx)(rk,{adapters:s,children:(0,rx.jsx)(this._hookManager.__internal_RenderThreadRuntimes,{provider:r})})},this.contextProvider=t,this._state.subscribe(()=>this._notifySubscribers()),this._hookManager=new rO(e.runtimeHook),this.useProvider=(0,rE.v)(()=>{var t;return{Provider:null!=(t=e.adapter.unstable_Provider)?t:t3.Fragment}}),this.__internal_setOptions(e),this.switchToNewThread()}},rD=class{_subscriptions=new Set;_connection;get isConnected(){return!!this._connection}notifySubscribers(){for(let e of this._subscriptions)e()}_updateConnection(){this._subscriptions.size>0?this._connection||(this._connection=this._connect()):(this._connection?.(),this._connection=void 0)}subscribe(e){return this._subscriptions.add(e),this._updateConnection(),()=>{this._subscriptions.delete(e),this._updateConnection()}}},rU=Symbol("skip-update"),rF=class extends rD{constructor(e){super(),this.binding=e}get path(){return this.binding.path}_previousStateDirty=!0;_previousState;getState=()=>{if(!this.isConnected||this._previousStateDirty){let e=this.binding.getState();e!==rU&&(this._previousState=e),this._previousStateDirty=!1}if(void 0===this._previousState)throw Error("Entry not available in the store");return this._previousState};_connect(){return this.binding.subscribe(()=>{this._previousStateDirty=!0,this.notifySubscribers()})}},rz=class{constructor(e,t){this._core=e,this._threadListBinding=t}get path(){return this._core.path}__internal_bindMethods(){this.switchTo=this.switchTo.bind(this),this.rename=this.rename.bind(this),this.archive=this.archive.bind(this),this.unarchive=this.unarchive.bind(this),this.delete=this.delete.bind(this),this.initialize=this.initialize.bind(this),this.generateTitle=this.generateTitle.bind(this),this.subscribe=this.subscribe.bind(this),this.unstable_on=this.unstable_on.bind(this),this.getState=this.getState.bind(this),this.detach=this.detach.bind(this)}getState(){return this._core.getState()}switchTo(){let e=this._core.getState();return this._threadListBinding.switchToThread(e.id)}rename(e){let t=this._core.getState();return this._threadListBinding.rename(t.id,e)}archive(){let e=this._core.getState();return this._threadListBinding.archive(e.id)}unarchive(){let e=this._core.getState();return this._threadListBinding.unarchive(e.id)}delete(){let e=this._core.getState();return this._threadListBinding.delete(e.id)}initialize(){let e=this._core.getState();return this._threadListBinding.initialize(e.id)}generateTitle(){let e=this._core.getState();return this._threadListBinding.generateTitle(e.id)}unstable_on(e,t){let r=this._core.getState().isMain;return this.subscribe(()=>{let s=this._core.getState().isMain;if(r!==s)r=s,("switched-to"!==e||s)&&("switched-away"===e&&s||t())})}subscribe(e){return this._core.subscribe(e)}detach(){let e=this._core.getState();this._threadListBinding.detach(e.id)}},rq=class extends rD{constructor(e){super(),this.binding=e;let t=e.getState();if(t===rU)throw Error("Entry not available in the store");this._previousState=t}get path(){return this.binding.path}_previousState;getState=()=>(this.isConnected||this._syncState(),this._previousState);_syncState(){let e=this.binding.getState();return!(e===rU||function(e,t){if(void 0===e&&void 0===t)return!0;if(void 0===e||void 0===t)return!1;for(let r of Object.keys(e))if(!Object.is(e[r],t[r]))return!1;return!0}(e,this._previousState))&&(this._previousState=e,!0)}_connect(){return this.binding.subscribe(()=>{this._syncState()&&this.notifySubscribers()})}},rV=Symbol("innerMessage"),rJ=(Symbol("innerMessages"),class{constructor(e){this._core=e}get path(){return this._core.path}__internal_bindMethods(){this.getState=this.getState.bind(this),this.remove=this.remove.bind(this),this.subscribe=this.subscribe.bind(this)}getState(){return this._core.getState()}subscribe(e){return this._core.subscribe(e)}}),rK=class extends rJ{constructor(e,t){super(e),this._composerApi=t}remove(){let e=this._composerApi.getState();if(!e)throw Error("Composer is not available");return e.removeAttachment(this.getState().id)}},rW=class extends rK{get source(){return"thread-composer"}},rY=class extends rK{get source(){return"edit-composer"}},rH=class extends rJ{get source(){return"message"}constructor(e){super(e)}remove(){throw Error("Message attachments cannot be removed")}},rG=class extends rD{constructor(e){super(),this.config=e}getState(){return this.config.binding.getState()}outerSubscribe(e){return this.config.binding.subscribe(e)}_connect(){let e=()=>{this.notifySubscribers()},t=this.config.binding.getState(),r=t?.unstable_on(this.config.event,e),s=this.outerSubscribe(()=>{let s=this.config.binding.getState();s!==t&&(t=s,r?.(),r=this.config.binding.getState()?.unstable_on(this.config.event,e))});return()=>{s?.(),r?.()}}},rX=Object.freeze([]),rQ=Object.freeze({}),r0=e=>Object.freeze({type:"thread",isEditing:e?.isEditing??!1,canCancel:e?.canCancel??!1,isEmpty:e?.isEmpty??!0,attachments:e?.attachments??rX,text:e?.text??"",role:e?.role??"user",runConfig:e?.runConfig??rQ,value:e?.text??""}),r1=e=>Object.freeze({type:"edit",isEditing:e?.isEditing??!1,canCancel:e?.canCancel??!1,isEmpty:e?.isEmpty??!0,text:e?.text??"",role:e?.role??"user",attachments:e?.attachments??rX,runConfig:e?.runConfig??rQ,value:e?.text??""}),r2=class{constructor(e){this._core=e}get path(){return this._core.path}__internal_bindMethods(){this.setText=this.setText.bind(this),this.setRunConfig=this.setRunConfig.bind(this),this.getState=this.getState.bind(this),this.subscribe=this.subscribe.bind(this),this.addAttachment=this.addAttachment.bind(this),this.reset=this.reset.bind(this),this.clearAttachments=this.clearAttachments.bind(this),this.send=this.send.bind(this),this.cancel=this.cancel.bind(this),this.setRole=this.setRole.bind(this),this.getAttachmentAccept=this.getAttachmentAccept.bind(this),this.getAttachmentByIndex=this.getAttachmentByIndex.bind(this),this.unstable_on=this.unstable_on.bind(this)}setText(e){let t=this._core.getState();if(!t)throw Error("Composer is not available");t.setText(e)}setRunConfig(e){let t=this._core.getState();if(!t)throw Error("Composer is not available");t.setRunConfig(e)}addAttachment(e){let t=this._core.getState();if(!t)throw Error("Composer is not available");return t.addAttachment(e)}reset(){let e=this._core.getState();if(!e)throw Error("Composer is not available");return e.reset()}clearAttachments(){let e=this._core.getState();if(!e)throw Error("Composer is not available");return e.clearAttachments()}send(){let e=this._core.getState();if(!e)throw Error("Composer is not available");e.send()}cancel(){let e=this._core.getState();if(!e)throw Error("Composer is not available");e.cancel()}setRole(e){let t=this._core.getState();if(!t)throw Error("Composer is not available");t.setRole(e)}subscribe(e){return this._core.subscribe(e)}_eventSubscriptionSubjects=new Map;unstable_on(e,t){let r=this._eventSubscriptionSubjects.get(e);return r||(r=new rG({event:e,binding:this._core}),this._eventSubscriptionSubjects.set(e,r)),r.subscribe(t)}getAttachmentAccept(){let e=this._core.getState();if(!e)throw Error("Composer is not available");return e.getAttachmentAccept()}},r4=class extends r2{get path(){return this._core.path}get type(){return"thread"}_getState;constructor(e){let t=new rF({path:e.path,getState:()=>r0(e.getState()),subscribe:t=>e.subscribe(t)});super({path:e.path,getState:()=>e.getState(),subscribe:e=>t.subscribe(e)}),this._getState=t.getState.bind(t)}getState(){return this._getState()}getAttachmentByIndex(e){return new rW(new rq({path:{...this.path,attachmentSource:"thread-composer",attachmentSelector:{type:"index",index:e},ref:this.path.ref+`${this.path.ref}.attachments[${e}]`},getState:()=>{let t=this.getState().attachments[e];return t?{...t,source:"thread-composer"}:rU},subscribe:e=>this._core.subscribe(e)}),this._core)}},r9=class extends r2{constructor(e,t){let r=new rF({path:e.path,getState:()=>r1(e.getState()),subscribe:t=>e.subscribe(t)});super({path:e.path,getState:()=>e.getState(),subscribe:e=>r.subscribe(e)}),this._beginEdit=t,this._getState=r.getState.bind(r)}get path(){return this._core.path}get type(){return"edit"}_getState;__internal_bindMethods(){super.__internal_bindMethods(),this.beginEdit=this.beginEdit.bind(this)}getState(){return this._getState()}beginEdit(){this._beginEdit()}getAttachmentByIndex(e){return new rY(new rq({path:{...this.path,attachmentSource:"edit-composer",attachmentSelector:{type:"index",index:e},ref:this.path.ref+`${this.path.ref}.attachments[${e}]`},getState:()=>{let t=this.getState().attachments[e];return t?{...t,source:"edit-composer"}:rU},subscribe:e=>this._core.subscribe(e)}),this._core)}},r5=class{constructor(e,t,r){this.contentBinding=e,this.messageApi=t,this.threadApi=r}get path(){return this.contentBinding.path}__internal_bindMethods(){this.addToolResult=this.addToolResult.bind(this),this.getState=this.getState.bind(this),this.subscribe=this.subscribe.bind(this)}getState(){return this.contentBinding.getState()}addToolResult(e){let t=this.contentBinding.getState();if(!t)throw Error("Content part is not available");if("tool-call"!==t.type)throw Error("Tried to add tool result to non-tool content part");if(!this.messageApi)throw Error("Message API is not available. This is likely a bug in assistant-ui.");if(!this.threadApi)throw Error("Thread API is not available");let r=this.messageApi.getState();if(!r)throw Error("Message is not available");let s=t.toolName,a=t.toolCallId,i=tw.toResponse(e);this.threadApi.getState().addToolResult({messageId:r.id,toolName:s,toolCallId:a,result:i.result,artifact:i.artifact,isError:i.isError})}subscribe(e){return this.contentBinding.subscribe(e)}},r6=class extends rD{constructor(e){super(),this.binding=e}get path(){return this.binding.path}getState(){return this.binding.getState()}outerSubscribe(e){return this.binding.subscribe(e)}_connect(){let e=()=>{this.notifySubscribers()},t=this.binding.getState(),r=t?.subscribe(e),s=this.outerSubscribe(()=>{let s=this.binding.getState();s!==t&&(t=s,r?.(),r=this.binding.getState()?.subscribe(e),e())});return()=>{s?.(),r?.()}}},r3=Object.freeze({type:"complete"}),r8=(e,t,r)=>{if("assistant"!==e.role)return r3;if("tool-call"===r.type)if(!r.result)return e.status;else return r3;let s=t===Math.max(0,e.content.length-1);return"requires-action"===e.status.type?r3:s?e.status:r3},r7=(e,t)=>{let r=e.content[t];if(!r)return rU;let s=r8(e,t,r);return Object.freeze({...r,...{[rV]:r[rV]},status:s})},se=class{constructor(e,t){this._core=e,this._threadBinding=t,this.composer=new r9(new r6({path:{...this.path,ref:this.path.ref+`${this.path.ref}.composer`,composerSource:"edit"},getState:this._getEditComposerRuntimeCore,subscribe:e=>this._threadBinding.subscribe(e)}),()=>this._threadBinding.getState().beginEdit(this._core.getState().id))}get path(){return this._core.path}__internal_bindMethods(){this.reload=this.reload.bind(this),this.getState=this.getState.bind(this),this.subscribe=this.subscribe.bind(this),this.getContentPartByIndex=this.getContentPartByIndex.bind(this),this.getContentPartByToolCallId=this.getContentPartByToolCallId.bind(this),this.getAttachmentByIndex=this.getAttachmentByIndex.bind(this),this.unstable_getCopyText=this.unstable_getCopyText.bind(this),this.speak=this.speak.bind(this),this.stopSpeaking=this.stopSpeaking.bind(this),this.submitFeedback=this.submitFeedback.bind(this),this.switchToBranch=this.switchToBranch.bind(this)}composer;_getEditComposerRuntimeCore=()=>this._threadBinding.getState().getEditComposer(this._core.getState().id);getState(){return this._core.getState()}reload(e={}){let t=this._getEditComposerRuntimeCore(),r=t??this._threadBinding.getState().composer,{runConfig:s=(t??r).runConfig}=e,a=this._core.getState();if("assistant"!==a.role)throw Error("Can only reload assistant messages");this._threadBinding.getState().startRun({parentId:a.parentId,sourceId:a.id,runConfig:s})}speak(){let e=this._core.getState();return this._threadBinding.getState().speak(e.id)}stopSpeaking(){let e=this._core.getState(),t=this._threadBinding.getState();if(t.speech?.messageId===e.id)this._threadBinding.getState().stopSpeaking();else throw Error("Message is not being spoken")}submitFeedback({type:e}){let t=this._core.getState();this._threadBinding.getState().submitFeedback({messageId:t.id,type:e})}switchToBranch({position:e,branchId:t}){let r=this._core.getState();if(t&&e)throw Error("May not specify both branchId and position");if(!t&&!e)throw Error("Must specify either branchId or position");let s=this._threadBinding.getState().getBranches(r.id),a=t;if("previous"===e?a=s[r.branchNumber-2]:"next"===e&&(a=s[r.branchNumber]),!a)throw Error("Branch not found");this._threadBinding.getState().switchToBranch(a)}unstable_getCopyText(){return rg(this.getState())}subscribe(e){return this._core.subscribe(e)}getContentPartByIndex(e){if(e<0)throw Error("Content part index must be >= 0");return new r5(new rq({path:{...this.path,ref:this.path.ref+`${this.path.ref}.content[${e}]`,contentPartSelector:{type:"index",index:e}},getState:()=>r7(this.getState(),e),subscribe:e=>this._core.subscribe(e)}),this._core,this._threadBinding)}getContentPartByToolCallId(e){return new r5(new rq({path:{...this.path,ref:this.path.ref+`${this.path.ref}.content[toolCallId=${JSON.stringify(e)}]`,contentPartSelector:{type:"toolCallId",toolCallId:e}},getState:()=>{let t=this._core.getState(),r=t.content.findIndex(t=>"tool-call"===t.type&&t.toolCallId===e);return -1===r?rU:r7(t,r)},subscribe:e=>this._core.subscribe(e)}),this._core,this._threadBinding)}getAttachmentByIndex(e){return new rH(new rq({path:{...this.path,ref:this.path.ref+`${this.path.ref}.attachments[${e}]`,attachmentSource:"message",attachmentSelector:{type:"index",index:e}},getState:()=>{let t=this.getState().attachments,r=t?.[e];return r?{...r,source:"message"}:rU},subscribe:e=>this._core.subscribe(e)}))}},st=e=>({parentId:e.parentId??null,sourceId:e.sourceId??null,runConfig:e.runConfig??{},stream:e.stream}),sr=e=>({parentId:e.parentId??null,sourceId:e.sourceId??null,runConfig:e.runConfig??{}}),ss=(e,t)=>"string"==typeof t?{createdAt:new Date,parentId:e.at(-1)?.id??null,sourceId:null,runConfig:{},role:"user",content:[{type:"text",text:t}],attachments:[],metadata:{custom:{}}}:t.role&&t.parentId&&t.attachments?t:{...t,parentId:t.parentId??e.at(-1)?.id??null,sourceId:t.sourceId??null,role:t.role??"user",attachments:t.attachments??[]},sa=(e,t)=>{let r=e.messages.at(-1);return Object.freeze({threadId:t.id,metadata:t,capabilities:e.capabilities,isDisabled:e.isDisabled,isRunning:r?.role==="assistant"&&"running"===r.status.type,messages:e.messages,state:e.state,suggestions:e.suggestions,extras:e.extras,speech:e.speech})},si=class{get path(){return this._threadBinding.path}get __internal_threadBinding(){return this._threadBinding}_threadBinding;constructor(e,t){let r=new rq({path:e.path,getState:()=>sa(e.getState(),t.getState()),subscribe:r=>{let s=e.subscribe(r),a=t.subscribe(r);return()=>{s(),a()}}});this._threadBinding={path:e.path,getState:()=>e.getState(),getStateState:()=>r.getState(),outerSubscribe:t=>e.outerSubscribe(t),subscribe:t=>e.subscribe(t)},this.composer=new r4(new r6({path:{...this.path,ref:this.path.ref+`${this.path.ref}.composer`,composerSource:"thread"},getState:()=>this._threadBinding.getState().composer,subscribe:e=>this._threadBinding.subscribe(e)}))}__internal_bindMethods(){this.append=this.append.bind(this),this.unstable_resumeRun=this.unstable_resumeRun.bind(this),this.startRun=this.startRun.bind(this),this.cancelRun=this.cancelRun.bind(this),this.stopSpeaking=this.stopSpeaking.bind(this),this.export=this.export.bind(this),this.import=this.import.bind(this),this.getMesssageByIndex=this.getMesssageByIndex.bind(this),this.getMesssageById=this.getMesssageById.bind(this),this.subscribe=this.subscribe.bind(this),this.unstable_on=this.unstable_on.bind(this),this.getModelContext=this.getModelContext.bind(this),this.getModelConfig=this.getModelConfig.bind(this),this.getState=this.getState.bind(this)}composer;getState(){return this._threadBinding.getStateState()}append(e){this._threadBinding.getState().append(ss(this._threadBinding.getState().messages,e))}subscribe(e){return this._threadBinding.subscribe(e)}getModelContext(){return this._threadBinding.getState().getModelContext()}getModelConfig(){return this.getModelContext()}startRun(e){return this._threadBinding.getState().startRun(sr(null===e||"string"==typeof e?{parentId:e}:e))}unstable_resumeRun(e){return this._threadBinding.getState().resumeRun(st(e))}cancelRun(){this._threadBinding.getState().cancelRun()}stopSpeaking(){return this._threadBinding.getState().stopSpeaking()}export(){return this._threadBinding.getState().export()}import(e){this._threadBinding.getState().import(e)}getMesssageByIndex(e){if(e<0)throw Error("Message index must be >= 0");return this._getMessageRuntime({...this.path,ref:this.path.ref+`${this.path.ref}.messages[${e}]`,messageSelector:{type:"index",index:e}},()=>{let t=this._threadBinding.getState().messages,r=t[e];if(r)return{message:r,parentId:t[e-1]?.id??null}})}getMesssageById(e){return this._getMessageRuntime({...this.path,ref:this.path.ref+`${this.path.ref}.messages[messageId=${JSON.stringify(e)}]`,messageSelector:{type:"messageId",messageId:e}},()=>this._threadBinding.getState().getMessageById(e))}_getMessageRuntime(e,t){return new se(new rq({path:e,getState:()=>{let{message:e,parentId:r}=t()??{},{messages:s,speech:a}=this._threadBinding.getState();if(!e||void 0===r)return rU;let i=this._threadBinding.getState(),n=i.getBranches(e.id),o=i.getSubmittedFeedback(e.id);return{...e,...{[rV]:e[rV]},isLast:s.at(-1)?.id===e.id,parentId:r,branchNumber:n.indexOf(e.id)+1,branchCount:n.length,speech:a?.messageId===e.id?a:void 0,submittedFeedback:o}},subscribe:e=>this._threadBinding.subscribe(e)}),this._threadBinding)}_eventSubscriptionSubjects=new Map;unstable_on(e,t){let r=this._eventSubscriptionSubjects.get(e);return r||(r=new rG({event:e,binding:this._threadBinding}),this._eventSubscriptionSubjects.set(e,r)),r.subscribe(t)}},sn=e=>({mainThreadId:e.mainThreadId,newThread:e.newThreadId,threads:e.threadIds,archivedThreads:e.archivedThreadIds}),so=(e,t)=>{if(void 0===t)return rU;let r=e.getItemById(t);return r?{id:r.threadId,threadId:r.threadId,remoteId:r.remoteId,externalId:r.externalId,title:r.title,status:r.status,isMain:r.threadId===e.mainThreadId}:rU},su=class{constructor(e,t=si){this._core=e,this._runtimeFactory=t;let r=new rF({path:{},getState:()=>sn(e),subscribe:t=>e.subscribe(t)});this._getState=r.getState.bind(r),this._mainThreadListItemRuntime=new rz(new rq({path:{ref:"threadItems[main]",threadSelector:{type:"main"}},getState:()=>so(this._core,this._core.mainThreadId),subscribe:e=>this._core.subscribe(e)}),this._core),this.main=new t(new r6({path:{ref:"threads.main",threadSelector:{type:"main"}},getState:()=>e.getMainThreadRuntimeCore(),subscribe:t=>e.subscribe(t)}),this._mainThreadListItemRuntime)}_getState;__internal_bindMethods(){this.switchToThread=this.switchToThread.bind(this),this.switchToNewThread=this.switchToNewThread.bind(this),this.getState=this.getState.bind(this),this.subscribe=this.subscribe.bind(this),this.getById=this.getById.bind(this),this.getItemById=this.getItemById.bind(this),this.getItemByIndex=this.getItemByIndex.bind(this),this.getArchivedItemByIndex=this.getArchivedItemByIndex.bind(this)}switchToThread(e){return this._core.switchToThread(e)}switchToNewThread(){return this._core.switchToNewThread()}getState(){return this._getState()}subscribe(e){return this._core.subscribe(e)}_mainThreadListItemRuntime;main;get mainItem(){return this._mainThreadListItemRuntime}getById(e){return new this._runtimeFactory(new r6({path:{ref:"threads[threadId="+JSON.stringify(e)+"]",threadSelector:{type:"threadId",threadId:e}},getState:()=>this._core.getThreadRuntimeCore(e),subscribe:e=>this._core.subscribe(e)}),this.mainItem)}getItemByIndex(e){return new rz(new rq({path:{ref:`threadItems[${e}]`,threadSelector:{type:"index",index:e}},getState:()=>so(this._core,this._core.threadIds[e]),subscribe:e=>this._core.subscribe(e)}),this._core)}getArchivedItemByIndex(e){return new rz(new rq({path:{ref:`archivedThreadItems[${e}]`,threadSelector:{type:"archiveIndex",index:e}},getState:()=>so(this._core,this._core.archivedThreadIds[e]),subscribe:e=>this._core.subscribe(e)}),this._core)}getItemById(e){return new rz(new rq({path:{ref:`threadItems[threadId=${e}]`,threadSelector:{type:"threadId",threadId:e}},getState:()=>so(this._core,e),subscribe:e=>this._core.subscribe(e)}),this._core)}},sl=class{constructor(e){this._core=e,this.threads=new su(e.threads),this._thread=this.threads.main}threads;get threadList(){return this.threads}_thread;__internal_bindMethods(){this.switchToNewThread=this.switchToNewThread.bind(this),this.switchToThread=this.switchToThread.bind(this),this.registerModelContextProvider=this.registerModelContextProvider.bind(this),this.registerModelConfigProvider=this.registerModelConfigProvider.bind(this),this.reset=this.reset.bind(this)}get thread(){return this._thread}switchToNewThread(){return this._core.threads.switchToNewThread()}switchToThread(e){return this._core.threads.switchToThread(e)}registerModelContextProvider(e){return this._core.registerModelContextProvider(e)}registerModelConfigProvider(e){return this.registerModelContextProvider(e)}reset({initialMessages:e}={}){return this._core.threads.getMainThreadRuntimeCore().import(ru.fromArray(e??[]))}},sh=class extends re{get RenderComponent(){return this.threads.__internal_RenderComponent}constructor(e){super(),this.threads=new r$(e,this._contextProvider)}},sd=e=>{let[t]=(0,t3.useState)(()=>new sh(e));return(0,t3.useEffect)(()=>{t.threads.__internal_setOptions(e),t.threads.__internal_load()},[t,e]),(0,t3.useMemo)(()=>new sl(t),[t])},sc=e=>{try{let t=e.split(".")[1];if(!t)throw Error("Invalid JWT format");let r=t.replace(/-/g,"+").replace(/_/g,"/");for(;r.length%4!=0;)r+="=";let s=atob(r),a=JSON.parse(s).exp;if(!a||"number"!=typeof a)throw Error('JWT does not contain a valid "exp" field');return 1e3*a}catch(e){throw Error("Unable to determine the token expiry: "+e)}},sp=class{strategy="jwt";cachedToken=null;tokenExpiry=null;#e;constructor(e){this.#e=e}async getAuthHeaders(){let e=Date.now();if(this.cachedToken&&this.tokenExpiry&&this.tokenExpiry-e>3e4)return{Authorization:`Bearer ${this.cachedToken}`};let t=await this.#e();return!!t&&(this.cachedToken=t,this.tokenExpiry=sc(t),{Authorization:`Bearer ${t}`})}readAuthHeaders(e){let t=e.get("Authorization");if(!t)return;let[r,s]=t.split(" ");if("Bearer"!==r||!s)throw Error("Invalid auth header received");this.cachedToken=s,this.tokenExpiry=sc(s)}},sf=class{strategy="api-key";#t;#r;#s;constructor(e,t,r){this.#t=e,this.#r=t,this.#s=r}async getAuthHeaders(){return{Authorization:`Bearer ${this.#t}`,"Aui-User-Id":this.#r,"Aui-Workspace-Id":this.#s}}readAuthHeaders(){}},sm="aui:refresh_token",sg=class{strategy="anon";baseUrl;jwtStrategy;constructor(e){this.baseUrl=e,this.jwtStrategy=new sp(async()=>{let e=Date.now(),t=localStorage.getItem(sm),r=t?JSON.parse(t):void 0;if(r)if(new Date(r.expires_at).getTime()-e>3e4){let e=await fetch(`${this.baseUrl}/v1/auth/tokens/refresh`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refresh_token:r.token})});if(e.ok){let{access_token:t,refresh_token:r}=await e.json();return r&&localStorage.setItem(sm,JSON.stringify(r)),t}}else localStorage.removeItem(sm);let s=await fetch(`${this.baseUrl}/v1/auth/tokens/anonymous`,{method:"POST"});if(!s.ok)return null;let{access_token:a,refresh_token:i}=await s.json();return a&&i?(localStorage.setItem(sm,JSON.stringify(i)),a):null})}async getAuthHeaders(){return this.jwtStrategy.getAuthHeaders()}readAuthHeaders(e){this.jwtStrategy.readAuthHeaders(e)}},sy=class extends Error{constructor(e){super(e),this.name="APIError"}},s_=class{_auth;_baseUrl;constructor(e){if("authToken"in e)this._baseUrl=e.baseUrl,this._auth=new sp(e.authToken);else if("apiKey"in e)this._baseUrl="https://backend.assistant-api.com",this._auth=new sf(e.apiKey,e.userId,e.workspaceId);else if("anonymous"in e)this._baseUrl=e.baseUrl,this._auth=new sg(e.baseUrl);else throw Error("Invalid configuration: Must provide authToken, apiKey, or anonymous configuration")}async initializeAuth(){return!!this._auth.getAuthHeaders()}async makeRawRequest(e,t={}){let r=await this._auth.getAuthHeaders();if(!r)throw Error("Authorization failed");let s={...r,...t.headers,"Content-Type":"application/json"},a=new URLSearchParams;if(t.query)for(let[e,r]of Object.entries(t.query))!1!==r&&(!0===r?a.set(e,"true"):a.set(e,r.toString()));let i=new URL(`${this._baseUrl}/v1${e}`);i.search=a.toString();let n=await fetch(i,{method:t.method??"GET",headers:s,body:t.body?JSON.stringify(t.body):null});if(this._auth.readAuthHeaders(n.headers),!n.ok){let e=await n.text();try{let t=JSON.parse(e);throw new sy(t.message)}catch{throw Error(`Request failed with status ${n.status}, ${e}`)}}return n}async makeRequest(e,t={}){return(await this.makeRawRequest(e,t)).json()}},sb=class{constructor(e){this.cloud=e}async create(){return this.cloud.makeRequest("/auth/tokens",{method:"POST"})}},sv={toResponse:(e,t)=>new Response(sv.toByteStream(e,t),{headers:t.headers??{}}),fromResponse:(e,t)=>sv.fromByteStream(e.body,t),toByteStream:(e,t)=>e.pipeThrough(t),fromByteStream:(e,t)=>e.pipeThrough(t)},sw=class extends tp{constructor(){super(e=>{let t=new tc({transform(e,t){t.appendText(e)}});return e.pipeThrough(new TextDecoderStream).pipeThrough(t)})}},sS=class{constructor(e){this.cloud=e}__internal_getAssistantOptions(e){return{api:this.cloud._baseUrl+"/v1/runs/stream",headers:async()=>{let e=await this.cloud._auth.getAuthHeaders();if(!e)throw Error("Authorization failed");return{...e,Accept:"text/plain"}},body:{assistant_id:e,response_format:"vercel-ai-data-stream/v1",thread_id:"unstable_todo"}}}async stream(e){let t=await this.cloud.makeRawRequest("/runs/stream",{method:"POST",headers:{Accept:"text/plain"},body:e});return sv.fromResponse(t,new sw)}},sx=class{constructor(e){this.cloud=e}async list(e){return this.cloud.makeRequest(`/threads/${encodeURIComponent(e)}/messages`)}async create(e,t){return this.cloud.makeRequest(`/threads/${encodeURIComponent(e)}/messages`,{method:"POST",body:t})}},sT=class{constructor(e){this.cloud=e,this.messages=new sx(e)}messages;async list(e){return this.cloud.makeRequest("/threads",{query:e})}async create(e){return this.cloud.makeRequest("/threads",{method:"POST",body:e})}async update(e,t){return this.cloud.makeRequest(`/threads/${encodeURIComponent(e)}`,{method:"PUT",body:t})}async delete(e){return this.cloud.makeRequest(`/threads/${encodeURIComponent(e)}`,{method:"DELETE"})}},sk=class{threads;auth;runs;constructor(e){let t=new s_(e);this.threads=new sT(t),this.auth={tokens:new sb(t)},this.runs=new sS(t)}},sI=e=>({role:e.role,content:e.content.map(e=>{let t=e.type;switch(t){case"text":return{type:"text",text:e.text};case"reasoning":return{type:"reasoning",text:e.text};case"source":return{type:"source",sourceType:e.sourceType,id:e.id,url:e.url,...e.title?{title:e.title}:void 0};case"tool-call":return function e(t,r=0){return!(r>100)&&(null===t||"string"==typeof t||"boolean"==typeof t||("number"==typeof t?!Number.isNaN(t)&&Number.isFinite(t):Array.isArray(t)?t.every(t=>e(t,r+1)):"object"==typeof t&&Object.entries(t).every(([t,s])=>"string"==typeof t&&e(s,r+1))))}(e.result)||console.warn("tool-call result is not JSON! "+JSON.stringify(e)),{type:"tool-call",toolCallId:e.toolCallId,toolName:e.toolName,...JSON.stringify(e.args)===e.argsText?{args:e.args}:{argsText:e.argsText},...e.result?{result:e.result}:{},...e.isError?{isError:!0}:{}};default:throw Error(`Content part type not supported by aui/v0: ${t}`)}}),metadata:e.metadata,...e.status?{status:e.status?.type==="running"?{type:"incomplete",reason:"cancelled"}:e.status}:void 0}),sE=e=>{let t=e.content,r=rs({id:e.id,createdAt:e.created_at,...t},e.id,{type:"complete",reason:"unknown"});return{parentId:e.parent_id,message:r}},sA=class{constructor(e,t){this.cloudRef=e,this.threadListItemRuntime=t}_getIdForLocalId={};async append({parentId:e,message:t}){let{remoteId:r}=await this.threadListItemRuntime.initialize(),s=this.cloudRef.current.threads.messages.create(r,{parent_id:e?await this._getIdForLocalId[e]??e:null,format:"aui/v0",content:sI(t)}).then(({message_id:e})=>(this._getIdForLocalId[t.id]=e,e));return this._getIdForLocalId[t.id]=s,s.then(()=>{})}async load(){let e=this.threadListItemRuntime.getState().remoteId;if(!e)return{messages:[]};let{messages:t}=await this.cloudRef.current.threads.messages.list(e);return{messages:t.filter(e=>"aui/v0"===e.format).map(sE).reverse()}}},sC=e=>{let t=(0,rR.pK)(),[r]=(0,t3.useState)(()=>new sA(e,t));return r},sR=class{list(){return Promise.resolve({threads:[]})}rename(){return Promise.resolve()}archive(){return Promise.resolve()}unarchive(){return Promise.resolve()}delete(){return Promise.resolve()}initialize(e){return Promise.resolve({remoteId:e,externalId:void 0})}generateTitle(){return Promise.resolve(new ReadableStream)}},sO=r(9509),sP=void 0!==sO&&sO?.env?.NEXT_PUBLIC_ASSISTANT_BASE_URL,sM=sP?new sk({baseUrl:sP,anonymous:!0}):void 0,sN=e=>{let t=(0,t3.useRef)(e);(0,t3.useEffect)(()=>{t.current=e},[e]);let r=(0,t3.useCallback)(function({children:e}){let r=sC({get current(){return t.current.cloud??sM}}),s=(0,t3.useMemo)(()=>({history:r}),[r]);return(0,rx.jsx)(rk,{adapters:s,children:e})},[]),s=e.cloud??sM;return s?{list:async()=>{let{threads:e}=await s.threads.list();return{threads:e.map(e=>({status:e.is_archived?"archived":"regular",remoteId:e.id,title:e.title,externalId:e.external_id??void 0}))}},initialize:async()=>{let t=e.create?.()??Promise.resolve(),r=await t,a=r?r.externalId:void 0,{thread_id:i}=await s.threads.create({last_message_at:new Date,external_id:a});return{externalId:a,remoteId:i}},rename:async(e,t)=>s.threads.update(e,{title:t}),archive:async e=>s.threads.update(e,{is_archived:!0}),unarchive:async e=>s.threads.update(e,{is_archived:!1}),delete:async t=>(await e.delete?.(t),s.threads.delete(t)),generateTitle:async(e,t)=>s.runs.stream({thread_id:e,assistant_id:"system/thread_title",messages:t}),unstable_Provider:r}:new sR},sB=(e,t)=>{var r;let{initialMessages:s,...a}=t,{modelContext:i,...n}=null!=(r=rI())?r:{},o=(0,t3.useMemo)(()=>({...a,adapters:{...n,...a.adapters,chatModel:e}}),[e,a,n]),[u]=(0,t3.useState)(()=>new rS(o,s));return(0,t3.useEffect)(()=>()=>{u.threads.getMainThreadRuntimeCore().detach()},[u]),(0,t3.useEffect)(()=>{u.threads.getMainThreadRuntimeCore().__internal_setOptions(o),u.threads.getMainThreadRuntimeCore().__internal_load()},[u,o]),(0,t3.useEffect)(()=>{if(i)return u.registerModelContextProvider(i)},[i,u]),(0,t3.useMemo)(()=>new sl(u),[u])},sj=function(e){let{cloud:t,...r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return sd({runtimeHook:function(){return sB(e,r)},adapter:sN({cloud:t})})},{yM:sZ}=l,sL=e=>{let{localRuntimeOptions:t,otherOptions:r}=sZ(e);return sj(new t5(r),t)},s$=e=>sL({...e,unstable_AISDKInterop:"v2"})},9641:e=>{!function(){var t={675:function(e,t){"use strict";t.byteLength=function(e){var t=u(e),r=t[0],s=t[1];return(r+s)*3/4-s},t.toByteArray=function(e){var t,r,i=u(e),n=i[0],o=i[1],l=new a((n+o)*3/4-o),h=0,d=o>0?n-4:n;for(r=0;r<d;r+=4)t=s[e.charCodeAt(r)]<<18|s[e.charCodeAt(r+1)]<<12|s[e.charCodeAt(r+2)]<<6|s[e.charCodeAt(r+3)],l[h++]=t>>16&255,l[h++]=t>>8&255,l[h++]=255&t;return 2===o&&(t=s[e.charCodeAt(r)]<<2|s[e.charCodeAt(r+1)]>>4,l[h++]=255&t),1===o&&(t=s[e.charCodeAt(r)]<<10|s[e.charCodeAt(r+1)]<<4|s[e.charCodeAt(r+2)]>>2,l[h++]=t>>8&255,l[h++]=255&t),l},t.fromByteArray=function(e){for(var t,s=e.length,a=s%3,i=[],n=0,o=s-a;n<o;n+=16383)i.push(function(e,t,s){for(var a,i=[],n=t;n<s;n+=3)a=(e[n]<<16&0xff0000)+(e[n+1]<<8&65280)+(255&e[n+2]),i.push(r[a>>18&63]+r[a>>12&63]+r[a>>6&63]+r[63&a]);return i.join("")}(e,n,n+16383>o?o:n+16383));return 1===a?i.push(r[(t=e[s-1])>>2]+r[t<<4&63]+"=="):2===a&&i.push(r[(t=(e[s-2]<<8)+e[s-1])>>10]+r[t>>4&63]+r[t<<2&63]+"="),i.join("")};for(var r=[],s=[],a="undefined"!=typeof Uint8Array?Uint8Array:Array,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n=0,o=i.length;n<o;++n)r[n]=i[n],s[i.charCodeAt(n)]=n;function u(e){var t=e.length;if(t%4>0)throw Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");-1===r&&(r=t);var s=r===t?0:4-r%4;return[r,s]}s[45]=62,s[95]=63},72:function(e,t,r){"use strict";var s=r(675),a=r(783),i="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;function n(e){if(e>0x7fffffff)throw RangeError('The value "'+e+'" is invalid for option "size"');var t=new Uint8Array(e);return Object.setPrototypeOf(t,o.prototype),t}function o(e,t,r){if("number"==typeof e){if("string"==typeof t)throw TypeError('The "string" argument must be of type string. Received type number');return h(e)}return u(e,t,r)}function u(e,t,r){if("string"==typeof e){var s=e,a=t;if(("string"!=typeof a||""===a)&&(a="utf8"),!o.isEncoding(a))throw TypeError("Unknown encoding: "+a);var i=0|p(s,a),u=n(i),l=u.write(s,a);return l!==i&&(u=u.slice(0,l)),u}if(ArrayBuffer.isView(e))return d(e);if(null==e)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(C(e,ArrayBuffer)||e&&C(e.buffer,ArrayBuffer)||"undefined"!=typeof SharedArrayBuffer&&(C(e,SharedArrayBuffer)||e&&C(e.buffer,SharedArrayBuffer)))return function(e,t,r){var s;if(t<0||e.byteLength<t)throw RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(r||0))throw RangeError('"length" is outside of buffer bounds');return Object.setPrototypeOf(s=void 0===t&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,t):new Uint8Array(e,t,r),o.prototype),s}(e,t,r);if("number"==typeof e)throw TypeError('The "value" argument must not be of type number. Received type number');var h=e.valueOf&&e.valueOf();if(null!=h&&h!==e)return o.from(h,t,r);var f=function(e){if(o.isBuffer(e)){var t=0|c(e.length),r=n(t);return 0===r.length||e.copy(r,0,0,t),r}return void 0!==e.length?"number"!=typeof e.length||function(e){return e!=e}(e.length)?n(0):d(e):"Buffer"===e.type&&Array.isArray(e.data)?d(e.data):void 0}(e);if(f)return f;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return o.from(e[Symbol.toPrimitive]("string"),t,r);throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function l(e){if("number"!=typeof e)throw TypeError('"size" argument must be of type number');if(e<0)throw RangeError('The value "'+e+'" is invalid for option "size"')}function h(e){return l(e),n(e<0?0:0|c(e))}function d(e){for(var t=e.length<0?0:0|c(e.length),r=n(t),s=0;s<t;s+=1)r[s]=255&e[s];return r}t.Buffer=o,t.SlowBuffer=function(e){return+e!=e&&(e=0),o.alloc(+e)},t.INSPECT_MAX_BYTES=50,t.kMaxLength=0x7fffffff,o.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),o.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(o.prototype,"parent",{enumerable:!0,get:function(){if(o.isBuffer(this))return this.buffer}}),Object.defineProperty(o.prototype,"offset",{enumerable:!0,get:function(){if(o.isBuffer(this))return this.byteOffset}}),o.poolSize=8192,o.from=function(e,t,r){return u(e,t,r)},Object.setPrototypeOf(o.prototype,Uint8Array.prototype),Object.setPrototypeOf(o,Uint8Array),o.alloc=function(e,t,r){return(l(e),e<=0)?n(e):void 0!==t?"string"==typeof r?n(e).fill(t,r):n(e).fill(t):n(e)},o.allocUnsafe=function(e){return h(e)},o.allocUnsafeSlow=function(e){return h(e)};function c(e){if(e>=0x7fffffff)throw RangeError("Attempt to allocate Buffer larger than maximum size: 0x7fffffff bytes");return 0|e}function p(e,t){if(o.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||C(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);var r=e.length,s=arguments.length>2&&!0===arguments[2];if(!s&&0===r)return 0;for(var a=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return k(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return E(e).length;default:if(a)return s?-1:k(e).length;t=(""+t).toLowerCase(),a=!0}}function f(e,t,r){var a,i,n,o=!1;if((void 0===t||t<0)&&(t=0),t>this.length||((void 0===r||r>this.length)&&(r=this.length),r<=0||(r>>>=0)<=(t>>>=0)))return"";for(e||(e="utf8");;)switch(e){case"hex":return function(e,t,r){var s=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>s)&&(r=s);for(var a="",i=t;i<r;++i)a+=R[e[i]];return a}(this,t,r);case"utf8":case"utf-8":return _(this,t,r);case"ascii":return function(e,t,r){var s="";r=Math.min(e.length,r);for(var a=t;a<r;++a)s+=String.fromCharCode(127&e[a]);return s}(this,t,r);case"latin1":case"binary":return function(e,t,r){var s="";r=Math.min(e.length,r);for(var a=t;a<r;++a)s+=String.fromCharCode(e[a]);return s}(this,t,r);case"base64":return a=this,i=t,n=r,0===i&&n===a.length?s.fromByteArray(a):s.fromByteArray(a.slice(i,n));case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return function(e,t,r){for(var s=e.slice(t,r),a="",i=0;i<s.length;i+=2)a+=String.fromCharCode(s[i]+256*s[i+1]);return a}(this,t,r);default:if(o)throw TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),o=!0}}function m(e,t,r){var s=e[t];e[t]=e[r],e[r]=s}function g(e,t,r,s,a){var i;if(0===e.length)return -1;if("string"==typeof r?(s=r,r=0):r>0x7fffffff?r=0x7fffffff:r<-0x80000000&&(r=-0x80000000),(i=r*=1)!=i&&(r=a?0:e.length-1),r<0&&(r=e.length+r),r>=e.length)if(a)return -1;else r=e.length-1;else if(r<0)if(!a)return -1;else r=0;if("string"==typeof t&&(t=o.from(t,s)),o.isBuffer(t))return 0===t.length?-1:y(e,t,r,s,a);if("number"==typeof t){if(t&=255,"function"==typeof Uint8Array.prototype.indexOf)if(a)return Uint8Array.prototype.indexOf.call(e,t,r);else return Uint8Array.prototype.lastIndexOf.call(e,t,r);return y(e,[t],r,s,a)}throw TypeError("val must be string, number or Buffer")}function y(e,t,r,s,a){var i,n=1,o=e.length,u=t.length;if(void 0!==s&&("ucs2"===(s=String(s).toLowerCase())||"ucs-2"===s||"utf16le"===s||"utf-16le"===s)){if(e.length<2||t.length<2)return -1;n=2,o/=2,u/=2,r/=2}function l(e,t){return 1===n?e[t]:e.readUInt16BE(t*n)}if(a){var h=-1;for(i=r;i<o;i++)if(l(e,i)===l(t,-1===h?0:i-h)){if(-1===h&&(h=i),i-h+1===u)return h*n}else -1!==h&&(i-=i-h),h=-1}else for(r+u>o&&(r=o-u),i=r;i>=0;i--){for(var d=!0,c=0;c<u;c++)if(l(e,i+c)!==l(t,c)){d=!1;break}if(d)return i}return -1}o.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==o.prototype},o.compare=function(e,t){if(C(e,Uint8Array)&&(e=o.from(e,e.offset,e.byteLength)),C(t,Uint8Array)&&(t=o.from(t,t.offset,t.byteLength)),!o.isBuffer(e)||!o.isBuffer(t))throw TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;for(var r=e.length,s=t.length,a=0,i=Math.min(r,s);a<i;++a)if(e[a]!==t[a]){r=e[a],s=t[a];break}return r<s?-1:+(s<r)},o.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},o.concat=function(e,t){if(!Array.isArray(e))throw TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return o.alloc(0);if(void 0===t)for(r=0,t=0;r<e.length;++r)t+=e[r].length;var r,s=o.allocUnsafe(t),a=0;for(r=0;r<e.length;++r){var i=e[r];if(C(i,Uint8Array)&&(i=o.from(i)),!o.isBuffer(i))throw TypeError('"list" argument must be an Array of Buffers');i.copy(s,a),a+=i.length}return s},o.byteLength=p,o.prototype._isBuffer=!0,o.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)m(this,t,t+1);return this},o.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)m(this,t,t+3),m(this,t+1,t+2);return this},o.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)m(this,t,t+7),m(this,t+1,t+6),m(this,t+2,t+5),m(this,t+3,t+4);return this},o.prototype.toString=function(){var e=this.length;return 0===e?"":0==arguments.length?_(this,0,e):f.apply(this,arguments)},o.prototype.toLocaleString=o.prototype.toString,o.prototype.equals=function(e){if(!o.isBuffer(e))throw TypeError("Argument must be a Buffer");return this===e||0===o.compare(this,e)},o.prototype.inspect=function(){var e="",r=t.INSPECT_MAX_BYTES;return e=this.toString("hex",0,r).replace(/(.{2})/g,"$1 ").trim(),this.length>r&&(e+=" ... "),"<Buffer "+e+">"},i&&(o.prototype[i]=o.prototype.inspect),o.prototype.compare=function(e,t,r,s,a){if(C(e,Uint8Array)&&(e=o.from(e,e.offset,e.byteLength)),!o.isBuffer(e))throw TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===s&&(s=0),void 0===a&&(a=this.length),t<0||r>e.length||s<0||a>this.length)throw RangeError("out of range index");if(s>=a&&t>=r)return 0;if(s>=a)return -1;if(t>=r)return 1;if(t>>>=0,r>>>=0,s>>>=0,a>>>=0,this===e)return 0;for(var i=a-s,n=r-t,u=Math.min(i,n),l=this.slice(s,a),h=e.slice(t,r),d=0;d<u;++d)if(l[d]!==h[d]){i=l[d],n=h[d];break}return i<n?-1:+(n<i)},o.prototype.includes=function(e,t,r){return -1!==this.indexOf(e,t,r)},o.prototype.indexOf=function(e,t,r){return g(this,e,t,r,!0)},o.prototype.lastIndexOf=function(e,t,r){return g(this,e,t,r,!1)};function _(e,t,r){r=Math.min(e.length,r);for(var s=[],a=t;a<r;){var i,n,o,u,l=e[a],h=null,d=l>239?4:l>223?3:l>191?2:1;if(a+d<=r)switch(d){case 1:l<128&&(h=l);break;case 2:(192&(i=e[a+1]))==128&&(u=(31&l)<<6|63&i)>127&&(h=u);break;case 3:i=e[a+1],n=e[a+2],(192&i)==128&&(192&n)==128&&(u=(15&l)<<12|(63&i)<<6|63&n)>2047&&(u<55296||u>57343)&&(h=u);break;case 4:i=e[a+1],n=e[a+2],o=e[a+3],(192&i)==128&&(192&n)==128&&(192&o)==128&&(u=(15&l)<<18|(63&i)<<12|(63&n)<<6|63&o)>65535&&u<1114112&&(h=u)}null===h?(h=65533,d=1):h>65535&&(h-=65536,s.push(h>>>10&1023|55296),h=56320|1023&h),s.push(h),a+=d}var c=s,p=c.length;if(p<=4096)return String.fromCharCode.apply(String,c);for(var f="",m=0;m<p;)f+=String.fromCharCode.apply(String,c.slice(m,m+=4096));return f}function b(e,t,r){if(e%1!=0||e<0)throw RangeError("offset is not uint");if(e+t>r)throw RangeError("Trying to access beyond buffer length")}function v(e,t,r,s,a,i){if(!o.isBuffer(e))throw TypeError('"buffer" argument must be a Buffer instance');if(t>a||t<i)throw RangeError('"value" argument is out of bounds');if(r+s>e.length)throw RangeError("Index out of range")}function w(e,t,r,s,a,i){if(r+s>e.length||r<0)throw RangeError("Index out of range")}function S(e,t,r,s,i){return t*=1,r>>>=0,i||w(e,t,r,4,34028234663852886e22,-34028234663852886e22),a.write(e,t,r,s,23,4),r+4}function x(e,t,r,s,i){return t*=1,r>>>=0,i||w(e,t,r,8,17976931348623157e292,-17976931348623157e292),a.write(e,t,r,s,52,8),r+8}o.prototype.write=function(e,t,r,s){if(void 0===t)s="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)s=t,r=this.length,t=0;else if(isFinite(t))t>>>=0,isFinite(r)?(r>>>=0,void 0===s&&(s="utf8")):(s=r,r=void 0);else throw Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var a,i,n,o,u,l,h,d,c=this.length-t;if((void 0===r||r>c)&&(r=c),e.length>0&&(r<0||t<0)||t>this.length)throw RangeError("Attempt to write outside buffer bounds");s||(s="utf8");for(var p=!1;;)switch(s){case"hex":return function(e,t,r,s){r=Number(r)||0;var a=e.length-r;s?(s=Number(s))>a&&(s=a):s=a;var i=t.length;s>i/2&&(s=i/2);for(var n=0;n<s;++n){var o,u=parseInt(t.substr(2*n,2),16);if((o=u)!=o)break;e[r+n]=u}return n}(this,e,t,r);case"utf8":case"utf-8":return a=t,i=r,A(k(e,this.length-a),this,a,i);case"ascii":return n=t,o=r,A(I(e),this,n,o);case"latin1":case"binary":return function(e,t,r,s){return A(I(t),e,r,s)}(this,e,t,r);case"base64":return u=t,l=r,A(E(e),this,u,l);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return h=t,d=r,A(function(e,t){for(var r,s,a=[],i=0;i<e.length&&!((t-=2)<0);++i)s=(r=e.charCodeAt(i))>>8,a.push(r%256),a.push(s);return a}(e,this.length-h),this,h,d);default:if(p)throw TypeError("Unknown encoding: "+s);s=(""+s).toLowerCase(),p=!0}},o.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},o.prototype.slice=function(e,t){var r=this.length;e=~~e,t=void 0===t?r:~~t,e<0?(e+=r)<0&&(e=0):e>r&&(e=r),t<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e);var s=this.subarray(e,t);return Object.setPrototypeOf(s,o.prototype),s},o.prototype.readUIntLE=function(e,t,r){e>>>=0,t>>>=0,r||b(e,t,this.length);for(var s=this[e],a=1,i=0;++i<t&&(a*=256);)s+=this[e+i]*a;return s},o.prototype.readUIntBE=function(e,t,r){e>>>=0,t>>>=0,r||b(e,t,this.length);for(var s=this[e+--t],a=1;t>0&&(a*=256);)s+=this[e+--t]*a;return s},o.prototype.readUInt8=function(e,t){return e>>>=0,t||b(e,1,this.length),this[e]},o.prototype.readUInt16LE=function(e,t){return e>>>=0,t||b(e,2,this.length),this[e]|this[e+1]<<8},o.prototype.readUInt16BE=function(e,t){return e>>>=0,t||b(e,2,this.length),this[e]<<8|this[e+1]},o.prototype.readUInt32LE=function(e,t){return e>>>=0,t||b(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+0x1000000*this[e+3]},o.prototype.readUInt32BE=function(e,t){return e>>>=0,t||b(e,4,this.length),0x1000000*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},o.prototype.readIntLE=function(e,t,r){e>>>=0,t>>>=0,r||b(e,t,this.length);for(var s=this[e],a=1,i=0;++i<t&&(a*=256);)s+=this[e+i]*a;return s>=(a*=128)&&(s-=Math.pow(2,8*t)),s},o.prototype.readIntBE=function(e,t,r){e>>>=0,t>>>=0,r||b(e,t,this.length);for(var s=t,a=1,i=this[e+--s];s>0&&(a*=256);)i+=this[e+--s]*a;return i>=(a*=128)&&(i-=Math.pow(2,8*t)),i},o.prototype.readInt8=function(e,t){return(e>>>=0,t||b(e,1,this.length),128&this[e])?-((255-this[e]+1)*1):this[e]},o.prototype.readInt16LE=function(e,t){e>>>=0,t||b(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?0xffff0000|r:r},o.prototype.readInt16BE=function(e,t){e>>>=0,t||b(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?0xffff0000|r:r},o.prototype.readInt32LE=function(e,t){return e>>>=0,t||b(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},o.prototype.readInt32BE=function(e,t){return e>>>=0,t||b(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},o.prototype.readFloatLE=function(e,t){return e>>>=0,t||b(e,4,this.length),a.read(this,e,!0,23,4)},o.prototype.readFloatBE=function(e,t){return e>>>=0,t||b(e,4,this.length),a.read(this,e,!1,23,4)},o.prototype.readDoubleLE=function(e,t){return e>>>=0,t||b(e,8,this.length),a.read(this,e,!0,52,8)},o.prototype.readDoubleBE=function(e,t){return e>>>=0,t||b(e,8,this.length),a.read(this,e,!1,52,8)},o.prototype.writeUIntLE=function(e,t,r,s){if(e*=1,t>>>=0,r>>>=0,!s){var a=Math.pow(2,8*r)-1;v(this,e,t,r,a,0)}var i=1,n=0;for(this[t]=255&e;++n<r&&(i*=256);)this[t+n]=e/i&255;return t+r},o.prototype.writeUIntBE=function(e,t,r,s){if(e*=1,t>>>=0,r>>>=0,!s){var a=Math.pow(2,8*r)-1;v(this,e,t,r,a,0)}var i=r-1,n=1;for(this[t+i]=255&e;--i>=0&&(n*=256);)this[t+i]=e/n&255;return t+r},o.prototype.writeUInt8=function(e,t,r){return e*=1,t>>>=0,r||v(this,e,t,1,255,0),this[t]=255&e,t+1},o.prototype.writeUInt16LE=function(e,t,r){return e*=1,t>>>=0,r||v(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},o.prototype.writeUInt16BE=function(e,t,r){return e*=1,t>>>=0,r||v(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},o.prototype.writeUInt32LE=function(e,t,r){return e*=1,t>>>=0,r||v(this,e,t,4,0xffffffff,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},o.prototype.writeUInt32BE=function(e,t,r){return e*=1,t>>>=0,r||v(this,e,t,4,0xffffffff,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},o.prototype.writeIntLE=function(e,t,r,s){if(e*=1,t>>>=0,!s){var a=Math.pow(2,8*r-1);v(this,e,t,r,a-1,-a)}var i=0,n=1,o=0;for(this[t]=255&e;++i<r&&(n*=256);)e<0&&0===o&&0!==this[t+i-1]&&(o=1),this[t+i]=(e/n|0)-o&255;return t+r},o.prototype.writeIntBE=function(e,t,r,s){if(e*=1,t>>>=0,!s){var a=Math.pow(2,8*r-1);v(this,e,t,r,a-1,-a)}var i=r-1,n=1,o=0;for(this[t+i]=255&e;--i>=0&&(n*=256);)e<0&&0===o&&0!==this[t+i+1]&&(o=1),this[t+i]=(e/n|0)-o&255;return t+r},o.prototype.writeInt8=function(e,t,r){return e*=1,t>>>=0,r||v(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},o.prototype.writeInt16LE=function(e,t,r){return e*=1,t>>>=0,r||v(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},o.prototype.writeInt16BE=function(e,t,r){return e*=1,t>>>=0,r||v(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},o.prototype.writeInt32LE=function(e,t,r){return e*=1,t>>>=0,r||v(this,e,t,4,0x7fffffff,-0x80000000),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},o.prototype.writeInt32BE=function(e,t,r){return e*=1,t>>>=0,r||v(this,e,t,4,0x7fffffff,-0x80000000),e<0&&(e=0xffffffff+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},o.prototype.writeFloatLE=function(e,t,r){return S(this,e,t,!0,r)},o.prototype.writeFloatBE=function(e,t,r){return S(this,e,t,!1,r)},o.prototype.writeDoubleLE=function(e,t,r){return x(this,e,t,!0,r)},o.prototype.writeDoubleBE=function(e,t,r){return x(this,e,t,!1,r)},o.prototype.copy=function(e,t,r,s){if(!o.isBuffer(e))throw TypeError("argument should be a Buffer");if(r||(r=0),s||0===s||(s=this.length),t>=e.length&&(t=e.length),t||(t=0),s>0&&s<r&&(s=r),s===r||0===e.length||0===this.length)return 0;if(t<0)throw RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw RangeError("Index out of range");if(s<0)throw RangeError("sourceEnd out of bounds");s>this.length&&(s=this.length),e.length-t<s-r&&(s=e.length-t+r);var a=s-r;if(this===e&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(t,r,s);else if(this===e&&r<t&&t<s)for(var i=a-1;i>=0;--i)e[i+t]=this[i+r];else Uint8Array.prototype.set.call(e,this.subarray(r,s),t);return a},o.prototype.fill=function(e,t,r,s){if("string"==typeof e){if("string"==typeof t?(s=t,t=0,r=this.length):"string"==typeof r&&(s=r,r=this.length),void 0!==s&&"string"!=typeof s)throw TypeError("encoding must be a string");if("string"==typeof s&&!o.isEncoding(s))throw TypeError("Unknown encoding: "+s);if(1===e.length){var a,i=e.charCodeAt(0);("utf8"===s&&i<128||"latin1"===s)&&(e=i)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<r)throw RangeError("Out of range index");if(r<=t)return this;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(a=t;a<r;++a)this[a]=e;else{var n=o.isBuffer(e)?e:o.from(e,s),u=n.length;if(0===u)throw TypeError('The value "'+e+'" is invalid for argument "value"');for(a=0;a<r-t;++a)this[a+t]=n[a%u]}return this};var T=/[^+/0-9A-Za-z-_]/g;function k(e,t){t=t||1/0;for(var r,s=e.length,a=null,i=[],n=0;n<s;++n){if((r=e.charCodeAt(n))>55295&&r<57344){if(!a){if(r>56319||n+1===s){(t-=3)>-1&&i.push(239,191,189);continue}a=r;continue}if(r<56320){(t-=3)>-1&&i.push(239,191,189),a=r;continue}r=(a-55296<<10|r-56320)+65536}else a&&(t-=3)>-1&&i.push(239,191,189);if(a=null,r<128){if((t-=1)<0)break;i.push(r)}else if(r<2048){if((t-=2)<0)break;i.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;i.push(r>>12|224,r>>6&63|128,63&r|128)}else if(r<1114112){if((t-=4)<0)break;i.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}else throw Error("Invalid code point")}return i}function I(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}function E(e){return s.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(T,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function A(e,t,r,s){for(var a=0;a<s&&!(a+r>=t.length)&&!(a>=e.length);++a)t[a+r]=e[a];return a}function C(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}var R=function(){for(var e="0123456789abcdef",t=Array(256),r=0;r<16;++r)for(var s=16*r,a=0;a<16;++a)t[s+a]=e[r]+e[a];return t}()},783:function(e,t){t.read=function(e,t,r,s,a){var i,n,o=8*a-s-1,u=(1<<o)-1,l=u>>1,h=-7,d=r?a-1:0,c=r?-1:1,p=e[t+d];for(d+=c,i=p&(1<<-h)-1,p>>=-h,h+=o;h>0;i=256*i+e[t+d],d+=c,h-=8);for(n=i&(1<<-h)-1,i>>=-h,h+=s;h>0;n=256*n+e[t+d],d+=c,h-=8);if(0===i)i=1-l;else{if(i===u)return n?NaN:1/0*(p?-1:1);n+=Math.pow(2,s),i-=l}return(p?-1:1)*n*Math.pow(2,i-s)},t.write=function(e,t,r,s,a,i){var n,o,u,l=8*i-a-1,h=(1<<l)-1,d=h>>1,c=5960464477539062e-23*(23===a),p=s?0:i-1,f=s?1:-1,m=+(t<0||0===t&&1/t<0);for(isNaN(t=Math.abs(t))||t===1/0?(o=+!!isNaN(t),n=h):(n=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-n))<1&&(n--,u*=2),n+d>=1?t+=c/u:t+=c*Math.pow(2,1-d),t*u>=2&&(n++,u/=2),n+d>=h?(o=0,n=h):n+d>=1?(o=(t*u-1)*Math.pow(2,a),n+=d):(o=t*Math.pow(2,d-1)*Math.pow(2,a),n=0));a>=8;e[r+p]=255&o,p+=f,o/=256,a-=8);for(n=n<<a|o,l+=a;l>0;e[r+p]=255&n,p+=f,n/=256,l-=8);e[r+p-f]|=128*m}}},r={};function s(e){var a=r[e];if(void 0!==a)return a.exports;var i=r[e]={exports:{}},n=!0;try{t[e](i,i.exports,s),n=!1}finally{n&&delete r[e]}return i.exports}s.ab="//",e.exports=s(72)}()},9908:(e,t,r)=>{"use strict";r.d(t,{o:()=>C});var s=r(2115),a=r(7119),i=r(5453),n=()=>(0,i.v)(e=>{let t=new Map;return Object.freeze({getToolUI:e=>{let r=t.get(e),s=r?.at(-1);return s||null},setToolUI:(r,s)=>{let a=t.get(r);return a||(a=[],t.set(r,a)),a.push(s),e({}),()=>{let t=a.indexOf(s);-1!==t&&a.splice(t,1),t===a.length&&e({})}}})}),o=r(4354),u=r(2288),l=(0,s.createContext)(null),h=(0,o.h)(l,"AssistantRuntimeProvider");function d(e){let t=h(e);return t?t.useThreadRuntime():null}(0,u.k)(d),(0,u.k)(e=>{var t,r;return null!=(r=null==(t=d(e))?void 0:t.composer)?r:null});var c=r(9935),p=r(3357),f=r(4229),m=()=>{let e=new Set;return(0,i.v)(()=>({isAtBottom:!0,scrollToBottom:()=>{for(let t of e)t()},onScrollToBottom:t=>(e.add(t),()=>{e.delete(t)})}))},g=r(97),y=(0,s.createContext)(null),_=(0,o.h)(y,"ThreadPrimitive.Viewport"),{useThreadViewport:b,useThreadViewportStore:v}=(0,g.o)(_,"useThreadViewport"),w=r(5155),S=()=>{let e=v({optional:!0}),[t]=(0,s.useState)(()=>m());return(0,s.useEffect)(()=>null==e?void 0:e.getState().onScrollToBottom(()=>{t.getState().scrollToBottom()}),[e,t]),(0,s.useEffect)(()=>{if(e)return t.subscribe(t=>{e.getState().isAtBottom!==t.isAtBottom&&(0,c.s)(e).setState({isAtBottom:t.isAtBottom})})},[t,e]),t},x=e=>{let{children:t}=e,r=S(),[a]=(0,s.useState)(()=>({useThreadViewport:r}));return(0,w.jsx)(y.Provider,{value:a,children:t})},T=e=>{let[t]=(0,s.useState)(()=>(0,i.v)(()=>e));return(0,s.useEffect)(()=>{(0,f.Q)(e),(0,f.Q)(e.composer),(0,c.s)(t).setState(e,!0)},[e,t]),t},k=e=>{let{children:t,listItemRuntime:r,runtime:a}=e,i=T(a),[n]=(0,s.useState)(()=>({useThreadRuntime:i}));return(0,w.jsx)(p.X,{runtime:r,children:(0,w.jsx)(l.Provider,{value:n,children:(0,w.jsx)(x,{children:t})})})},I=e=>{let[t]=(0,s.useState)(()=>(0,i.v)(()=>e));return(0,s.useEffect)(()=>{(0,f.Q)(e),(0,f.Q)(e.threads),(0,c.s)(t).setState(e,!0)},[e,t]),t},E=()=>(0,s.useMemo)(()=>n(),[]),A=e=>{var t;return null==(t=e._core)?void 0:t.RenderComponent},C=(0,s.memo)(e=>{let{children:t,runtime:r}=e,i=I(r),n=E(),[o]=(0,s.useState)(()=>({useToolUIs:n,useAssistantRuntime:i})),u=A(r);return(0,w.jsxs)(a.WF.Provider,{value:o,children:[u&&(0,w.jsx)(u,{}),(0,w.jsx)(k,{runtime:r.thread,listItemRuntime:r.threads.mainItem,children:t})]})})},9935:(e,t,r)=>{"use strict";r.d(t,{s:()=>s});var s=e=>e}}]);